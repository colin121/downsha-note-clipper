var Downsha=Downsha||{};Downsha.inherit=function(a,d,c){if(typeof d.constructor=="function"){a.prototype=new d;a.prototype.constructor=a;a.parent=d.prototype}else{a.prototype=d;a.prototype.constructor=a;a.parent=d}if(c){for(var b in d.prototype.constructor){if(b!="parent"&&b!="prototype"&&b!="javaClass"&&d.constructor[b]!=d.prototype.constructor[b]){a.prototype.constructor[b]=d.prototype.constructor[b]}}}if(typeof a.prototype.handleInheritance=="function"){a.prototype.handleInheritance.apply(a,[a,d,c])}};Downsha.inherits=function(a,b){var c=a;while(c&&typeof c.parent!="undefined"){if(c.parent.constructor==b){return true}else{c=c.parent.constructor}}return false};Downsha.mixin=function(c,a,e){var d=(typeof c=="function")?c.prototype:c;for(var b in a.prototype){var f=to=b;if(typeof e=="object"&&e&&typeof e[b]!="undefined"){to=e[b]}d[to]=a.prototype[f]}};Downsha.extendObject=function(f,b,a){if(typeof b=="object"&&b!=null){for(var c in b){if(a&&typeof b[c]=="object"&&b[c]!=null&&typeof f[c]=="object"&&f[c]!=null){Downsha.extendObject(f[c],b[c],a)}else{try{f[c]=b[c]}catch(d){}}}}};Downsha.hasOwnProperty=function(c,b){if(typeof c=="object"){if(c.hasOwnProperty(b)){return true}var a=null;var d=c;while(a=d.__proto__){if(a.hasOwnProperty(b)){return true}else{d=a}}}return false};Downsha.Logger=function Logger(c,d,b){this.__defineGetter__("level",this.getLevel);this.__defineSetter__("level",this.setLevel);this.__defineGetter__("scope",this.getScope);this.__defineSetter__("scope",this.setScope);this.__defineGetter__("scopeName",this.getScopeName);this.__defineGetter__("scopeNameAsPrefix",this.getScopeNameAsPrefix);this.__defineGetter__("useTimestamp",this.isUseTimestamp);this.__defineSetter__("useTimestamp",this.setUseTimestamp);this.__defineGetter__("usePrefix",this.isUsePrefix);this.__defineSetter__("usePrefix",this.setUsePrefix);this.__defineGetter__("enabled",this.isEnabled);this.__defineSetter__("enabled",this.setEnabled);this.scope=c||arguments.callee.caller;this.level=d;if(typeof b!="undefined"&&b instanceof Downsha.LoggerImpl){this.impl=b}else{var a=Downsha.LoggerImplFactory.getImplementationFor(navigator);if(a instanceof Array){this.impl=new Downsha.LoggerChainImpl(this,a)}else{this.impl=new a(this)}}};Downsha.Logger.LOG_LEVEL_DEBUG=0;Downsha.Logger.LOG_LEVEL_INFO=1;Downsha.Logger.LOG_LEVEL_WARN=2;Downsha.Logger.LOG_LEVEL_ERROR=3;Downsha.Logger.LOG_LEVEL_EXCEPTION=4;Downsha.Logger.LOG_LEVEL_OFF=5;Downsha.Logger.GLOBAL_LEVEL=Downsha.Logger.LOG_LEVEL_ERROR;Downsha.Logger.DEBUG_PREFIX="[DEBUG] ";Downsha.Logger.INFO_PREFIX="[INFO] ";Downsha.Logger.WARN_PREFIX="[WARN] ";Downsha.Logger.ERROR_PREFIX="[ERROR] ";Downsha.Logger.EXCEPTION_PREFIX="[EXCEPTION] ";Downsha.Logger._instances={};Downsha.Logger.getInstance=function(b){b=b||arguments.callee.caller;var a=(typeof b=="function")?b.name:b.constructor.name;if(typeof this._instances[a]=="undefined"){this._instances[a]=new Downsha.Logger(b)}return this._instances[a]};Downsha.Logger.setInstance=function(a){this._instance=a};Downsha.Logger.destroyInstance=function(b){b=b||arguments.callee.caller;var a=(typeof b=="function")?b.name:b.constructor.name;delete this._instances[a]};Downsha.Logger.setGlobalLevel=function(c){var a=parseInt(c);if(isNaN(a)){return}Downsha.Logger.GLOBAL_LEVEL=a;if(this._instances){for(var b in this._instances){this._instances[b].setLevel(a)}}};Downsha.Logger.setLevel=function(b){if(this._instances){for(var a in this._instances){this._instances[a].setLevel(b)}}};Downsha.Logger.enableImplementor=function(a){if(this._instances){for(var b in this._instances){this._instances[b].enableImplementor(a)}}if(a){a.protoEnabled=true}};Downsha.Logger.disableImplementor=function(a){if(this._instances){for(var b in this._instances){this._instances[b].disableImplementor(a)}}if(a){a.protoEnabled=false}};Downsha.Logger.prototype._level=0;Downsha.Logger.prototype._scope=null;Downsha.Logger.prototype._usePrefix=true;Downsha.Logger.prototype._useTimestamp=true;Downsha.Logger.prototype._enabled=true;Downsha.Logger.prototype.getImplementor=function(a){if(a){return this.impl.answerImplementorInstance(a)}else{return this.impl}};Downsha.Logger.prototype.enableImplementor=function(a){if(a){var b=this.getImplementor(a);if(b){b.enabled=true}}else{this.impl.enabled=true}};Downsha.Logger.prototype.disableImplementor=function(a){if(a){var b=this.getImplementor(a);if(b){b.enabled=false}}else{this.impl.enabled=false}};Downsha.Logger.prototype.setLevel=function(a){this._level=parseInt(a);if(isNaN(this._level)){this._level=Downsha.Logger.GLOBAL_LEVEL}};Downsha.Logger.prototype.getLevel=function(){return this._level};Downsha.Logger.prototype.setScope=function(a){if(typeof a=="function"){this._scope=a}else{if(typeof a=="object"&&a!=null){this._scope=a.constructor}}};Downsha.Logger.prototype.getScope=function(){return this._scope};Downsha.Logger.prototype.getScopeName=function(){if(this.scope){return this.scope.name}else{return""}};Downsha.Logger.prototype.getScopeNameAsPrefix=function(){var a=this.scopeName;return(a)?"["+a+"] ":""};Downsha.Logger.prototype._padNumber=function(c,a){var b="0";c=parseInt(c);if(isNaN(c)){c=0}var e=(c>=0)?true:false;var d=""+Math.abs(c);while(d.length<a){d=b+d}if(!e){d="-"+d}return d};Downsha.Logger.prototype.getPrefix=function(f){var i="";if(this.useTimestamp){var g=new Date();var a=this._padNumber((g.getMonth()+1),2);var j=this._padNumber(g.getDate(),2);var e=this._padNumber(g.getHours(),2);var b=this._padNumber(g.getMinutes(),2);var k=this._padNumber(g.getSeconds(),2);var c=this._padNumber((0-(g.getTimezoneOffset()/60)*100),4);i+=a+"/"+j+"/"+g.getFullYear()+" "+e+":"+b+":"+k+"."+g.getMilliseconds()+" "+c+" "}if(this.usePrefix){i+=f}i+=this.scopeNameAsPrefix;return i};Downsha.Logger.prototype.isUsePrefix=function(){return this._usePrefix};Downsha.Logger.prototype.setUsePrefix=function(a){this._usePrefix=(a)?true:false};Downsha.Logger.prototype.isUseTimestamp=function(){return this._useTimestamp};Downsha.Logger.prototype.setUseTimestamp=function(a){this._useTimestamp=(a)?true:false};Downsha.Logger.prototype.isEnabled=function(){return this._enabled};Downsha.Logger.prototype.setEnabled=function(a){this._enabled=(a)?true:false};Downsha.Logger.prototype.isDebugEnabled=function(){return(this.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_DEBUG)};Downsha.Logger.prototype.dump=function(a){if(this.enabled&&this.impl.enabled){this.impl.dir(a)}};Downsha.Logger.prototype.dir=function(a){if(this.enabled&&this.impl.enabled){this.impl.dir(a)}};Downsha.Logger.prototype.trace=function(){if(this.enabled&&this.impl.enabled){this.impl.trace()}};Downsha.Logger.prototype.debug=function(a){if(this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_DEBUG){this.impl.debug(this.getPrefix(this.constructor.DEBUG_PREFIX)+a)}};Downsha.Logger.prototype.info=function(a){if(this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_INFO){this.impl.info(this.getPrefix(this.constructor.INFO_PREFIX)+a)}};Downsha.Logger.prototype.warn=function(a){if(this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_WARN){this.impl.warn(this.getPrefix(this.constructor.WARN_PREFIX)+a)}};Downsha.Logger.prototype.error=function(a){if(this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_ERROR){this.impl.error(this.getPrefix(this.constructor.ERROR_PREFIX)+a)}};Downsha.Logger.prototype.exception=function(a){if(this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_EXCEPTION){this.impl.exception(this.getPrefix(this.constructor.EXCEPTION_PREFIX)+a)}};Downsha.Logger.prototype.alert=function(a){if(this.enabled&&this.impl.enabled){this.impl.alert(a)}};Downsha.Logger.prototype.clear=function(){this.impl.clear()};Downsha.LoggerImpl=function LoggerImpl(a){this.__defineGetter__("logger",this.getLogger);this.__defineSetter__("logger",this.setLogger);this.__defineGetter__("enabled",this.isEnabled);this.__defineSetter__("enabled",this.setEnabled);this.__defineGetter__("protoEnabled",this.isProtoEnabled);this.__defineSetter__("protoEnabled",this.setProtoEnabled);this.initialize(a)};Downsha.LoggerImpl.ClassRegistry=new Array();Downsha.LoggerImpl.isResponsibleFor=function(a){return false};Downsha.LoggerImpl.prototype.handleInheritance=function(b,a){Downsha.LoggerImpl.ClassRegistry.push(b)};Downsha.LoggerImpl.prototype._logger=null;Downsha.LoggerImpl.prototype._enabled=false;Downsha.LoggerImpl.prototype.initialize=function(a){this.logger=a};Downsha.LoggerImpl.prototype.answerImplementorInstance=function(a){if(this.constructor==a){return this}};Downsha.LoggerImpl.prototype.isEnabled=function(){return this._enabled};Downsha.LoggerImpl.prototype.setEnabled=function(a){this._enabled=(a)?true:false};Downsha.LoggerImpl.prototype.isProtoEnabled=function(){return this.constructor.prototype._enabled};Downsha.LoggerImpl.prototype.setProtoEnabled=function(a){this.constructor.prototype._enabled=(a)?true:false};Downsha.LoggerImpl.prototype.getLogger=function(){return this._logger};Downsha.LoggerImpl.prototype.setLogger=function(a){if(a instanceof Downsha.Logger){this._logger=a}};Downsha.LoggerImpl.prototype.dir=function(a){};Downsha.LoggerImpl.prototype.trace=function(){};Downsha.LoggerImpl.prototype.debug=function(a){};Downsha.LoggerImpl.prototype.info=function(a){};Downsha.LoggerImpl.prototype.warn=function(a){};Downsha.LoggerImpl.prototype.error=function(a){};Downsha.LoggerImpl.prototype.exception=function(a){};Downsha.LoggerImpl.prototype.alert=function(a){};Downsha.LoggerImpl.prototype.clear=function(){};Downsha.LoggerChainImpl=function LoggerChainImpl(a,b){this.initialize(a,b)};Downsha.inherit(Downsha.LoggerChainImpl,Downsha.LoggerImpl,true);Downsha.LoggerChainImpl.prototype._impls=null;Downsha.LoggerChainImpl.prototype._enabled=true;Downsha.LoggerChainImpl.prototype.initialize=function(a,e){Downsha.LoggerChainImpl.parent.initialize.apply(this,[a]);var c=[].concat(e);this._impls=[];for(var b=0;b<c.length;b++){var d=c[b];this._impls.push(new d(a))}};Downsha.LoggerChainImpl.prototype.answerImplementorInstance=function(a){for(var b=0;b<this._impls.length;b++){var c=this._impls[b].answerImplementorInstance(a);if(c){return c}}};Downsha.LoggerChainImpl.prototype.dir=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].dir(b)}}};Downsha.LoggerChainImpl.prototype.trace=function(){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].trace(obj)}}};Downsha.LoggerChainImpl.prototype.debug=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].debug(b)}}};Downsha.LoggerChainImpl.prototype.info=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].info(b)}}};Downsha.LoggerChainImpl.prototype.warn=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].warn(b)}}};Downsha.LoggerChainImpl.prototype.error=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].error(b)}}};Downsha.LoggerChainImpl.prototype.exception=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].exception(b)}}};Downsha.LoggerChainImpl.prototype.alert=function(b){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].alert(b)}}};Downsha.LoggerChainImpl.prototype.clear=function(){for(var a=0;a<this._impls.length;a++){if(this._impls[a].enabled){this._impls[a].clear()}}};Downsha.LoggerImplFactory={getImplementationFor:function(a){var c=Downsha.LoggerImpl.ClassRegistry;var d=[];for(var b=0;b<c.length;b++){if(typeof c[b]=="function"&&typeof c[b].isResponsibleFor=="function"&&c[b].isResponsibleFor(a)){d.push(c[b])}}if(d.length==0){return Downsha.LoggerImpl}else{if(d.length==1){return d[0]}}return d}};Downsha.WebKitLoggerImpl=function WebKitLoggerImpl(a){this.initialize(a)};Downsha.inherit(Downsha.WebKitLoggerImpl,Downsha.LoggerImpl,true);Downsha.WebKitLoggerImpl.isResponsibleFor=function(a){return a.userAgent.toLowerCase().indexOf("AppleWebKit/")>0};Downsha.WebKitLoggerImpl.prototype._enabled=true;Downsha.WebKitLoggerImpl.prototype.dir=function(a){console.group(this.logger.scopeName);console.dir(a);console.groupEnd()};Downsha.WebKitLoggerImpl.prototype.trace=function(){console.group(this.logger.scopeName);console.trace();console.groupEnd()};Downsha.WebKitLoggerImpl.prototype.debug=function(a){console.debug(a)};Downsha.WebKitLoggerImpl.prototype.info=function(a){console.info(a)};Downsha.WebKitLoggerImpl.prototype.warn=function(a){console.warn(a)};Downsha.WebKitLoggerImpl.prototype.error=function(a){console.error(a)};Downsha.WebKitLoggerImpl.prototype.exception=function(a){console.error(a);this.trace()};Downsha.WebKitLoggerImpl.prototype.alert=function(a){alert(a)};Downsha.Utils=new function Utils(){};Downsha.Utils.extendObject=function(e,c,d,f){if(typeof e=="object"&&e!=null&&typeof c=="object"&&c!=null){for(var g in c){if(typeof e[g]=="undefined"||f){e[g]=c[g]}else{if(d){arguments.callee.apply(this,[e[g],c[g],d,f])}}}}};Downsha.Utils.importConstructs=function(c,b,f){var g=(f instanceof Array)?f:[f];for(var d=0;d<g.length;d++){var e=g[d].split(".");var h=b;var j=c;for(var a=0;a<e.length;a++){if(a==e.length-1){if(typeof h[e[a]]=="undefined"){h[e[a]]=j[e[a]]}else{Downsha.Utils.extendObject(h[e[a]],j[e[a]],true)}}else{j=j[e[a]];if(typeof h[e[a]]=="undefined"){h[e[a]]={}}h=h[e[a]]}}}};Downsha.Utils.separateString=function(f,e){if(typeof f!="string"){return f}if(typeof e!="string"){e=","}var d=f.split(e);var c=new Array();for(var b=0;b<d.length;b++){if(typeof d[b]!="string"){continue}var a=Downsha.Utils.trim(d[b]);if(a&&a.length>0){c.push(a)}}return c};Downsha.Utils.trim=function(a){if(typeof a!="string"){return a}return a.replace(/^\s+/,"").replace(/\s+$/,"")};Downsha.Utils.shortenString=function(d,a,c){var b=d+"";if(b.length>a){b=b.substring(0,Math.max(0,a-((typeof c=="string")?c.length:0)));if(typeof c=="string"){b+=c}}return b};Downsha.Utils.htmlEntities=function(a){return $("<div/>").text(a).html()};Downsha.Utils.urlPath=function(a){if(typeof a=="string"){var b=a.replace(/^[^:]+:\/+([^\/]+)/,"");if(b.indexOf("/")==0){return b.replace(/^(\/[^\?\#]*).*$/,"$1")}}return""};Downsha.Utils.urlDomain=function(b,a){if(typeof b=="string"){var c=new RegExp("^[^:]+:/+([^/"+((a)?"":":")+"]+).*$");return b.replace(c,"$1")}return b};Downsha.Utils.urlTopDomain=function(b){var a=b;if(typeof b=="string"){var a=Downsha.Utils.urlDomain(b);if(a.toLowerCase().indexOf("www.")==0){a=a.substring(4)}}return a};Downsha.Utils.urlPath=function(a){if(typeof a=="string"){var b=new RegExp("^[^:]+://[^/]+([^&?]*).*$");return a.replace(b,"$1")}return""};Downsha.Utils.urlQueryValue=function(f,c){if(typeof c=="string"&&typeof f=="string"&&c.indexOf("?")>=0){var b=c.split(/[\?\#\&]+/).slice(1);var a=f.toLowerCase();var e=new Array();for(var d=0;d<b.length;d++){var h=b[d].split("=",2);if(h[0].toLowerCase()==a){var g=(h[1])?h[1].replace(/\+/g," "):h[1];e.push(decodeURIComponent(g))}}if(e.length>0){return e[e.length-1]}}return null};Downsha.Utils.urlProto=function(b){if(typeof b=="string"){var a=-1;if((a=b.indexOf(":/"))>0){return b.substring(0,a).toLowerCase()}}return null};Downsha.Utils.absoluteUrl=function(a,b){if(a.indexOf("//")==0){a=b.replace(/^([^:]+):.*$/,"$1")+":"+a}else{if(a.indexOf("/")==0){a=b.replace(/^(.*:\/\/[^\/]+).*$/,"$1")+a}else{if(a.match(/^\.+\//)){a=b.replace(/^(.*:\/\/[^\/]+).*$/,"$1")+"/"+a}else{a=(b.charAt(b.length-1)=="/")?b+a:b+"/"+a}}}return a};Downsha.Utils.urlToSearchQuery=function(a,c){var b=Downsha.Utils.urlProto(a);if(b&&b.indexOf("http")==0){return Downsha.Utils.httpUrlToSearchQuery(a,c)}else{if(b&&b=="file"){return Downsha.Utils.fileUrlToSearchQuery(a,c)}else{if(b){return Downsha.Utils.anyProtoUrlToSearchQuery(a,c)}else{return Downsha.Utils.anyUrlToSearchQuery(a,c)}}}};Downsha.Utils.httpUrlToSearchQuery=function(a,f){var g=(typeof f=="string")?f:"";var e=Downsha.Utils.urlDomain((a+"").toLowerCase());var d=[(g+"http://"+e+"*"),(g+"https://"+e+"*")];if(e.match(/[^0-9\.]/)){var b=(e.indexOf("www.")==0)?e.substring(4):("www."+e);d=d.concat([(g+"http://"+b+"*"),(g+"https://"+b+"*")])}var c="any: "+d.join(" ");return c};Downsha.Utils.fileUrlToSearchQuery=function(a,c){var d=(typeof c=="string")?c:"";var b=d+"file:*";return b};Downsha.Utils.anyProtoUrlToSearchQuery=function(b,g){var h=(typeof g=="string")?g:"";var c=Downsha.Utils.urlProto(b);var a=c+"s";if(c.indexOf("s")==(c.length-1)){c=c.substring(0,(c.length-1));a=c+"s"}var f=Downsha.Utils.urlDomain(b);var e=[(h+c+"://"+f+"*"),(h+a+"://"+f+"*")];var d="any: "+e.join(" ");return d};Downsha.Utils.anyUrlToSearchQuery=function(a,c){var d=(typeof c=="string")?c:"";var b=d+a+"*";return b};Downsha.Utils.urlSuffix="...";Downsha.Utils.shortUrl=function(c,a){var b=c;if(typeof c=="string"){if(b.indexOf("file:")==0){b=decodeURIComponent(b.replace(/^file:.*\/([^\/]+)$/,"$1"));if(typeof a=="number"&&!isNaN(a)&&b.length>a){b=b.substring(0,a);b+=""+Downsha.Utils.urlSuffix}}else{b=b.replace(/^([a-zA-Z]+:\/+)?([^\/]+).*$/,"$2");if(typeof a=="number"&&!isNaN(a)&&b.length>a){b=b.substring(0,a);b+=""+Downsha.Utils.urlSuffix}else{if(c.substring(c.indexOf(b)+b.length).length>2){b+="/"+Downsha.Utils.urlSuffix}}}}return b};Downsha.Utils.appendSearchQueryToUrl=function(a,d){var c=a+"";c+=(c.indexOf("?")>=0)?"&":"?";if(typeof d=="string"){c+=d}else{if(typeof d=="object"&&d){for(var b in d){c+=encodeURIComponent(b)+"="+encodeURIComponent(d[b])+"&"}}}if(c.charAt(c.length-1)=="&"){c=c.substring(0,c.length-1)}return c};Downsha.Utils.makeAbsoluteClientRect=function(b,c){if(!c){c=window}var a={top:b.top+c.pageYOffset,bottom:b.bottom+c.pageYOffset,left:b.left+c.pageXOffset,right:b.right+c.pageXOffset,width:b.width,height:b.height};return a};Downsha.Utils.getAbsoluteBoundingClientRect=function(b){var c=(b.nodeType==Node.TEXT_NODE)?b.parentElement:b;var a=c.getBoundingClientRect();var d=(b instanceof Range)?d=b.commonAncestorContainer.ownerDocument.defaultView:d=b.ownerDocument.defaultView;return Downsha.Utils.makeAbsoluteClientRect(a,d)};Downsha.Utils.marginalizeBoundingClientRect=function(e,b){var d={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height};var a=parseInt(b.getPropertyValue("margin-top"));if(!isNaN(a)){d.top-=a}var f=parseInt(b.getPropertyValue("margin-bottom"));if(!isNaN(f)){d.bottom+=f}var g=parseInt(b.getPropertyValue("margin-left"));if(!isNaN(g)){d.left-=g}var c=parseInt(b.getPropertyValue("margin-right"));if(!isNaN(c)){d.right+=c}d.width=d.right-d.left;d.height=d.bottom-d.top;return d};Downsha.Utils.demarginalizeBoundingClientRect=function(e,b){var d={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height};var a=parseInt(b.getPropertyValue("margin-top"));if(!isNaN(a)){d.top+=a}var f=parseInt(b.getPropertyValue("margin-bottom"));if(!isNaN(f)){d.bottom-=f}var g=parseInt(b.getPropertyValue("margin-left"));if(!isNaN(g)){d.left+=g}var c=parseInt(b.getPropertyValue("margin-right"));if(!isNaN(c)){d.right-=c}d.width=d.right-d.left;d.height=d.bottom-d.top;return d};Downsha.Utils.depadRect=function(e,b){var d={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height};var a=parseInt(b.getPropertyValue("padding-top"));if(!isNaN(a)){d.top+=a}var f=parseInt(b.getPropertyValue("padding-bottom"));if(!isNaN(f)){d.bottom-=f}var g=parseInt(b.getPropertyValue("padding-left"));if(!isNaN(g)){d.left+=g}var c=parseInt(b.getPropertyValue("padding-right"));if(!isNaN(c)){d.right-=c}d.width=d.right-d.left;d.height=d.bottom-d.top;return d};Downsha.Utils.getElementForNode=function(a){if(a&&a.nodeType==Node.ELEMENT_NODE){return a}else{if(a.parentElement){return a.parentElement}else{return null}}};Downsha.Utils.addElementClass=function(a,b){if(a&&b){var d=a.getAttribute("class");if(d){var c=d.split(/\s+/);if(c.indexOf(b)<0){c.push(b)}a.setAttribute("class",c.join(" "))}else{a.setAttribute("class",b)}}};Downsha.Utils.removeElementClass=function(b,c){if(c){var e=b.getAttribute("class");if(e){var d=e.split(/\s+/);var a=-1;if((a=d.indexOf(c))>=0){d.splice(a,1)}b.setAttribute("class",d.join(" "))}}};Downsha.Utils.XML_ESCAPE_CHAR_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};Downsha.Utils.escapeXML=function(d){var b=d.split("");for(var c=0;c<b.length;c++){if(Downsha.Utils.XML_ESCAPE_CHAR_MAP[b[c]]){b[c]=Downsha.Utils.XML_ESCAPE_CHAR_MAP[b[c]]}}return b.join("")};Downsha.Utils.rectIntersectPoint=function(d,c){var e={x:NaN,y:NaN};if(d.right>c.left){e.x=c.left+((d.right-c.left)/2)}else{e.x=d.left+((c.right-d.left)/2)}if(d.bottom>c.top){e.y=c.top+((d.bottom-c.top)/2)}else{e.y=d.top+((c.bottom-d.top)/2)}if(!isNaN(e.x)&&!isNaN(e.y)&&(e.x>d.left&&e.x<d.right&&e.y>d.top&&e.y<d.bottom)||(e.x>c.left&&e.x<c.right&&e.y>c.top&&e.y<c.bottom)){return e}return undefined};Downsha.Utils.rectIntersection=function(d,c){if(!(c.left>d.right||c.right<d.left||c.top>d.bottom||c.bottom<d.top)){var e={left:Math.max(d.left,c.left),top:Math.max(d.top,c.top),right:Math.min(d.right,c.right),bottom:Math.min(d.bottom,c.bottom)};e.width=e.right-e.left;e.height=e.bottom-e.top;return e}return undefined};Downsha.Utils.rectsEqual=function(d,c){if(d.left==c.left&&d.right==c.right&&d.top==c.top&&d.bottom==c.bottom){return true}else{return false}};Downsha.Utils.expandRect=function(d,c){d.left=(d.left)?Math.min(d.left,c.left):c.left;d.top=(d.top)?Math.min(d.top,c.top):c.top;d.right=(d.right)?Math.max(d.right,c.right):c.right;d.bottom=(d.bottom)?Math.max(d.bottom,c.bottom):c.bottom};Downsha.Utils.errorDescription=function(d){var e=null;if(d instanceof FileError){var a=null;var c=d.code;if(typeof c=="number"){for(var f in FileError){if(f.toLowerCase().indexOf("_err")>0&&FileError[f]==d.code){e="FileError: "+c+" ("+f+")";break}}}else{e="FileError: "+c}}else{if(d.message){e=d.message}else{if(typeof d.code!="undefined"){var b=(d.constructor&&d.constructor.name)?d.constructor.name:(""+d);e=b+" code: "+d.code}}}return e};Downsha.Semaphore=function(a){this.__defineGetter__("excessSignals",this.getExcessSignals);this.initialize(a)};Downsha.inherit(Downsha.Semaphore,Array);Downsha.Semaphore.mutex=function(){var a=new Downsha.Semaphore();a.signal();return a};Downsha.Semaphore.prototype._excessSignals=0;Downsha.Semaphore.prototype.initialize=function(a){this._excessSignals=parseInt(a);if(isNaN(this._excessSignals)){this._excessSignals=0}};Downsha.Semaphore.prototype.getExcessSignals=function(){return this._excessSignals};Downsha.Semaphore.prototype.hasExcessSignals=function(){return(this._excessSignals>0)?true:false};Downsha.Semaphore.prototype.signal=function(){if(this.length==0){this._excessSignals++}else{this._processNext()}};Downsha.Semaphore.prototype.wait=function(){if(this._excessSignals>0){this._excessSignals--;this._processNext()}};Downsha.Semaphore.prototype.critical=function(b){var a=this;var c=function(){try{b()}catch(d){a.signal();throw (d)}};c._semaOrigFn=b;this.push(c);this.wait()};Downsha.Semaphore.prototype.wave=function(){if(this.length>0){this.shift()}};Downsha.Semaphore.prototype.waveAll=function(){if(this.length>0){this.splice(0,this.length)}};Downsha.Semaphore.prototype.waveEach=function(b){var a=0;while(a<this.length){if(b(this[a]._semaOrigFn)){this.splice(a,1)}else{a++}}};Downsha.Semaphore.prototype._processNext=function(){if(this.length>0){var a=this.shift();if(typeof a=="function"){a()}}};Downsha.Semaphore.prototype.toString=function(){return this._excessSignals+":["+this.join(",")+"]"};Downsha.Constants=Downsha.Constants||{};Downsha.Constants.RequestType={UNKNOWN:0,LOGOUT:1,LOGIN:2,AUTH_ERROR:3,AUTH_SUCCESS:4,DATA_UPDATED:6,QUOTA_REACHED:7,POPUP_STARTED:8,POPUP_ENDED:9,CLIP_PROCESSOR_INIT_ERROR:11,GET_MANAGED_PAYLOAD:14,RETRY_MANAGED_PAYLOAD:15,CANCEL_MANAGED_PAYLOAD:16,REVISIT_MANAGED_PAYLOAD:17,VIEW_MANAGED_PAYLOAD_DATA:18,EDIT_MANAGED_PAYLOAD_DATA:19,SYNC_DATA:20,SYNC_DATA_FAILURE:21,LOG_FILE_REMOVED:30,LOG_FILE_SWAPPED:32,PAGE_CLIP_SUCCESS:100,PAGE_CLIP_FAILURE:101,PAGE_CLIP_CONTENT_SUCCESS:102,PAGE_CLIP_CONTENT_FAILURE:103,PAGE_CLIP_CONTENT_TOO_BIG:105,CLIP_SUCCESS:110,CLIP_FAILURE:111,CLIP_HTTP_FAILURE:113,CLIP_FILE_SUCCESS:120,CLIP_FILE_FAILURE:121,CLIP_FILE_HTTP_FAILURE:123,CANCEL_PAGE_CLIP_TIMER:200,AUTOSAVE:212,OPTIONS_UPDATED:320,SEARCH_HELPER_DISABLE:340,CONTENT_SCRIPT_LOAD_TIMEOUT_CANCEL:400,CONTENT_SCRIPT_LOAD_TIMEOUT:401,CONTEXT_PAGE_CLIP_SUCCESS:2100,CONTEXT_PAGE_CLIP_FAILURE:2101,CONTEXT_PAGE_CLIP_CONTENT_SUCCESS:2102,CONTEXT_PAGE_CLIP_CONTENT_FAILURE:2103,CONTEXT_PAGE_CLIP_CONTENT_TOO_BIG:2105,FETCH_STYLE_SHEET_RULES:3001,CLIP_ACTION_FULL_PAGE:4001,CLIP_ACTION_ARTICLE:4002,CLIP_ACTION_SELECTION:4003,CLIP_ACTION_URL:4004,PREVIEW_CLIP_ACTION_CLEAR:4010,PREVIEW_CLIP_ACTION_FULL_PAGE:4011,PREVIEW_CLIP_ACTION_ARTICLE:4012,PREVIEW_CLIP_ACTION_SELECTION:4013,PREVIEW_CLIP_ACTION_URL:4014,PAGE_INFO:5000,PREVIEW_NUDGE:6010,PREVIEW_NUDGE_PREVIOUS_SIBLING:6011,PREVIEW_NUDGE_NEXT_SIBLING:6012,PREVIEW_NUDGE_PARENT:6013,PREVIEW_NUDGE_CHILD:6014};Downsha.Constants.Limits={DSTP_USER_NAME_LEN_MIN:1,DSTP_USER_NAME_LEN_MAX:64,DSTP_USER_NAME_REGEX:"^[a-z0-9]([a-z0-9_-]{0,62}[a-z0-9])?$",DSTP_USER_EMAIL_LEN_MIN:6,DSTP_USER_EMAIL_LEN_MAX:255,DSTP_USER_EMAIL_REGEX:"^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9-]+)*\\.([A-Za-z]{2,})$",DSTP_USER_PWD_LEN_MIN:6,DSTP_USER_PWD_LEN_MAX:64,DSTP_USER_PWD_REGEX:"^[A-Za-z0-9!#$%&'()*+,./:;<=>?@^_`{|}~\\[\\]\\\\-]{6,64}$",EDAM_NOTE_TITLE_LEN_MIN:0,EDAM_NOTE_TITLE_LEN_MAX:255,EDAM_NOTE_TITLE_REGEX:"^$|^[^\\s\\r\\n\\t]([^\\n\\r\\t]{0,253}[^\\s\\r\\n\\t])?$",EDAM_TAG_NAME_LEN_MIN:1,EDAM_TAG_NAME_LEN_MAX:100,EDAM_TAG_NAME_REGEX:"^[^,\\s\\r\\n\\t]([^,\\n\\r\\t]{0,98}[^,\\s\\r\\n\\t])?$",EDAM_NOTE_TAGS_MIN:0,EDAM_NOTE_TAGS_MAX:100,SERVICE_DOMAIN_LEN_MIN:1,SERVICE_DOMAIN_LEN_MAX:256,CLIP_NOTE_CONTENT_LEN_MAX:5242880,EDAM_USER_RECENT_MAILED_ADDRESSES_MAX:10,DSTP_USER_EMAIL_LEN_MIN:6,DSTP_USER_EMAIL_LEN_MAX:255,DSTP_USER_EMAIL_REGEX:"^[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(\\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9-]+)*\\.([A-Za-z]{2,})$"};Downsha.RequestMessage=function RequestMessage(b,a){this.initialize(b,a)};Downsha.RequestMessage.fromObject=function(a){var b=new Downsha.RequestMessage();if(typeof a=="object"&&a!=null){if(typeof a.code!="undefined"){b.code=a.code}if(typeof a.message!="undefined"){b.message=a.message}}return b};Downsha.RequestMessage.prototype._code=0;Downsha.RequestMessage.prototype._message=null;Downsha.RequestMessage.prototype._callback=null;Downsha.RequestMessage.prototype.initialize=function(c,b,a){this.__defineGetter__("code",this.getCode);this.__defineSetter__("code",this.setCode);this.__defineGetter__("message",this.getMessage);this.__defineSetter__("message",this.setMessage);this.__defineGetter__("callback",this.getCallback);this.__defineSetter__("callback",this.setCallback);this.code=c;this.message=b};Downsha.RequestMessage.prototype.getCode=function(){return this._code};Downsha.RequestMessage.prototype.setCode=function(a){this._code=parseInt(a);if(isNaN(this._code)){this._code=0}};Downsha.RequestMessage.prototype.getMessage=function(){return this._message};Downsha.RequestMessage.prototype.setMessage=function(a){this._message=a};Downsha.RequestMessage.prototype.getCallback=function(){return this._callback};Downsha.RequestMessage.prototype.setCallback=function(a){if(typeof a=="function"||a==null){this._callback=a}};Downsha.RequestMessage.prototype.send=function(){chrome.extension.sendRequest({code:this.code,message:this.message})};Downsha.RequestMessage.prototype.isEmpty=function(){return(this.code)?false:true};Downsha.ChromeExtensionLoggerImpl=function ChromeExtensionLoggerImpl(a){this.initialize(a)};Downsha.inherit(Downsha.ChromeExtensionLoggerImpl,Downsha.WebKitLoggerImpl,true);Downsha.ChromeExtensionLoggerImpl.isResponsibleFor=function(a){return(a.userAgent.toLowerCase().indexOf("chrome/")>0)};Downsha.ChromeExtensionLoggerImpl.prototype._enabled=true;(function(){var a=null;var c=false;Downsha.SelectionFinder=function b(d){this.initDocument=d;this.document=d;a=Downsha.Logger.getInstance();if(a.level==Downsha.Logger.LOG_LEVEL_DEBUG){c=true}};Downsha.SelectionFinder.prototype.initDocument=null;Downsha.SelectionFinder.prototype.document=null;Downsha.SelectionFinder.prototype.selection=null;Downsha.SelectionFinder.prototype.findNestedDocuments=function(j){var f=new Array();var k=j.getElementsByTagName("frame");if(k.length>0){for(var d=0;d<k.length;d++){f.push(k[d].contentDocument)}}var h=j.getElementsByTagName("iframe");try{if(h.length>0){for(var d=0;d<h.length;d++){var j=h[d].contentDocument;if(j){f.push(j)}}}}catch(g){}return f};Downsha.SelectionFinder.prototype.reset=function(){this.document=this.initDocument;this.selection=null};Downsha.SelectionFinder.prototype.hasSelection=function(){var d=this.getRange();if(d&&(d.startContainer!=d.endContainer||(d.startContainer==d.endContainer&&d.startOffset!=d.endOffset))){return true}return false};Downsha.SelectionFinder.prototype.find=function(d){var e=this._findSelectionInDocument(this.document,d);this.document=e.document;this.selection=e.selection};Downsha.SelectionFinder.prototype.getRange=function(){if(!this.selection||this.selection.rangeCount==0){return null}if(typeof this.selection.getRangeAt=="function"){return this.selection.getRangeAt(0)}else{var d=this.document.createRange();d.setStart(this.selection.anchorNode,this.selection.anchorOffset);d.setEnd(this.selection.focusNode,this.selection.focusOffset);return d}return null};Downsha.SelectionFinder.prototype.getCommonAncestorContainer=function(){var d=this.getRange();if(d&&d.commonAncestorContainer){var e=d.commonAncestorContainer;while(e&&e.nodeType!=Node.ELEMENT_NODE){e=e.parentElement}return e}return null};Downsha.SelectionFinder.prototype._findSelectionInDocument=function(h,e){var g=null;if(typeof h.getSelection=="function"){g=h.getSelection()}else{if(h.selection&&typeof h.selection.createRange=="function"){g=h.selection.createRange()}}if(g&&g.rangeCount==0&&e){if(c){a.debug("Empty range, trying frames")}var j=this.findNestedDocuments(h);if(c){a.debug("# of nested docs: "+j.length)}if(j.length>0){for(var f=0;f<j.length;f++){if(j[f]){if(c){a.debug("Trying nested doc: "+j[f])}var d=this._findSelectionInDocument(j[f],e);if(d.selection.rangeCount>0){return d}}}}}return{document:h,selection:g}}})();Downsha.Utils=Downsha.Utils||new function Utils(){};Downsha.Utils.MESSAGE_ATTR="message";Downsha.Utils.PLACEHOLDER_ATTR="placeholder";Downsha.Utils.TITLE_ATTR="title";Downsha.Utils.MESSAGE_DATA_ATTR="messagedata";Downsha.Utils.LOCALIZED_ATTR="localized";Downsha.Utils.BADGE_NORMAL_COLOR=[255,0,0,255];Downsha.Utils.BADGE_UPLOADING_COLOR=[255,255,0,255];Downsha.Utils.updateBadge=function(d,b){var a=Downsha.chromeExtension.logger;a.debug("Utils.updateBadge");var c=null;if(d){if(d.clipProcessor.length>0){Downsha.Utils.setBadgeBackgroundColor(Downsha.Utils.BADGE_UPLOADING_COLOR,b);a.debug("Badge indicates pending notes: "+d.clipProcessor.length);Downsha.Utils.setBadgeText(d.clipProcessor.length,b);Downsha.Utils.setBadgeTitle(chrome.i18n.getMessage("BrowserActionTitlePending"),b)}else{if(typeof b=="number"&&chrome.extension&&typeof chrome.extension.getBackgroundPage().Downsha.SearchHelper!="undefined"&&(c=chrome.extension.getBackgroundPage().Downsha.SearchHelper.getInstance(b))&&c&&c.hasResults()){Downsha.Utils.setBadgeBackgroundColor(Downsha.Utils.BADGE_NORMAL_COLOR,b);a.debug("Badge indicates simsearch results: "+c.result.totalNotes);Downsha.Utils.setBadgeText(c.result.totalNotes,b);Downsha.Utils.setBadgeTitle(chrome.i18n.getMessage("BrowserActionTitle"),b)}else{a.debug("Clearing badge for there's nothing interesting to show");Downsha.Utils.clearBadge(b);Downsha.Utils.setBadgeTitle(chrome.i18n.getMessage("BrowserActionTitle"),b)}}}};Downsha.Utils.clearBadge=function(a){var b={text:""};if(typeof a=="number"){b.tabId=a;chrome.browserAction.setBadgeText(b)}else{this.clearAllBadges()}};Downsha.Utils.clearAllBadges=function(){this.doInEveryNormalTab(function(a){chrome.browserAction.setBadgeText({tabId:a.id,text:""})},true)};Downsha.Utils.setBadgeBackgroundColor=function(a,b){var c={color:a};if(typeof b=="number"){c.tabId=b;chrome.browserAction.setBadgeBackgroundColor(c)}else{this.doInEveryNormalTab(function(d){c.tabId=d.id;chrome.browserAction.setBadgeBackgroundColor(c)},true)}};Downsha.Utils.setBadgeText=function(a,b){if(a){var c={text:""+a};if(typeof b=="number"){c.tabId=b;chrome.browserAction.setBadgeText(c)}else{this.doInEveryNormalTab(function(d){c.tabId=d.id;chrome.browserAction.setBadgeText(c)},true)}}else{if(a==null){Downsha.Utils.clearBadge(b)}}};Downsha.Utils.setBadgeTitle=function(c,a){if(c){var b={title:""+c};if(typeof a=="number"){b.tabId=a;chrome.browserAction.setTitle(b)}else{this.doInEveryNormalTab(function(d){b.tabId=d.id;chrome.browserAction.setTitle(b)},true)}}else{if(c==null){Downsha.Utils.clearBadgeTitle(a)}}};Downsha.Utils.clearBadgeTitle=function(a){var b={title:""};if(typeof a=="number"){b.tabId=a;chrome.browserAction.setTitle(b)}else{this.doInEveryNormalTab(function(c){b.tabId=c.id;chrome.browserAction.setTitle(b)},true)}};Downsha.Utils.doInEveryNormalTab=function(b,a){chrome.windows.getAll({populate:true},function(e){for(var c=0;c<e.length;c++){if(e[c].type=="normal"){for(var d=0;d<e[c].tabs.length;d++){if(!a||e[c].tabs[d].selected){b(e[c].tabs[d],e[c])}}}}})};Downsha.Utils.localizeBlock=function(d){if(d.attr(Downsha.Utils.MESSAGE_ATTR)){Downsha.Utils.localizeElement(d)}var c=d.find("["+Downsha.Utils.MESSAGE_ATTR+"], ["+Downsha.Utils.PLACEHOLDER_ATTR+"], ["+Downsha.Utils.TITLE_ATTR+"]");for(var a=0;a<c.length;a++){var b=$(c.get(a));Downsha.Utils.localizeElement(b)}};Downsha.Utils.extractLocalizationField=function(a){if(typeof a.attr=="function"&&a.attr(Downsha.Utils.MESSAGE_ATTR)){return a.attr(Downsha.Utils.MESSAGE_ATTR)}else{return null}};Downsha.Utils.extractLocalizationDataField=function(element){if(typeof element.attr=="function"&&element.attr(Downsha.Utils.MESSAGE_DATA_ATTR)){var v=element.attr(Downsha.Utils.MESSAGE_DATA_ATTR);try{v=eval(v)}catch(e){}if(!(v instanceof Array)){v=[v]}return v}else{return null}};Downsha.Utils.extractLocalizationPlaceholderField=function(a){if(typeof a.attr=="function"&&a.attr(Downsha.Utils.PLACEHOLDER_ATTR)){return a.attr(Downsha.Utils.PLACEHOLDER_ATTR)}else{return null}};Downsha.Utils.extractLocalizationTitleField=function(a){if(typeof a.attr=="function"&&a.attr(Downsha.Utils.TITLE_ATTR)){return a.attr(Downsha.Utils.TITLE_ATTR)}else{return null}};Downsha.Utils.localizeElement=function(d,f){if(!f&&d.attr(Downsha.Utils.LOCALIZED_ATTR)&&d.attr(Downsha.Utils.LOCALIZED_ATTR=="true")){return}var g=Downsha.Utils.extractLocalizationField(d);var e=Downsha.Utils.extractLocalizationPlaceholderField(d);var a=Downsha.Utils.extractLocalizationTitleField(d);var b=Downsha.Utils.extractLocalizationDataField(d);var c=false;if(g){if(b){var h=chrome.i18n.getMessage(g,b)}else{var h=chrome.i18n.getMessage(g)}if(d.attr("tagName")=="INPUT"){d.val(h)}else{d.html(h)}c=true}if(e){var h=chrome.i18n.getMessage(e);d.attr(Downsha.Utils.PLACEHOLDER_ATTR,h);c=true}if(a){var h=chrome.i18n.getMessage(a);d.attr(Downsha.Utils.TITLE_ATTR,h);c=true}if(c){d.attr(Downsha.Utils.LOCALIZED_ATTR,"true")}};Downsha.Utils.notifyExtension=function(a,b){chrome.windows.getCurrent(function(c){chrome.tabs.getSelected(c.id,function(e){var f={tab:e,id:chrome.i18n.getMessage("@@extension_id")};var d=b||function(){};chrome.extension.onRequest.dispatch(a,f,d);chrome.extension.sendRequest(a,d)})})};Downsha.Utils._setDesktopNotificationAttributes=function(c,a){if(c&&typeof a=="object"&&a){for(var b in a){c[b]=a[b]}}};Downsha.Utils.notifyDesktop=function(e,b,c,a){var d=webkitNotifications.createNotification("images/en_app_icon-48.png",e,b);this._setDesktopNotificationAttributes(d,a);d.show();if(typeof c=="number"){setTimeout(function(){d.cancel()},c)}return d};Downsha.Utils.notifyDesktopWithHTML=function(b,c,a){var d=webkitNotifications.createHTMLNotification(b);this._setDesktopNotificationAttributes(d,a);d.show();if(typeof c=="number"){setTimeout(function(){d.cancel()},c)}return d};Downsha.Utils.openWindow=function(a){var b=chrome.extension.getBackgroundPage();b.Downsha.chromeExtension.openWindow(a)};Downsha.Utils.getPostData=function(j){if(typeof j=="undefined"){j=window.location.search.replace(/^\?/,"")}var a={};if(j){var h=j.split("&");for(var d=0;d<h.length;d++){var f=h[d].split("=");var c=unescape(f[0]);var b=(f[1])?unescape(f[1]):null;if(b){try{a[c]=JSON.parse(b)}catch(g){a[c]=b}}else{a[c]=b}}}return a};Downsha.Utils.getLocalizedMessage=function(a,b){if(typeof chrome!="undefined"&&typeof chrome.i18n.getMessage=="function"){return chrome.i18n.getMessage(a,b)}else{return a}};Downsha.Utils.extractHttpErrorMessage=function(c,d,a){if(this.quiet){return}if(c.readyState==4){var b=this.getLocalizedMessage("Error_HTTP_Transport",[(""+c.status),((typeof a=="string")?a:"")])}else{var b=this.getLocalizedMessage("Error_HTTP_Transport",[("readyState: "+c.readyState),""])}return b};Downsha.Utils.extractErrorMessage=function(b,a){var c=(typeof a!="undefined")?a:null;if(b instanceof Downsha.DownshaError&&typeof b.errorCode=="number"&&typeof b.parameter=="string"&&this.getLocalizedMessage("EDAMError_"+b.errorCode+"_"+b.parameter.replace(/[^a-zA-Z0-9_]+/g,"_"))){c=this.getLocalizedMessage("EDAMError_"+b.errorCode+"_"+b.parameter.replace(/[^a-zA-Z0-9_]+/g,"_"))}else{if(b instanceof Downsha.EDAMResponseException&&typeof b.errorCode=="number"&&this.getLocalizedMessage("EDAMResponseError_"+b.errorCode)){if(typeof b.parameter=="string"){c=this.getLocalizedMessage("EDAMResponseError_"+b.errorCode,b.parameter)}else{c=this.getLocalizedMessage("EDAMResponseError_"+b.errorCode)}}else{if(b instanceof Downsha.DownshaError&&typeof b.errorCode=="number"&&this.getLocalizedMessage("EDAMError_"+b.errorCode)){if(typeof b.parameter=="string"){c=this.getLocalizedMessage("EDAMError_"+b.errorCode,b.parameter)}else{c=this.getLocalizedMessage("EDAMError_"+b.errorCode)}}else{if(b instanceof Downsha.DownshaError&&typeof b.message=="string"){c=b.message}else{if((b instanceof Error||b instanceof Error)&&typeof b.message=="string"){c=b.message}else{if(typeof b=="string"){c=b}}}}}}return c};Downsha.Utils.isForbiddenUrl=function(a){if(typeof a=="string"&&(a.toLowerCase().indexOf("chrome.google.com/extensions")>=0||a.toLowerCase().indexOf("chrome.google.com/webstore")>=0)){return true}if(typeof a=="string"&&!a.toLowerCase().match(/^https?:\/\//)){return true}return false};Downsha.Utils.getTextSize=function(c){var b=$("<div></div>");b.text(c);b.css({position:"absolute",top:"0px",left:"0px",padding:"0px",margin:"0px",display:"block",zIndex:"0",color:"rgba(0, 0, 0, 0)",background:"rgba(0, 0, 0, 0)"});$("body").append(b);var a={width:b.width(),height:b.height()};b.remove();return a};Downsha.Utils.updateSelectElementWidth=function(b,e){var i=(b instanceof jQuery)?b:$(b);var c=i.val();if(typeof e=="function"){c=e(c)}var a=parseInt(i.css("paddingLeft"));var h=parseInt(i.css("paddingRight"));var g=((!isNaN(a))?a:0)+((!isNaN(h))?h:0);var f=Downsha.Utils.getTextSize(c).width;f=(f)?f:0;var d=f+g;d+=10;i.css({minWidth:d+"px",width:d+"px"})};Downsha.Utils.resizeElement=function(b,j,g){var k=(b instanceof jQuery)?b:$(b);var f={};var i={};if(j&&typeof j.width=="number"){var a=parseInt(k.css("paddingLeft"));var h=parseInt(k.css("paddingRight"));var e=((!isNaN(a))?a:0)+((!isNaN(h))?h:0);i.width=(j.width+e);f.minWidth=i.width+"px";f.width=i.width+"px"}if(j&&typeof j.height=="number"){var c=parseInt(k.css("paddingTop"));var d=parseInt(k.css("paddingBottom"));var e=((!isNaN(c))?c:0)+((!isNaN(d))?d:0);i.height=j.height+e;f.minHeight=i.height+"px";css.height=i.height+"px"}k.css(f);if(typeof g=="function"){g(k,i)}};Downsha.Utils.BAD_FAV_ICON_URLS=["http://localhost/favicon.ico"];Downsha.Utils.createUrlClipContent=function(g,c,f){var b=(g)?Downsha.Utils.escapeXML(g):"";var d="font-size: 12pt; line-height: 18px; display: inline;";var e='<a title="'+b+'" style="'+d+'" href="'+c+'">'+c+"</a>";if(typeof f=="string"&&f.length>0&&Downsha.Utils.BAD_FAV_ICON_URLS.indexOf(f.toLowerCase())<0){var a="display:inline;border: none; width: 16px; height: 16px; padding: 0px; margin: 0px 8px -2px 0px;";e='<span><img title="'+b+'" style="'+a+'" src="'+f+'"/>'+e+"</span>"}else{e="<span>"+e+"</span>"}return e};(function(){var a=null;Downsha.AbstractContentScript=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.AbstractContentScript.prototype.initialize=function(){var b=this.getInitialStyleSheetUrls();if(b&&b.length>0){this.injectStyleSheets(b)}};Downsha.AbstractContentScript.prototype.getInitialStyleSheetUrls=function(){return[]};Downsha.AbstractContentScript.prototype.injectStyleSheets=function(f){for(var d=0;d<f.length;d++){var b=f[d];var e=document.createElement("link");e.setAttribute("rel","stylesheet");e.setAttribute("type","text/css");e.setAttribute("href",b);var c=document.head||document.body;if(!c){c=document.documentElement}c.appendChild(e)}}})();(function(){var a=null;Downsha.PageInfoScript=function b(c){a=Downsha.Logger.getInstance();this.initialize(c)};Downsha.inherit(Downsha.PageInfoScript,Downsha.AbstractContentScript);Downsha.PageInfoScript._instance=null;Downsha.PageInfoScript.getInstance=function(){if(!this._instance){this._instance=new Downsha.PageInfoScript()}return this._instance};Downsha.PageInfoScript.removeInstance=function(){this._instance=null};Downsha.PageInfoScript.prototype.window=null;Downsha.PageInfoScript.prototype.initialize=function(c){this.window=(c)?c:window;Downsha.PageInfoScript.parent.initialize.apply(this,[])};Downsha.PageInfoScript.prototype.profile=function(){a.debug("PageInfoScript.profile");this.profilePage();this.profileSelection();this.profileArticle();this.notifyWithPageInfo()};Downsha.PageInfoScript.prototype.profilePage=function(){this.documentWidth=this.window.document.width;this.documentHeight=this.window.document.height;this.documentLength=0;try{this.documentLength=this.window.document.body.textContent.length}catch(c){a.warn("Could not determine document's text length")}this.containsImages=false;try{var d=this.window.document.getElementsByTagName("IMG");if(d&&d.length>0){this.containsImages=true}}catch(c){a.warn("Could not determine whether document contains images")}};Downsha.PageInfoScript.prototype.profileSelection=function(){a.debug("PageInfoScript.profileSelection");var c=new Downsha.SelectionFinder(this.window.document);c.find(true);this.selection=(c.hasSelection())?true:false};Downsha.PageInfoScript.prototype.profileArticle=function(){a.debug("PageInfoScript.profileArticle");var d=new ExtractContentJS.LayeredExtractor();d.addHandler(d.factory.getHandler("Heuristics"));var c=d.extract(document);if(c.isSuccess){this.article=c.content.asText();if(c.content.asNode()){var e=Downsha.Utils.getAbsoluteBoundingClientRect(c.content.asNode());if(e){this.articleBoundingClientRect=e}}}};Downsha.PageInfoScript.prototype.notifyWithPageInfo=function(){chrome.extension.sendRequest(new Downsha.RequestMessage(Downsha.Constants.RequestType.PAGE_INFO,{pageInfo:this}))};Downsha.PageInfoScript.prototype.toJSON=function(){return{documentWidth:this.documentWidth,documentHeight:this.documentHeight,documentLength:this.documentLength,containsImages:this.containsImages,selection:this.selection,article:this.article,articleBoundingClientRect:this.articleBoundingClientRect}}})();if(typeof ExtractContentJS=="undefined"){var ExtractContentJS={}}if(typeof ExtractContentJS.Lib=="undefined"){ExtractContentJS.Lib={}}ExtractContentJS.Lib.Util=(function(){var a={};a.BenchmarkTimer=function(){var c=function(){var f=new Date();var e=0;e=f.getHours();e=e*60+f.getMinutes();e=e*60+f.getSeconds();e=e*1000+f.getMilliseconds();return e};var d=function(){var e={elapsed:0};e.reset=function(){e.elapsed=0;return e};e.start=function(){e.msec=c();return e};e.stop=function(){e.elapsed+=c()-e.msec;return e};return e.start()};var b={timers:{}};b.get=function(e){if(!b.timers[e]){b.timers[e]=new d()}return b.timers[e]};b.reset=function(e){return b.get(e).reset()};b.start=function(e){return b.get(e).start()};b.stop=function(e){return b.get(e).stop()};return b};a.Token=function(e){var d={hiragana:/[\u3042-\u3093\u304C-\u307C\u3041-\u3087\u308E\u3063\u30FC]/,katakana:/[\u30A2-\u30F3\u30AC-\u30DC\u30A1-\u30E7\u30EE\u30C3\u30FC]/,kanji:{test:function(f){return"\u4E00"<=f&&f<="\u9FA0"||f==="\u3005"}},alphabet:/[a-zA-Z]/,digit:/[0-9]/};var c=function(f){var g={};for(var h in d){if(d[h].test(f)){g[h]=d[h]}}return g};var b={first:c(e.charAt(0)),last:c(e.charAt(e.length-1))};b.isTokenized=function(h,g){var i=h.length?h.charAt(h.length-1):"";var j=g.length?g.charAt(0):"";var f=function(k,m){if(k.length){for(var l in m){if(m[l].test(k)){return false}}}return true};return f(i,b.first)&&f(j,b.last)};return b};a.inherit=function(e,b){var c=e||{};for(var d in b){if(typeof c[d]=="undefined"){c[d]=b[d]}}return c};a.countMatch=function(c,b){return c.split(b).length-1};a.countMatchTokenized=function(j,h){var f=0;var e=null;var c=new a.Token(h);var g=j.split(h);var b=g.length;for(var d=0;d<b;d++){if(e&&c.isTokenized(e,g[d])){f++}e=g[d]}return f};a.indexOfTokenized=function(f,e){var c=f.indexOf(e);if(c>=0){var b=new a.Token(e);var d=c>1?f.substr(c-1,1):"";var g=f.substr(c+e.length,1);if(b.isTokenized(d,g)){return c}}return -1};a.dump=function(c){if(typeof c=="undefined"){return"undefined"}if(typeof c=="string"){return'"'+c+'"'}if(typeof c!="object"){return""+c}if(c===null){return"null"}if(c instanceof Array){return"["+c.map(function(e){return"obj"}).join(",")+"]"}else{var b=[];for(var d in c){b.push(d+":obj")}return"{"+b.join(",")+"}"}};return a})();ExtractContentJS.Lib.A=(function(){var a={};a.indexOf=Array.indexOf||function(d,e){var c=2;var b=d.length;var f=Number(arguments[c++])||0;f=(f<0)?Math.ceil(f):Math.floor(f);if(f<0){f+=b}for(;f<b;f++){if(f in d&&d[f]===e){return f}}return -1};a.filter=Array.filter||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw new TypeError("A.filter: not a function")}var j=new Array();var g=arguments[d++];for(var f=0;f<b;f++){if(f in e){var h=e[f];if(c.call(g,h,f,e)){j.push(h)}}}return j};a.forEach=Array.forEach||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw new TypeError("A.forEach: not a function")}var g=arguments[d++];for(var f=0;f<b;f++){if(f in e){c.call(g,e[f],f,e)}}};a.every=Array.every||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw new TypeError("A.every: not a function")}var g=arguments[d++];for(var f=0;f<b;f++){if(f in e&&!c.call(g,e[f],f,e)){return false}}return true};a.map=Array.map||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw new TypeError("A.map: not a function")}var h=new Array(b);var g=arguments[d++];for(var f=0;f<b;f++){if(f in e){h[f]=c.call(g,e[f],f,e)}}return h};a.some=Array.some||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw new TypeError("A.some: not a function")}var g=arguments[d++];for(var f=0;f<b;f++){if(f in e&&c.call(g,e[f],f,e)){return true}}return false};a.reduce=Array.reduce||function(e,c){var d=2;var b=e.length;if(typeof c!="function"){throw TypeError("A.reduce: not a function ")}var f=0;var g;if(arguments.length>d){var h=arguments[d++]}else{do{if(f in e){h=e[f++];break}if(++f>=b){throw new TypeError("A.reduce: empty array")}}while(true)}for(;f<b;f++){if(f in e){h=c.call(null,h,e[f],f,e)}}return h};a.zip=function(d){if(d[0] instanceof Array){var c=d[0].length;var b=d.length;var g=new Array(c);for(var f=0;f<c;f++){g[f]=[];for(var e=0;e<b;e++){g[f].push(d[e][f])}}return g}return[]};a.first=function(b){return b?b[0]:null};a.last=function(b){return b?b[b.length-1]:null};a.push=function(c,b){return Array.prototype.push.apply(c,b)};return a})();ExtractContentJS.Lib.DOM=(function(){var a=ExtractContentJS.Lib.A;var b={};b.getElementStyle=function(g,i){var d=g.style?g.style[i]:null;if(!d){var c=g.ownerDocument.defaultView;if(c&&c.getComputedStyle){try{var f=c.getComputedStyle(g,null)}catch(h){return null}i=i.replace(/([A-Z])/g,"-$1").toLowerCase();d=f?f.getPropertyValue(i):null}else{if(g.currentStyle){d=g.currentStyle[i]}}}return d};b.text=function(c){if(typeof c.textContent!="undefined"){return c.textContent}else{if(c.nodeName=="#text"){return c.nodeValue}else{if(typeof c.innerText!="undefined"){return c.innerText}}}return null};b.ancestors=function(g){var c=g.ownerDocument.body;var f=[];var d=g;while(d!=c){f.push(d);d=d.parentNode}f.push(c);return f};b.commonAncestor=function(h,g){var d=b.ancestors(h).reverse();var c=b.ancestors(g).reverse();var f=null;for(var e=0;d[e]&&c[e]&&d[e]==c[e];e++){f=d[e]}return f};b.countMatchTagAttr=function(e,l,j,g){var k=function(i){return i.test(e[j])};if((e.tagName||"").toLowerCase()==l&&a.some(g,k)){return 1}var d=0;var c=e.childNodes;for(var f=0,h=c.length;f<h;f++){d+=b.countMatchTagAttr(c[f],l,j,g)}return d};b.matchTag=function(d,c){return a.some(c,function(e){if(typeof e=="string"){return e==(d.tagName||"").toLowerCase()}else{if(e instanceof Array){return e[0]==(d.tagName||"").toLowerCase()&&b.matchAttr(d,e[1])}else{return false}}})};b.matchAttr=function(f,e){var h=function(i,j){if(typeof i=="string"){return i==j}else{if(i instanceof RegExp){return i.test(j)}else{if(i instanceof Array){return a.some(i,function(m){return h(m,j)})}else{if(i instanceof Object){for(var l in i){var k=f[l];if(k&&b.matchAttr(k,i[l])){return true}}}}}}return false};for(var g in e){var c=f[g];var d=e[g];if(c){return h(d,c)}}return false};b.matchStyle=function(d,c){var f=function(g,h){if(typeof g=="string"){return g==h}else{if(g instanceof RegExp){return g.test(h)}else{if(g instanceof Array){return a.some(g,function(i){return f(i,h)})}}}return false};for(var e in c){if(f(c[e],b.getElementStyle(d,e))){return true}}return false};return b})();if(typeof ExtractContentJS=="undefined"){var ExtractContentJS={}}(function(d){var g=d.Lib.Util;var a=d.Lib.A;var e=d.Lib.DOM;var f=g.inherit(function(k){var l=arguments[1]||0;var h=arguments[2]||{};var j=arguments[3]||1048576;var i={node:k,depth:l,inside:h};i.statistics=function(){var n=(e.text(k)||"").replace(/\s+/g," ");var m=n.length;return{text:n.substr(0,j),noLinkText:(h.link||h.form)?"":n,listTextLength:h.list?m:0,noListTextLength:h.list?0:m,linkCount:h.link?1:0,listCount:h.li?1:0,linkListCount:(h.li&&h.link)?1:0}};return i},{commonAncestor:function(){var h=a.map(arguments,function(i){return i.node});if(h.length<2){return h[0]}return a.reduce(h,function(i,j){return e.commonAncestor(i,j)})},mergeStatistics:function(i,h){var j={};for(var k in i){j[k]=i[k]+h[k]}return j}});var c=function(i){i=a.filter(i,function(j){var k=e.text(j.node)||"";k=k.replace(/\s+/g,"");return k.length!=0});var h={score:0,leaves:i};h.commonAncestor=function(){return f.commonAncestor.apply(null,h.leaves)};return h};var b=function(i){var h={_content:i};h.asLeaves=function(){return h._content};h.asNode=function(){if(h._node){return h._node}h._node=f.commonAncestor.apply(null,h._content);return h._node};h.asTextFragment=function(){if(h._textFragment){return h._textFragment}if(h._content.length<1){return""}h._textFragment=a.reduce(h._content,function(k,l){var j=e.text(l.node);j=j.replace(/^\s+/g,"").replace(/\s+$/g,"");j=j.replace(/\s+/g," ");return k+j},"");return h._textFragment};h.asText=function(){if(h._text){return h._text}var j=h.asNode();h._text=j?e.text(j):"";return h._text};h.toString=function(){return h.asTextFragment()};return h};d.LayeredExtractor=function(){var h={handler:arguments[0]||[],filter:arguments[1]||{}};h.factory={getHandler:function(i){if(typeof d.LayeredExtractor.Handler!="undefined"){return new d.LayeredExtractor.Handler[i]}return null}};h.addHandler=function(i){if(typeof i!="undefined"){h.handler.push(i)}return h};h.filterFor=function(i){};h.extract=function(p){var k=p.location.href;var m={title:p.title,url:p.location.href};var j=h.handler.length;for(var l=0;l<j;l++){var n=h.handler[l].extract(p,k,m);if(!n){continue}var o=h.filterFor(k);if(o){n=o.filter(n)}n=new b(n);if(!n.toString().length){continue}m.content=n;m.isSuccess=true;m.engine=m.engine||h.handler[l];break}return m};return h};d.LayeredExtractor.Handler={};d.LayeredExtractor.Handler.Heuristics=function(){var h={name:"Heuristics",content:[],opt:g.inherit(arguments[0],{threshold:60,minLength:30,factor:{decay:0.75,noBody:0.72,continuous:1.16},punctuationWeight:10,minNoLink:8,noListRatio:0.2,limit:{leaves:800,recursion:20,text:1048576},debug:false}),pat:g.inherit(arguments[1],{sep:["div","center","td","h1","h2"],waste:[/Copyright|All\s*Rights?\s*Reserved?/i],affiliate:[/amazon[a-z0-9\.\/\-\?&]+-22/i],list:["ul","dl","ol"],li:["li","dd"],a:["a"],form:["form"],noContent:["frameset"],ignore:["iframe","img","script","style","select","noscript",["div",{id:[/more/,/menu/,/side/,/navi/],className:[/more/,/menu/,/side/,/navi/]}]],ignoreStyle:{display:"none",visibility:"hidden"},punctuations:/[\u3002\u3001\uFF0E\uFF0C\uFF01\uFF1F]|\.[^A-Za-z0-9]|,[^0-9]|!|\?/})};var i=g.inherit(function(k){var j=new c(k);j.eliminateLinks=function(){var n=a.map(j.leaves,function(r){return r.statistics()});if(!n.length){return""}if(n.length==1){n=n[0]}else{n=a.reduce(n,function(r,s){return f.mergeStatistics(r,s)})}var q=n.noLinkText.length;var m=n.linkCount;var p=n.listTextLength;if(q<h.opt.minNoLink*m){return""}var o=n.linkListCount/(n.listCount||1);o*=o;var l=h.opt.noListRatio*o*p;if(q<l){return""}return n.noLinkText};j.noBodyRate=function(){var l=0;if(j.leaves.length>0){l+=a.reduce(j.leaves,function(m,n){return m+e.countMatchTagAttr(n.node,"a","href",h.pat.affiliate)},0)}l/=2;l+=a.reduce(h.pat.waste,function(m,n){return m+g.countMatch(j._nolink,n)},0);return l};j.calcScore=function(l,m){j._nolink=j.eliminateLinks();if(j._nolink.length<h.opt.minLength){return 0}var o=g.countMatch(j._nolink,h.pat.punctuations);o*=h.opt.punctuationWeight;o+=j._nolink.length;o*=l;var n=j.noBodyRate();o*=Math.pow(h.opt.factor.noBody,n);j._c=j.score=o;j._c1=o*m;return o};j.isAccepted=function(){return j._c>h.opt.threshold};j.isContinuous=function(){return j._c1>h.opt.threshold};j.merge=function(l){j.score+=l._c1;j.depth=Math.min(j.depth,l.depth);a.push(j.leaves,l.leaves);return j};return j},{split:function(n){var m=[];var l=[];var p=0;var k=h.opt.limit.text;var j=function(q){if(q&&l.length){m.push(new i(l));l=[]}};var o=function(s,u,t){if(p>=h.opt.limit.leaves){return m}if(u>=h.opt.limit.recursion){return m}if(s.nodeName=="#comment"){return m}if(e.matchTag(s,h.pat.ignore)){return m}if(e.matchStyle(s,h.pat.ignoreStyle)){return m}var q=s.childNodes;var z=h.pat.sep;var x=q.length;var r={form:t.form||e.matchTag(s,h.pat.form),link:t.link||e.matchTag(s,h.pat.a),list:t.list||e.matchTag(s,h.pat.list),li:t.li||e.matchTag(s,h.pat.li)};for(var v=0;v<x;v++){var y=q[v];var w=e.matchTag(y,z);j(w);o(y,u+1,r);j(w)}if(!x){p++;l.push(new f(s,u,r,k))}return m};o(n,0,{});j(true);return m}});h.extract=function(q){var u=function(w){return q.getElementsByTagName(w).length!=0};if(a.some(h.pat.noContent,u)){return h}var s=1;var o=1;var k=0;var r=[];var j=i.split(q.body);var t;var p=j.length;for(var n=0;n<p;n++){var m=j[n];if(t){o/=h.opt.factor.continuous}if(!m.calcScore(s,o)){continue}s*=h.opt.factor.decay;if(m.isAccepted()){if(m.isContinuous()&&t){t.merge(m)}else{t=m;r.push(m)}o=h.opt.factor.continuous}else{if(!t){s=1}}}h.blocks=r.sort(function(w,v){return v.score-w.score});var l=a.first(h.blocks);if(l){h.content=l.leaves}return h.content};return h};d.LayeredExtractor.Handler.GoogleAdSection=function(){var h={name:"GoogleAdSection",content:[],state:[],opt:g.inherit(arguments[0],{limit:{leaves:800,recursion:20},debug:false})};var i={ignore:/google_ad_section_start\(weight=ignore\)/i,section:/google_ad_section_start/i,end:/google_ad_section_end/i};var k=1;var j=2;h.inSection=function(){return a.last(h.state)==j};h.ignore=function(){h.state.push(k)};h.section=function(){h.state.push(j)};h.end=function(){if(h.state.length){h.state.pop()}};h.parse=function(o){var p=arguments[1]||0;if(o.nodeName=="#comment"){if(i.ignore.test(o.nodeValue)){h.ignore()}else{if(i.section.test(o.nodeValue)){h.section()}else{if(i.end.test(o.nodeValue)){h.end()}}}return}if(h.content.length>=h.opt.limit.leaves){return}if(p>=h.opt.limit.recursion){return}var n=o.childNodes;var l=n.length;for(var m=0;m<l;m++){var q=n[m];h.parse(q,p+1)}if(!l&&h.inSection()){h.content.push(new f(o,p))}return};h.extract=function(l){h.parse(l);h.blocks=[new c(h.content)];return h.content};return h}})(ExtractContentJS);