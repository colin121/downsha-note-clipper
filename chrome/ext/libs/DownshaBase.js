var Downsha=Downsha||{};Downsha.inherit=function(a,b,c){"function"==typeof b.constructor?(a.prototype=new b,a.prototype.constructor=a,a.parent=b.prototype):(a.prototype=b,a.prototype.constructor=a,a.parent=b);if(c)for(var d in b.prototype.constructor)"parent"!=d&&"prototype"!=d&&"javaClass"!=d&&b.constructor[d]!=b.prototype.constructor[d]&&(a.prototype.constructor[d]=b.prototype.constructor[d]);"function"==typeof a.prototype.handleInheritance&&a.prototype.handleInheritance.apply(a,[a,b,c])};
Downsha.inherits=function(a,b){for(var c=a;c&&"undefined"!=typeof c.parent;){if(c.parent.constructor==b)return!0;c=c.parent.constructor}return!1};Downsha.mixin=function(a,b,c){var a="function"==typeof a?a.prototype:a,d;for(d in b.prototype){var e=to=d;"object"==typeof c&&c&&"undefined"!=typeof c[d]&&(to=c[d]);a[to]=b.prototype[e]}};
Downsha.extendObject=function(a,b,c){if("object"==typeof b&&null!=b)for(var d in b)if(c&&"object"==typeof b[d]&&null!=b[d]&&"object"==typeof a[d]&&null!=a[d])Downsha.extendObject(a[d],b[d],c);else try{a[d]=b[d]}catch(e){}};Downsha.hasOwnProperty=function(a,b){if("object"==typeof a){if(a.hasOwnProperty(b))return!0;for(var c=null,c=a;c=c.__proto__;)if(c.hasOwnProperty(b))return!0}return!1};Downsha.DefiningMixin=function(){};
Downsha.DefiningMixin._getTargetFor=function(a){return"function"==typeof a&&a==a.prototype.constructor?a.prototype:a};Downsha.DefiningMixin.prototype.__defineBoolean__=function(a,b,c,d){var e="_"+a,f=a.substring(0,1).toUpperCase()+a.substring(1),g=Downsha.DefiningMixin._getTargetFor(arguments.callee.caller);g[e]=b?!0:!1;if(!c){var h="is"+f;g[h]=function(){return this[e]};this.__defineGetter__(a,g[h])}d||(f="set"+f,g[f]=function(a){this[e]=a?!0:!1},this.__defineSetter__(a,g[f]))};
Downsha.DefiningMixin.prototype.__defineFloat__=function(a,b,c,d){this._createNumericDefinition_(Downsha.DefiningMixin._getTargetFor(arguments.callee.caller),a,b,!1,parseFloat,c,d)};Downsha.DefiningMixin.prototype.__definePositiveFloat__=function(a,b,c,d){this._createNumericDefinition_(Downsha.DefiningMixin._getTargetFor(arguments.callee.caller),a,b,!0,parseFloat,c,d)};
Downsha.DefiningMixin.prototype.__defineInteger__=function(a,b,c,d){this._createNumericDefinition_(Downsha.DefiningMixin._getTargetFor(arguments.callee.caller),a,b,!1,parseInt,c,d)};Downsha.DefiningMixin.prototype.__definePositiveInteger__=function(a,b,c,d){this._createNumericDefinition_(Downsha.DefiningMixin._getTargetFor(arguments.callee.caller),a,b,!0,parseInt,c,d)};
Downsha.DefiningMixin.prototype._createNumericDefinition_=function(a,b,c,d,e,f,g){var h=b.substring(0,1).toUpperCase()+b.substring(1),i="_"+b,c="number"==typeof c?c:null;a||(a=this);a[i]=c;f||(f="get"+h,a[f]=function(){return this[i]},this.__defineGetter__(b,a[f]));g||(g="set"+h,a[g]=d?function(a){this[i]=e(a);if(isNaN(this[i])||this[i]<0)this[i]=c}:function(a){this[i]=e(a);isNaN(this[i])&&(this[i]=c)},this.__defineSetter__(b,a[g]))};
Downsha.DefiningMixin.prototype.__defineString__=function(a,b,c,d){var b=b?b:null,e=a.substring(0,1).toUpperCase()+a.substring(1),f="_"+a,g=Downsha.DefiningMixin._getTargetFor(arguments.callee.caller);g[f]=b;if(!c){var h="get"+e;g[h]=function(){return this[f]};this.__defineGetter__(a,g[h])}d||(e="set"+e,g[e]=function(a){this[f]="string"==typeof a?a:a?""+a:b},this.__defineSetter__(a,g[e]))};
Downsha.DefiningMixin.prototype.__defineType__=function(a,b,c,d,e){var c=c?c:null,f="_"+a,g=a.substring(0,1).toUpperCase()+a.substring(1),h=Downsha.DefiningMixin._getTargetFor(arguments.callee.caller);h[f]=c;if(!d){var i="get"+g;h[i]=function(){return this[f]};this.__defineGetter__(a,h[i])}e||(g="set"+g,h[g]=function(a){if("string"==typeof b&&a&&a.constructor.name==b)this[f]=a;else if("function"==typeof b&&a instanceof b)this[f]=a;else{if(a)throw Error("Expected "+("string"==typeof b?b:b.name)+" but got "+
typeof a);this[f]=c}},this.__defineSetter__(a,h[g]))};Downsha.DownshaError=function(a,b,c){this.__defineGetter__("errorCode",this.getErrorCode);this.__defineSetter__("errorCode",this.setErrorCode);this.__defineGetter__("modelName",this.getModelName);this.initialize(a,b,c)};Downsha.DownshaError.CLASS_FIELD="javaClass";Downsha.DownshaError.ERROR_CODE_FIELD="errorCode";Downsha.DownshaError.MESSAGE_FIELD="message";Downsha.DownshaError.PARAMETER_FIELD="parameter";Downsha.DownshaError.javaClass="com.downsha.web.DownshaError";
Downsha.DownshaError.prototype.handleInheritance=function(a){"string"==typeof a.prototype.constructor[Downsha.DownshaError.CLASS_FIELD]&&(Downsha.DownshaError.Registry[a.prototype.constructor[Downsha.DownshaError.CLASS_FIELD]]=a)};Downsha.DownshaError.prototype._errorCode=null;Downsha.DownshaError.prototype.message=null;Downsha.DownshaError.prototype.parameter=null;Downsha.DownshaError.prototype.getModelName=function(){return this.constructor.name};
Downsha.DownshaError.prototype.initialize=function(a,b,c){if(a&&"object"==typeof a){if("undefined"!=typeof a[Downsha.DownshaError.ERROR_CODE_FIELD]&&(this.errorCode=a[Downsha.DownshaError.ERROR_CODE_FIELD]),"undefined"!=typeof a[Downsha.DownshaError.MESSAGE_FIELD]&&(this.message=a[Downsha.DownshaError.MESSAGE_FIELD]),"undefined"!=typeof a[Downsha.DownshaError.PARAMETER_FIELD])this.parameter=a[Downsha.DownshaError.PARAMETER_FIELD]}else if("undefined"!=typeof a&&(this.errorCode=a),"undefined"!=typeof b&&
(this.message=b),"undefined"!=typeof c)this.parameter=c};Downsha.DownshaError.prototype.setErrorCode=function(a){this._errorCode=isNaN(parseInt(a))?null:parseInt(a)};Downsha.DownshaError.prototype.getErrorCode=function(){return this._errorCode};Downsha.DownshaError.prototype.getClassName=function(){return"undefined"!=typeof this.constructor[Downsha.DownshaError.CLASS_FIELD]?this.constructor[Downsha.DownshaError.CLASS_FIELD]:null};
Downsha.DownshaError.prototype.getShortClassName=function(){var a=this.getClassName();"string"==typeof a&&(a=a.split("."),a=a[a.length-1]);return a};Downsha.DownshaError.prototype.toJSON=function(){var a={errorCode:this.errorCode,message:this.message,parameter:this.parameter};this.constructor[Downsha.DownshaError.CLASS_FIELD]&&(a[Downsha.DownshaError.CLASS_FIELD]=this.constructor[Downsha.DownshaError.CLASS_FIELD]);return a};
Downsha.DownshaError.prototype.toString=function(){var a=this.getShortClassName();return null==a?"Downsha.DownshaError":a+" ("+this.errorCode+") ["+this.parameter+"]"+("string"==typeof this.message?this.message:"")};Downsha.DownshaError.Registry={};Downsha.DownshaError.responsibleConstructor=function(a){return"function"==typeof Downsha.DownshaError.Registry[a]?Downsha.DownshaError.Registry[a]:Downsha.DownshaError};
Downsha.DownshaError.fromObject=function(a){return a instanceof Downsha.DownshaError?a:"object"==typeof a&&a?Downsha.DownshaError.unmarshall(a):new Downsha.DownshaError};
Downsha.DownshaError.unmarshall=function(a){var b=null;if("object"!=typeof a||!a)return a;if(b="string"==typeof a[Downsha.DownshaError.CLASS_FIELD]&&"function"==typeof Downsha.DownshaError.Registry[a[Downsha.DownshaError.CLASS_FIELD]]?new Downsha.DownshaError.Registry[a[Downsha.DownshaError.CLASS_FIELD]]:new this)if(a.errorCode&&(b.errorCode=a.errorCode),a.message&&(b.message=a.message),a.parameter)b.parameter=a.parameter;return b};
Downsha.DownshaError.marshall=function(a){if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b.push(Downsha.DownshaError._marshall(a[c]));return b}return Downsha.DownshaError._marshall(a)};Downsha.DownshaError._marshall=function(a){return a instanceof Downsha.DownshaError?a.toJSON():a};Downsha.Exception=function(a,b){this.initialize(a,b,null)};Downsha.inherit(Downsha.Exception,Downsha.DownshaError);Downsha.Exception.prototype._errorCode=0;
Downsha.DSTPSystemException=function(a,b){this.initialize(a,b)};Downsha.inherit(Downsha.DSTPSystemException,Downsha.Exception);Downsha.DSTPUserException=function(a,b,c){this.initialize(a,b,c)};Downsha.inherit(Downsha.DSTPUserException,Downsha.Exception);Downsha.DSTPResponseException=function(a,b){this.initialize(a,b)};Downsha.inherit(Downsha.DSTPResponseException,Downsha.DownshaError);Downsha.ValidationError=function(a,b,c){this.initialize(a,b,c)};Downsha.ValidationError.GLOBAL_PARAMETER="__stripes_global_error";
Downsha.inherit(Downsha.ValidationError,Downsha.DownshaError);Downsha.ValidationError.prototype.isGlobal=function(){return null==this.parameter||this.parameter==Downsha.ValidationError.GLOBAL_PARAMETER};Downsha.SimpleError=function(a){this.initialize(null,a,null)};Downsha.inherit(Downsha.SimpleError,Downsha.ValidationError);Downsha.ScopedLocalizableError=function(a,b,c){this.initialize(a,b,c)};Downsha.inherit(Downsha.ScopedLocalizableError,Downsha.SimpleError);
Downsha.DSTPScopedError=function(a,b,c){this.initialize(a,b,c)};Downsha.inherit(Downsha.DSTPScopedError,Downsha.ScopedLocalizableError);
Downsha.Logger=function(a,b,c){this.__defineGetter__("level",this.getLevel);this.__defineSetter__("level",this.setLevel);this.__defineGetter__("scope",this.getScope);this.__defineSetter__("scope",this.setScope);this.__defineGetter__("scopeName",this.getScopeName);this.__defineGetter__("scopeNameAsPrefix",this.getScopeNameAsPrefix);this.__defineGetter__("useTimestamp",this.isUseTimestamp);this.__defineSetter__("useTimestamp",this.setUseTimestamp);this.__defineGetter__("usePrefix",this.isUsePrefix);
this.__defineSetter__("usePrefix",this.setUsePrefix);this.__defineGetter__("enabled",this.isEnabled);this.__defineSetter__("enabled",this.setEnabled);this.scope=a||arguments.callee.caller;this.level=b;if("undefined"!=typeof c&&c instanceof Downsha.LoggerImpl)this.impl=c;else{var d=Downsha.LoggerImplFactory.getImplementationFor(navigator);this.impl=d instanceof Array?new Downsha.LoggerChainImpl(this,d):new d(this)}};Downsha.Logger.LOG_LEVEL_DEBUG=0;Downsha.Logger.LOG_LEVEL_INFO=1;
Downsha.Logger.LOG_LEVEL_WARN=2;Downsha.Logger.LOG_LEVEL_ERROR=3;Downsha.Logger.LOG_LEVEL_EXCEPTION=4;Downsha.Logger.LOG_LEVEL_OFF=5;Downsha.Logger.GLOBAL_LEVEL=Downsha.Logger.LOG_LEVEL_ERROR;Downsha.Logger.DEBUG_PREFIX="[DEBUG] ";Downsha.Logger.INFO_PREFIX="[INFO] ";Downsha.Logger.WARN_PREFIX="[WARN] ";Downsha.Logger.ERROR_PREFIX="[ERROR] ";Downsha.Logger.EXCEPTION_PREFIX="[EXCEPTION] ";Downsha.Logger._instances={};
Downsha.Logger.getInstance=function(a){var a=a||arguments.callee.caller,b="function"==typeof a?a.name:a.constructor.name;"undefined"==typeof this._instances[b]&&(this._instances[b]=new Downsha.Logger(a));return this._instances[b]};Downsha.Logger.setInstance=function(a){this._instance=a};Downsha.Logger.destroyInstance=function(a){a=a||arguments.callee.caller;delete this._instances["function"==typeof a?a.name:a.constructor.name]};
Downsha.Logger.setGlobalLevel=function(a){a=parseInt(a);if(!isNaN(a)&&(Downsha.Logger.GLOBAL_LEVEL=a,this._instances))for(var b in this._instances)this._instances[b].setLevel(a)};Downsha.Logger.setLevel=function(a){if(this._instances)for(var b in this._instances)this._instances[b].setLevel(a)};Downsha.Logger.enableImplementor=function(a){if(this._instances)for(var b in this._instances)this._instances[b].enableImplementor(a);a&&(a.protoEnabled=!0)};
Downsha.Logger.disableImplementor=function(a){if(this._instances)for(var b in this._instances)this._instances[b].disableImplementor(a);a&&(a.protoEnabled=!1)};Downsha.Logger.prototype._level=0;Downsha.Logger.prototype._scope=null;Downsha.Logger.prototype._usePrefix=!0;Downsha.Logger.prototype._useTimestamp=!0;Downsha.Logger.prototype._enabled=!0;Downsha.Logger.prototype.getImplementor=function(a){return a?this.impl.answerImplementorInstance(a):this.impl};
Downsha.Logger.prototype.enableImplementor=function(a){if(a){if(a=this.getImplementor(a))a.enabled=!0}else this.impl.enabled=!0};Downsha.Logger.prototype.disableImplementor=function(a){if(a){if(a=this.getImplementor(a))a.enabled=!1}else this.impl.enabled=!1};Downsha.Logger.prototype.setLevel=function(a){this._level=parseInt(a);isNaN(this._level)&&(this._level=Downsha.Logger.GLOBAL_LEVEL)};Downsha.Logger.prototype.getLevel=function(){return this._level};
Downsha.Logger.prototype.setScope=function(a){"function"==typeof a?this._scope=a:"object"==typeof a&&null!=a&&(this._scope=a.constructor)};Downsha.Logger.prototype.getScope=function(){return this._scope};Downsha.Logger.prototype.getScopeName=function(){return this.scope?this.scope.name:""};Downsha.Logger.prototype.getScopeNameAsPrefix=function(){var a=this.scopeName;return a?"["+a+"] ":""};
Downsha.Logger.prototype._padNumber=function(a,b){a=parseInt(a);isNaN(a)&&(a=0);for(var c=0<=a?!0:!1,d=""+Math.abs(a);d.length<b;)d="0"+d;c||(d="-"+d);return d};
Downsha.Logger.prototype.getPrefix=function(a){var b="";if(this.useTimestamp)var c=new Date,d=c.getFullYear(),e=this._padNumber(c.getMonth()+1,2),f=this._padNumber(c.getDate(),2),g=this._padNumber(c.getHours(),2),h=this._padNumber(c.getMinutes(),2),i=this._padNumber(c.getSeconds(),2),c=this._padNumber(c.getMilliseconds(),3),b=b+(d+"/"+e+"/"+f+" "+g+":"+h+":"+i+"."+c+" ");this.usePrefix&&(b+=a);return b+=this.scopeNameAsPrefix};Downsha.Logger.prototype.isUsePrefix=function(){return this._usePrefix};
Downsha.Logger.prototype.setUsePrefix=function(a){this._usePrefix=a?!0:!1};Downsha.Logger.prototype.isUseTimestamp=function(){return this._useTimestamp};Downsha.Logger.prototype.setUseTimestamp=function(a){this._useTimestamp=a?!0:!1};Downsha.Logger.prototype.isEnabled=function(){return this._enabled};Downsha.Logger.prototype.setEnabled=function(a){this._enabled=a?!0:!1};Downsha.Logger.prototype.isDebugEnabled=function(){return this.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_DEBUG};
Downsha.Logger.prototype.dump=function(a){this.enabled&&this.impl.enabled&&this.impl.dir(a)};Downsha.Logger.prototype.dir=function(a){this.enabled&&this.impl.enabled&&this.impl.dir(a)};Downsha.Logger.prototype.trace=function(){this.enabled&&this.impl.enabled&&this.impl.trace()};Downsha.Logger.prototype.alert=function(a){this.enabled&&this.impl.enabled&&this.impl.alert(a)};
Downsha.Logger.prototype.debug=function(a){this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_DEBUG&&this.impl.debug(this.getPrefix(this.constructor.DEBUG_PREFIX)+a)};Downsha.Logger.prototype.info=function(a){this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_INFO&&this.impl.info(this.getPrefix(this.constructor.INFO_PREFIX)+a)};
Downsha.Logger.prototype.warn=function(a){this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_WARN&&this.impl.warn(this.getPrefix(this.constructor.WARN_PREFIX)+a)};Downsha.Logger.prototype.error=function(a){this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_ERROR&&this.impl.error(this.getPrefix(this.constructor.ERROR_PREFIX)+a)};
Downsha.Logger.prototype.exception=function(a){this.enabled&&this.impl.enabled&&this.level<=Downsha.Logger.LOG_LEVEL_EXCEPTION&&this.impl.exception(this.getPrefix(this.constructor.EXCEPTION_PREFIX)+a)};Downsha.Logger.prototype.clear=function(){this.impl.clear()};
Downsha.LoggerImpl=function(a){this.__defineGetter__("logger",this.getLogger);this.__defineSetter__("logger",this.setLogger);this.__defineGetter__("enabled",this.isEnabled);this.__defineSetter__("enabled",this.setEnabled);this.__defineGetter__("protoEnabled",this.isProtoEnabled);this.__defineSetter__("protoEnabled",this.setProtoEnabled);this.initialize(a)};Downsha.LoggerImpl.ClassRegistry=[];Downsha.LoggerImpl.isResponsibleFor=function(){return!1};Downsha.LoggerImpl.prototype.handleInheritance=function(a){Downsha.LoggerImpl.ClassRegistry.push(a)};
Downsha.LoggerImpl.prototype._logger=null;Downsha.LoggerImpl.prototype._enabled=!1;Downsha.LoggerImpl.prototype.initialize=function(a){this.logger=a};Downsha.LoggerImpl.prototype.answerImplementorInstance=function(a){if(this.constructor==a)return this};Downsha.LoggerImpl.prototype.isEnabled=function(){return this._enabled};Downsha.LoggerImpl.prototype.setEnabled=function(a){this._enabled=a?!0:!1};Downsha.LoggerImpl.prototype.isProtoEnabled=function(){return this.constructor.prototype._enabled};
Downsha.LoggerImpl.prototype.setProtoEnabled=function(a){this.constructor.prototype._enabled=a?!0:!1};Downsha.LoggerImpl.prototype.getLogger=function(){return this._logger};Downsha.LoggerImpl.prototype.setLogger=function(a){a instanceof Downsha.Logger&&(this._logger=a)};Downsha.LoggerImpl.prototype.dir=function(){};Downsha.LoggerImpl.prototype.trace=function(){};Downsha.LoggerImpl.prototype.debug=function(){};Downsha.LoggerImpl.prototype.info=function(){};Downsha.LoggerImpl.prototype.warn=function(){};
Downsha.LoggerImpl.prototype.error=function(){};Downsha.LoggerImpl.prototype.exception=function(){};Downsha.LoggerImpl.prototype.alert=function(){};Downsha.LoggerImpl.prototype.clear=function(){};Downsha.LoggerChainImpl=function(a,b){this.initialize(a,b)};Downsha.inherit(Downsha.LoggerChainImpl,Downsha.LoggerImpl,!0);Downsha.LoggerChainImpl.prototype._impls=null;Downsha.LoggerChainImpl.prototype._enabled=!0;
Downsha.LoggerChainImpl.prototype.initialize=function(a,b){Downsha.LoggerChainImpl.parent.initialize.apply(this,[a]);var c=[].concat(b);this._impls=[];for(var d=0;d<c.length;d++)this._impls.push(new c[d](a))};Downsha.LoggerChainImpl.prototype.answerImplementorInstance=function(a){for(var b=0;b<this._impls.length;b++){var c=this._impls[b].answerImplementorInstance(a);if(c)return c}};Downsha.LoggerChainImpl.prototype.dir=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].dir(a)};
Downsha.LoggerChainImpl.prototype.trace=function(){for(var a=0;a<this._impls.length;a++)this._impls[a].enabled&&this._impls[a].trace(obj)};Downsha.LoggerChainImpl.prototype.debug=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].debug(a)};Downsha.LoggerChainImpl.prototype.info=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].info(a)};
Downsha.LoggerChainImpl.prototype.warn=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].warn(a)};Downsha.LoggerChainImpl.prototype.error=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].error(a)};Downsha.LoggerChainImpl.prototype.exception=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].exception(a)};
Downsha.LoggerChainImpl.prototype.alert=function(a){for(var b=0;b<this._impls.length;b++)this._impls[b].enabled&&this._impls[b].alert(a)};Downsha.LoggerChainImpl.prototype.clear=function(){for(var a=0;a<this._impls.length;a++)this._impls[a].enabled&&this._impls[a].clear()};
Downsha.LoggerImplFactory={getImplementationFor:function(a){for(var b=Downsha.LoggerImpl.ClassRegistry,c=[],d=0;d<b.length;d++)"function"==typeof b[d]&&"function"==typeof b[d].isResponsibleFor&&b[d].isResponsibleFor(a)&&c.push(b[d]);return 0==c.length?Downsha.LoggerImpl:1==c.length?c[0]:c}};Downsha.WebKitLoggerImpl=function(a){this.initialize(a)};Downsha.inherit(Downsha.WebKitLoggerImpl,Downsha.LoggerImpl,!0);Downsha.WebKitLoggerImpl.isResponsibleFor=function(a){return 0<=a.userAgent.toLowerCase().indexOf("AppleWebKit/")};
Downsha.WebKitLoggerImpl.prototype._enabled=!0;Downsha.WebKitLoggerImpl.prototype.dir=function(a){console.group(this.logger.scopeName);console.dir(a);console.groupEnd()};Downsha.WebKitLoggerImpl.prototype.trace=function(){console.group(this.logger.scopeName);console.trace();console.groupEnd()};Downsha.WebKitLoggerImpl.prototype.alert=function(a){alert(a)};Downsha.WebKitLoggerImpl.prototype.debug=function(a){console.debug(a)};Downsha.WebKitLoggerImpl.prototype.info=function(a){console.info(a)};
Downsha.WebKitLoggerImpl.prototype.warn=function(a){console.warn(a)};Downsha.WebKitLoggerImpl.prototype.error=function(a){console.error(a)};Downsha.WebKitLoggerImpl.prototype.exception=function(a){console.error(a);this.trace()};Downsha.ChromeExtensionLoggerImpl=function(a){this.initialize(a)};Downsha.inherit(Downsha.ChromeExtensionLoggerImpl,Downsha.WebKitLoggerImpl,!0);Downsha.ChromeExtensionLoggerImpl.isResponsibleFor=function(a){return 0<=a.userAgent.toLowerCase().indexOf("chrome/")};
Downsha.ChromeExtensionLoggerImpl.prototype._enabled=!0;Downsha.CacheManager=function(a){this.__defineGetter__("impl",this.getImplementation);this.__defineSetter__("impl",this.setImplementation);this.initialize(a)};Downsha.CacheManager.prototype._impl=null;Downsha.CacheManager.prototype.initialize=function(a){if("undefined"==typeof a&&"object"==typeof navigator&&null!=navigator){var b=Downsha.CacheManagerImplFactory.getImplementationFor(navigator);b&&(a=new b)}this.setImplementation(a)};
Downsha.CacheManager.prototype.setImplementation=function(a){a instanceof Downsha.CacheManagerImpl?this._impl=a:null==a&&(this._impl=null)};Downsha.CacheManager.prototype.getImplementation=function(){return this._impl};Downsha.CacheManager.prototype.startCache=function(){return this._impl.startCache()};Downsha.CacheManager.prototype.isComplete=function(){return this._impl.isComplete()};Downsha.CacheManager.prototype.getCaches=function(){return this._impl.getCaches()};
Downsha.CacheManager.prototype.getCache=function(a){return this._impl.getCache(a)};Downsha.CacheManager.prototype.addCaches=function(a,b,c){return this._impl.addCaches(a,b,c)};Downsha.CacheManager.prototype.addCache=function(a,b,c){return this._impl.addCache(a,b,c)};
Downsha.CacheManagerImplFactory={getImplementationFor:function(a){for(var b=Downsha.CacheManagerImpl.ClassRegistry,c=0;c<b.length;c++)if("function"==typeof b[c]&&"function"==typeof b[c].isResponsibleFor&&b[c].isResponsibleFor(a))return b[c];return null}};Downsha.CacheManagerImpl=function(){};Downsha.CacheManagerImpl.ClassRegistry=[];Downsha.CacheManagerImpl.isResponsibleFor=function(){return!1};Downsha.CacheManagerImpl.prototype.handleInheritance=function(a){Downsha.CacheManagerImpl.ClassRegistry.push(a)};
Downsha.CacheManagerImpl.prototype.startCache=function(){throw Error("Must subclass Downsha.CacheManagerImpl.startCache");};Downsha.CacheManagerImpl.prototype.isComplete=function(){throw Error("Must subclass Downsha.CacheManagerImpl.isComplete");};Downsha.CacheManagerImpl.prototype.getCaches=function(){throw Error("Must subclass Downsha.CacheManagerImpl.getCaches");};Downsha.CacheManagerImpl.prototype.getCache=function(){throw Error("Must subclass Downsha.CacheManagerImpl.getCache");};
Downsha.CacheManagerImpl.prototype.addCaches=function(){throw Error("Must subclass Downsha.CacheManagerImpl.addCache");};Downsha.CacheManagerImpl.prototype.addCache=function(){throw Error("Must subclass Downsha.CacheManagerImpl.addCache");};Downsha.Cache=function(a){this.initialize(a)};Downsha.Cache.CACHE_STATUS_LOADING=0;Downsha.Cache.CACHE_STATUS_SUCCESS=1;Downsha.Cache.CACHE_STATUS_ERROR=2;
Downsha.Cache.MIME_TRANSLATIONS={jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png",tif:"image/tiff",tiff:"image/tiff",wbmp:"image/vnd.wap.wbmp",ico:"image/x-icon",jng:"image/x-jng",bmp:"image/x-ms-bmp",svg:"image/svg+xml",swf:"application/x-shockwave-flash"};
Downsha.Cache.guessTypeByUrl=function(a){if(a&&a.url&&0!=a.url.length){var b=a.url.lastIndexOf(".");0>b||(b=a.url.substr(b+1),"string"!=typeof b||0==b.length||(b=b.toLowerCase(),"undefined"!=typeof Downsha.Cache.MIME_TRANSLATIONS[b]&&(a.type=Downsha.Cache.MIME_TRANSLATIONS[b])))}};Downsha.Cache.prototype.url=null;Downsha.Cache.prototype.status=Downsha.Cache.CACHE_STATUS_LOADING;Downsha.Cache.prototype.type=null;Downsha.Cache.prototype.encoding=null;Downsha.Cache.prototype.data=null;
Downsha.Cache.prototype.background=null;Downsha.Cache.prototype.initialize=function(a){if("object"==typeof a&&null!=a)for(var b in this)"function"!=typeof this[b]&&"undefined"!=typeof a[b]&&(this[b]=a[b])};
(function(){var a=null;Downsha.ChromeCacheManagerImpl=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.ChromeCacheManagerImpl,Downsha.CacheManagerImpl,!0);Downsha.ChromeCacheManagerImpl.isResponsibleFor=function(a){return 0<=a.userAgent.toLowerCase().indexOf("chrome/")};Downsha.ChromeCacheManagerImpl.prototype.CACHE_XHR_TIMEOUT=3E3;Downsha.ChromeCacheManagerImpl.prototype._caches=[];Downsha.ChromeCacheManagerImpl.prototype.initialize=function(){};Downsha.ChromeCacheManagerImpl.prototype.startCache=
function(){a.debug("startCache");this._caches=[]};Downsha.ChromeCacheManagerImpl.prototype.isComplete=function(){var b=0,c=0,d=0,e;for(e in this._caches)this._caches[e].status==Downsha.Cache.CACHE_STATUS_LOADING?b++:this._caches[e].status==Downsha.Cache.CACHE_STATUS_SUCCESS?c++:this._caches[e].status==Downsha.Cache.CACHE_STATUS_ERROR&&d++;a.debug("isComplete cache total: "+this._caches.length+", loading: "+b+", success: "+c+", error: "+d);return 0<b?!1:!0};Downsha.ChromeCacheManagerImpl.prototype.getCaches=
function(){var a=[],c;for(c in this._caches)this._caches[c].status==Downsha.Cache.CACHE_STATUS_SUCCESS&&this._caches[c].data&&0<this._caches[c].data.length&&a.push(this._caches[c]);return a};Downsha.ChromeCacheManagerImpl.prototype.getCache=function(a){for(var c in this._caches)if(this._caches[c]&&this._caches[c].url==a){if(this._caches[c].status==Downsha.Cache.CACHE_STATUS_SUCCESS&&this._caches[c].data&&0<this._caches[c].data.length)return this._caches[c];break}return null};Downsha.ChromeCacheManagerImpl.prototype.addCaches=
function(a,c,d){if(a instanceof Array){var a=[].concat(a),e;for(e in a)this.addCache(a[e].url,a[e].background,c,d)}else"string"==typeof a&&this.addCache(a,0,c,d)};Downsha.ChromeCacheManagerImpl.prototype.addCache=function(b,c,d,e){var f=this,g=function(b){a.debug("addCache ok for url: "+b.url+", data length: "+b.data.length);if("string"!=typeof b.type||0==b.type.length)Downsha.Cache.guessTypeByUrl(b),a.debug("guessTypeByUrl url: "+b.url+", type: "+b.type);b.status=Downsha.Cache.CACHE_STATUS_SUCCESS;
"function"==typeof d&&d(b)},h=function(b){a.debug("addCache error for url: "+b.url);b.status=Downsha.Cache.CACHE_STATUS_ERROR;"function"==typeof e&&e(b)};if(!("string"!=typeof b||0==b.length)){for(var i in f._caches)if(f._caches[i]&&f._caches[i].url==b){a.debug("addCache already exists, url: "+b);return}var j=new Downsha.Cache({url:b,background:c,status:Downsha.Cache.CACHE_STATUS_LOADING});f._caches.push(j);setTimeout(function(){f.getCacheByXHR(j,g,h)},1)}};Downsha.ChromeCacheManagerImpl.prototype.getCacheByXHR=
function(b,c,d){var e={url:b.url,type:"GET",async:!0,cache:!0,timeout:this.CACHE_XHR_TIMEOUT,mimeType:"text/plain; charset=x-user-defined",success:function(e,g,h){if(4==h.readyState&&200==h.status&&0<e.length){a.debug("cache ajax ok, url: "+b.url+", data length: "+e.length);b.data=[];b.data.length=e.length;for(g=0;g<b.data.length;g++)b.data[g]=e.charCodeAt(g)&255;b.type=h.getResponseHeader("Content-Type");if(null!=b.type&&(e=b.type.indexOf(";"),0<e&&(b.type=b.type.substring(0,e)),0<=b.type.indexOf("text/plain")))b.type=
null;b.encoding=h.getResponseHeader("Content-Encoding");null!=b.encoding&&(h=b.encoding.indexOf(";"),0<h&&(b.encoding=b.encoding.substring(0,h)));"function"==typeof c&&c(b)}else a.error("cache ajax error, url: "+b.url+", readyState: "+h.readyState+", status: "+h.status+", data length: "+e.length),"function"==typeof d&&d(b)},error:function(c,e,h){a.error("cache ajax error, url: "+b.url+", readyState: "+c.readyState+", status: "+c.status+", error: "+(h?h:"unknown"));"function"==typeof d&&d(b)}};a.debug("cache ajax sending, url: "+
b.url);$.ajax(e)}})();
(function(){Downsha.getPlatform=function(){null==Downsha._platform&&(Downsha._platform=new Downsha.Platform);return Downsha._platform};Downsha.__defineGetter__("platform",Downsha.getPlatform);Downsha.Platform=function(){Downsha.Logger.getInstance();this.initialize()};Downsha.Platform.prototype.os="";Downsha.Platform.prototype.osMajor=0;Downsha.Platform.prototype.osMinor=0;Downsha.Platform.prototype.osVer="";Downsha.Platform.prototype.browser="";Downsha.Platform.prototype.browserVer="";Downsha.Platform.prototype.userAgent=
"";Downsha.Platform.prototype.initialize=function(){if(0<=navigator.platform.indexOf("Win")){var a=navigator.userAgent.match(/Windows\s*NT\s*(\d+)\.(\d+)/i);a&&(this.osMajor=parseInt(a[1]),this.osMinor=parseInt(a[2]),this.osVer=this.osMajor+"."+this.osMinor);this.os=5==this.osMajor&&0==this.osMinor?"WIN_2K":5==this.osMajor&&1==this.osMinor?"WIN_XP":5==this.osMajor&&2==this.osMinor?"WIN_SERVER_2003":6==this.osMajor&&0==this.osMinor?"WIN_VISTA":6==this.osMajor&&1==this.osMinor?"WIN_7":6==this.osMajor&&
2==this.osMinor?"WIN_8":"WIN"}else if(0<=navigator.platform.indexOf("Mac")){if(a=navigator.userAgent.match(/Mac\s*OS\s*X\s*(\d+)_(\d+)/i))this.osMajor=parseInt(a[1]),this.osMinor=parseInt(a[2]),this.osVer=this.osMajor+"."+this.osMinor;this.os="MAC"}else 0<=navigator.platform.indexOf("Linux")?this.os="LINUX":0<=navigator.platform.indexOf("X11")?this.os="UNIX":0<=navigator.platform.indexOf("iPhone")?this.os="iPhone":0<=navigator.platform.indexOf("iPad")&&(this.os="iPad");this.browser=0<=navigator.userAgent.indexOf("360EE")?
"360chrome.exe":0<=navigator.userAgent.indexOf("LBBROWSER")?"liebao.exe":"chrome.exe";if(a=navigator.userAgent.match(/Chrome\/(\d+\.\d+\.\d+\.\d+)/i))this.browserVer=a[1];this.userAgent=navigator.userAgent};Downsha.Platform.prototype.toJSON=function(){return{OS:this.os,OSVer:this.osVer,BrowName:this.browser,BrowVer:this.browserVer,UserAgent:this.userAgent}}})();Downsha.LocalStore=function(a,b){this.initialize(a,b);this.__defineGetter__("length",this.getLength)};
Downsha.LocalStore.prototype.initialize=function(a,b){this.storeName="string"==typeof a?a:Downsha.LocalStore.DEFAULT_STORE_NAME;this.impl=b?b:new Downsha.LocalStore.DEFAULT_IMPL;this.impl.store=this};Downsha.LocalStore.prototype.get=function(a){return this.impl.get(a)};Downsha.LocalStore.prototype.put=function(a,b){this.impl.put(a,b)};Downsha.LocalStore.prototype.remove=function(a){this.impl.remove(a)};Downsha.LocalStore.prototype.clear=function(){this.impl.clear()};
Downsha.LocalStore.prototype.getLength=function(){return this.impl.length};Downsha.LocalStore.DEFAULT_STORE_NAME="Downsha.LocalStore";Downsha.LocalStore.DEFAULT_IMPL=function(){this.initialize();this.__defineGetter__("length",this.getLength)};Downsha.LocalStore.DEFAULT_IMPL.prototype.store=null;Downsha.LocalStore.DEFAULT_IMPL.prototype._cache=null;Downsha.LocalStore.DEFAULT_IMPL.prototype._countDelta=0;
Downsha.LocalStore.DEFAULT_IMPL.prototype.initialize=function(){this._cache={};for(var a=this._countDelta=0;a<this._cache.length;a++)this._countDelta++};Downsha.LocalStore.DEFAULT_IMPL.prototype.clear=function(){this.initialize()};Downsha.LocalStore.DEFAULT_IMPL.prototype.get=function(a){return this._cache[a]};Downsha.LocalStore.DEFAULT_IMPL.prototype.put=function(a,b){this._cache[a]=b};Downsha.LocalStore.DEFAULT_IMPL.prototype.remove=function(a){"undefined"!=typeof this._cache[a]&&delete this._cache[a]};
Downsha.LocalStore.DEFAULT_IMPL.prototype.getLength=function(){var a=0,b;for(b in this._cache)a++;return a-this._countDelta};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL=function(a){this.initialize(a);this.__defineGetter__("length",this.getLength)};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.store=null;Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype._cache=null;Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.initialize=function(a){this._cache=a};
Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.clear=function(){this._cache.clear()};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.get=function(a){return(a=this._cache.getItem(a))?this.unmarshall(a):null};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.put=function(a,b){this._cache.setItem(a,this.marshall(b))};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.remove=function(a){this._cache.removeItem(a)};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.getLength=function(){return this._cache.length};
Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.marshall=function(a){return JSON.stringify(a)};Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL.prototype.unmarshall=function(a){if(void 0===a||null===a)return a;var b=null;try{b=JSON.parse(a)}catch(c){console&&"function"==typeof console.log&&(console.error(c),console.log(c.stack))}return b};Downsha.Utils=new function(){};
Downsha.Utils.extendObject=function(a,b,c,d){if("object"==typeof a&&null!=a&&"object"==typeof b&&null!=b)for(var e in b)"undefined"==typeof a[e]||d?a[e]=b[e]:c&&arguments.callee.apply(this,[a[e],b[e],c,d])};
Downsha.Utils.importConstructs=function(a,b,c){for(var c=c instanceof Array?c:[c],d=0;d<c.length;d++)for(var e=c[d].split("."),f=b,g=a,h=0;h<e.length;h++)h==e.length-1?"undefined"==typeof f[e[h]]?f[e[h]]=g[e[h]]:Downsha.Utils.extendObject(f[e[h]],g[e[h]],!0):(g=g[e[h]],"undefined"==typeof f[e[h]]&&(f[e[h]]={}),f=f[e[h]])};
Downsha.Utils.separateString=function(a,b){if("string"!=typeof a)return a;"string"!=typeof b&&(b=",");for(var c=a.split(b),d=[],e=0;e<c.length;e++)if("string"==typeof c[e]){var f=Downsha.Utils.trim(c[e]);f&&0<f.length&&d.push(f)}return d};Downsha.Utils.trim=function(a){return"string"!=typeof a?a:a.replace(/^\s+/,"").replace(/\s+$/,"")};Downsha.Utils.shortenString=function(a,b,c){a+="";a.length>b&&(a=a.substring(0,Math.max(0,b-("string"==typeof c?c.length:0))),"string"==typeof c&&(a+=c));return a};
Downsha.Utils.htmlEntities=function(a){return $("<div/>").text(a).html()};Downsha.Utils.urlPath=function(a){return"string"==typeof a&&(a=a.replace(/^[^:]+:\/+([^\/]+)/,""),0==a.indexOf("/"))?a.replace(/^(\/[^\?\#]*).*$/,"$1"):""};Downsha.Utils.urlDomain=function(a,b){return"string"==typeof a?a.replace(RegExp("^[^:]+:/+([^/"+(b?"":":")+"]+).*$"),"$1"):a};
Downsha.Utils.urlTopDomain=function(a){var b=a;"string"==typeof a&&(b=Downsha.Utils.urlDomain(a),0==b.toLowerCase().indexOf("www.")&&(b=b.substring(4)));return b};Downsha.Utils.urlPath=function(a){return"string"==typeof a?a.replace(/^[^:]+:\/\/[^/]+([^&?]*).*$/,"$1"):""};
Downsha.Utils.urlQueryValue=function(a,b){if("string"==typeof b&&"string"==typeof a&&0<=b.indexOf("?")){for(var c=b.split(/[\?\#\&]+/).slice(1),d=a.toLowerCase(),e=[],f=0;f<c.length;f++){var g=c[f].split("=",2);g[0].toLowerCase()==d&&(g=g[1]?g[1].replace(/\+/g," "):g[1],e.push(decodeURIComponent(g)))}if(0<e.length)return e[e.length-1]}return null};Downsha.Utils.urlProto=function(a){if("string"==typeof a){var b=-1;if(0<(b=a.indexOf(":/")))return a.substring(0,b).toLowerCase()}return null};
Downsha.Utils.absoluteUrl=function(a,b){0==a.indexOf("//")?a=b.replace(/^([^:]+):.*$/,"$1")+":"+a:0==a.indexOf("/")?a=b.replace(/^(.*:\/\/[^\/]+).*$/,"$1")+a:(a.match(/^\.+\//),a="/"==b.charAt(b.length-1)?b+a:b+"/"+a);return a};Downsha.Utils.urlSuffix="...";
Downsha.Utils.shortUrl=function(a,b){var c=a;"string"==typeof a&&(0==c.indexOf("file:")?(c=decodeURIComponent(c.replace(/^file:.*\/([^\/]+)$/,"$1")),"number"==typeof b&&!isNaN(b)&&c.length>b&&(c=c.substring(0,b),c+=""+Downsha.Utils.urlSuffix)):(c=c.replace(/^([a-zA-Z]+:\/+)?([^\/]+).*$/,"$2"),"number"==typeof b&&!isNaN(b)&&c.length>b?(c=c.substring(0,b),c+=""+Downsha.Utils.urlSuffix):2<a.substring(a.indexOf(c)+c.length).length&&(c+="/"+Downsha.Utils.urlSuffix)));return c};
Downsha.Utils.getDocumentWidth=function(a){a||(a=document);return a.width?a.width:a.body&&a.documentElement&&a.documentElement.scrollWidth?a.documentElement.scrollWidth:a.body&&a.body.scrollWidth?a.body.scrollWidth:0};Downsha.Utils.getDocumentHeight=function(a){a||(a=document);return a.height?a.height:a.body&&a.body.scrollHeight&&a.documentElement&&a.documentElement.scrollHeight?Math.max(a.documentElement.scrollHeight,a.body.scrollHeight):a.body&&a.body.scrollHeight?a.body.scrollHeight:0};
Downsha.Utils.findEmbeds=function(a){var b=[];try{var c=a.getElementsByTagName("object");if(c&&0<c.length)for(var d=0;d<c.length;d++)b.push(c[d]);var e=a.getElementsByTagName("embed");if(e&&0<e.length)for(d=0;d<e.length;d++)b.push(e[d])}catch(f){}return b};
Downsha.Utils.findDocuments=function(a){var b=[];try{var c=a.getElementsByTagName("frame");if(c&&0<c.length)for(var d=0;d<c.length;d++)c[d].contentDocument?b.push(c[d].contentDocument):c[d].contentWindow&&c[d].contentWindow.document?b.push(c[d].contentWindow.document):c[d].document&&b.push(c[d].document);var e=a.getElementsByTagName("iframe");if(e&&0<e.length)for(d=0;d<e.length;d++)e[d].contentDocument?b.push(e[d].contentDocument):e[d].contentWindow&&e[d].contentWindow.document?b.push(e[d].contentWindow.document):
e[d].document&&b.push(e[d].document)}catch(f){}return b};Downsha.Utils.getDocumentHead=function(a){return a.head?a.head:a.getElementsByTagName("head")?a.getElementsByTagName("head")[0]:a.documentElement?a.documentElement:a.body&&a.body.parentNode?a.body.parentNode:null};Downsha.Utils.makeAbsoluteClientRect=function(a,b){b||(b=window);return{top:a.top+b.pageYOffset,bottom:a.bottom+b.pageYOffset,left:a.left+b.pageXOffset,right:a.right+b.pageXOffset,width:a.width,height:a.height}};
Downsha.Utils.getAbsoluteBoundingClientRect=function(a){var b=a&&a.nodeType==Node.TEXT_NODE?a.parentElement?a.parentElement:a.parentNode:a;if(!b)return null;a=a instanceof Range?a.commonAncestorContainer.ownerDocument.defaultView:a.ownerDocument.defaultView;return Downsha.Utils.makeAbsoluteClientRect(b.getBoundingClientRect(),a)};Downsha.Utils.getElementForNode=function(a){return a&&a.nodeType==Node.ELEMENT_NODE?a:a.parentElement?a.parentElement:null};
Downsha.Utils.addElementClass=function(a,b){if(a&&b){var c=a.getAttribute("class");c?(c=c.split(/\s+/),0>c.indexOf(b)&&c.push(b),a.setAttribute("class",c.join(" "))):a.setAttribute("class",b)}};Downsha.Utils.removeElementClass=function(a,b){if(b){var c=a.getAttribute("class");if(c){var c=c.split(/\s+/),d=-1;0<=(d=c.indexOf(b))&&c.splice(d,1);a.setAttribute("class",c.join(" "))}}};Downsha.Utils.XML_ESCAPE_CHAR_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};
Downsha.Utils.escapeXML=function(a){for(var a=a.split(""),b=0;b<a.length;b++)Downsha.Utils.XML_ESCAPE_CHAR_MAP[a[b]]&&(a[b]=Downsha.Utils.XML_ESCAPE_CHAR_MAP[a[b]]);return a.join("")};
Downsha.Utils.escapeURL=function(a){for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);if(128>d)b+=String.fromCharCode(d);else if(2048>d)var e=d>>6|192,f=d&63|128,b=b+("%"+e.toString(16).toUpperCase()),b=b+("%"+f.toString(16).toUpperCase());else 65536>d&&(e=d>>12|224,f=d>>6&63|128,d=d&63|128,b+="%"+e.toString(16).toUpperCase(),b+="%"+f.toString(16).toUpperCase(),b+="%"+d.toString(16).toUpperCase())}return b};
Downsha.Utils.rectIntersection=function(a,b){if(!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)){var c={left:Math.max(a.left,b.left),top:Math.max(a.top,b.top),right:Math.min(a.right,b.right),bottom:Math.min(a.bottom,b.bottom)};c.width=c.right-c.left;c.height=c.bottom-c.top;return c}};Downsha.Utils.rectsEqual=function(a,b){return a.left==b.left&&a.right==b.right&&a.top==b.top&&a.bottom==b.bottom?!0:!1};
Downsha.Utils.expandRect=function(a,b){a.left="number"==typeof a.left?Math.min(a.left,b.left):b.left;a.top="number"==typeof a.top?Math.min(a.top,b.top):b.top;a.right="number"==typeof a.right?Math.max(a.right,b.right):b.right;a.bottom="number"==typeof a.bottom?Math.max(a.bottom,b.bottom):b.bottom};
Downsha.Utils.errorDescription=function(a){var b=null;if(a instanceof FileError){var c=a.code;if("number"==typeof c)for(var d in FileError){if(0<d.toLowerCase().indexOf("_err")&&FileError[d]==a.code){b="FileError: "+c+" ("+d+")";break}}else b="FileError: "+c}else a.message?b=a.message:"undefined"!=typeof a.code&&(b=(a.constructor&&a.constructor.name?a.constructor.name:""+a)+" code: "+a.code);return b};
Downsha.UUID={generateQuad:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},generateGuid:function(){return this.generateQuad()+this.generateQuad()+"-"+this.generateQuad()+"-"+this.generateQuad()+"-"+this.generateQuad()+"-"+this.generateQuad()+this.generateQuad()+this.generateQuad()}};Downsha.Utils=Downsha.Utils||new function(){};Downsha.Utils.MIN_ARTICLE_RATIO=0.0625;Downsha.Utils.MIN_ARTICLE_AREA=3E4;Downsha.Utils.MAX_ARTICLE_XOFFSET_RATIO=0.6;
Downsha.Utils.querySelectors=function(a,b){var c=null;if(!a)return c;for(var b=b||document,d=0;d<a.length;d++){c=a[d];if(":root"===c)return b;if(c=b.querySelector(c))break}return c};
Downsha.Utils.getArticleNode=function(a,b){a=a||document;if(!a)return null;var c=null;if(b&&b.a){var d=Downsha.Utils.querySelectors(b.a,a);d&&(c=d)}if(!c){var d=["jpeg","jpg","gif","png"],e=a.location.href.replace(/^.*\.(\w+)$/,"$1");e&&-1!=d.indexOf(e)&&(d=a.querySelector("body > img"))&&(c=d)}if(!c&&"frameset"==a.body.nodeName.toLowerCase()){for(var e=a.getElementsByTagName("frame"),d=null,f=0,g=0,h=0;h<e.length;h++)e[h].width&&e[h].height&&(f=e[h].width*e[h].height,f>g&&(d=e[h],g=f));d&&d.contentDocument&&
d.contentDocument.documentElement&&(c=d.contentDocument.documentElement)}c||(d=new ExtractContentJS.LayeredExtractor,d.addHandler(d.factory.getHandler("Heuristics")),d=d.extract(a),d.isSuccess&&(d=d.content.asNode(),c=Downsha.Utils.getElementForNode(d)));return c};Downsha.Utils.isArticleSane=function(a,b,c){if(a&&b&&c){var d=c.width*c.height;if(!(c.top>b*Downsha.Utils.MAX_ARTICLE_XOFFSET_RATIO)&&!(d<Downsha.Utils.MIN_ARTICLE_AREA&&d<a*b*Downsha.Utils.MIN_ARTICLE_RATIO))return!0}return!1};
Downsha.Utils.MESSAGE_ATTR="message";Downsha.Utils.PLACEHOLDER_ATTR="placeholder";Downsha.Utils.TITLE_ATTR="title";Downsha.Utils.MESSAGE_DATA_ATTR="messagedata";Downsha.Utils.LOCALIZED_ATTR="localized";Downsha.Utils.BADGE_NORMAL_COLOR=[255,0,0,255];Downsha.Utils.BADGE_UPLOADING_COLOR=[255,255,0,255];Downsha.Utils.updateBadge=function(a,b){Downsha.Utils.clearBadge(b);Downsha.Utils.setBadgeTitle(chrome.i18n.getMessage("BrowserActionTitle"),b)};
Downsha.Utils.clearBadge=function(a){var b={text:""};"number"==typeof a?this.doInSpecifiedTab(a,function(){b.tabId=a;chrome.browserAction.setBadgeText(b)}):this.clearAllBadges()};Downsha.Utils.clearAllBadges=function(){this.doInEveryNormalTab(function(a){chrome.browserAction.setBadgeText({tabId:a.id,text:""})},!0)};
Downsha.Utils.setBadgeBackgroundColor=function(a,b){var c={color:a};"number"==typeof b?this.doInSpecifiedTab(b,function(){c.tabId=b;chrome.browserAction.setBadgeBackgroundColor(c)}):this.doInEveryNormalTab(function(a){c.tabId=a.id;chrome.browserAction.setBadgeBackgroundColor(c)},!0)};
Downsha.Utils.setBadgeText=function(a,b){if(a){var c={text:""+a};"number"==typeof b?this.doInSpecifiedTab(b,function(){c.tabId=b;chrome.browserAction.setBadgeText(c)}):this.doInEveryNormalTab(function(a){c.tabId=a.id;chrome.browserAction.setBadgeText(c)},!0)}else null==a&&Downsha.Utils.clearBadge(b)};
Downsha.Utils.setBadgeTitle=function(a,b){if(a){var c={title:""+a};"number"==typeof b?this.doInSpecifiedTab(b,function(){c.tabId=b;chrome.browserAction.setTitle(c)}):this.doInEveryNormalTab(function(a){c.tabId=a.id;chrome.browserAction.setTitle(c)},!0)}else null==a&&Downsha.Utils.clearBadgeTitle(b)};
Downsha.Utils.clearBadgeTitle=function(a){var b={title:""};"number"==typeof a?this.doInSpecifiedTab(a,function(){b.tabId=a;chrome.browserAction.setTitle(b)}):this.doInEveryNormalTab(function(a){b.tabId=a.id;chrome.browserAction.setTitle(b)},!0)};Downsha.Utils.doInSpecifiedTab=function(a,b){"number"==typeof a&&chrome.tabs.get(a,function(a){"undefined"!=typeof a&&null!=a&&b()})};
Downsha.Utils.doInEveryNormalTab=function(a,b){chrome.windows.getAll({populate:!0},function(c){for(var d=0;d<c.length;d++)if("normal"==c[d].type)for(var e=0;e<c[d].tabs.length;e++)(!b||c[d].tabs[e].selected)&&a(c[d].tabs[e],c[d])})};
Downsha.Utils.localizeBlock=function(a){a.attr(Downsha.Utils.MESSAGE_ATTR)&&Downsha.Utils.localizeElement(a);for(var a=a.find("["+Downsha.Utils.MESSAGE_ATTR+"], ["+Downsha.Utils.PLACEHOLDER_ATTR+"], ["+Downsha.Utils.TITLE_ATTR+"]"),b=0;b<a.length;b++){var c=$(a.get(b));Downsha.Utils.localizeElement(c)}};Downsha.Utils.extractLocalizationField=function(a){return"function"==typeof a.attr&&a.attr(Downsha.Utils.MESSAGE_ATTR)?a.attr(Downsha.Utils.MESSAGE_ATTR):null};
Downsha.Utils.extractLocalizationDataField=function(a){if("function"==typeof a.attr&&a.attr(Downsha.Utils.MESSAGE_DATA_ATTR)){a=a.attr(Downsha.Utils.MESSAGE_DATA_ATTR);try{a=eval(a)}catch(b){}a instanceof Array||(a=[a]);return a}return null};Downsha.Utils.extractLocalizationPlaceholderField=function(a){return"function"==typeof a.attr&&a.attr(Downsha.Utils.PLACEHOLDER_ATTR)?a.attr(Downsha.Utils.PLACEHOLDER_ATTR):null};
Downsha.Utils.extractLocalizationTitleField=function(a){return"function"==typeof a.attr&&a.attr(Downsha.Utils.TITLE_ATTR)?a.attr(Downsha.Utils.TITLE_ATTR):null};
Downsha.Utils.localizeElement=function(a,b){if(b||!(a.attr(Downsha.Utils.LOCALIZED_ATTR)&&"true"==a.attr(Downsha.Utils.LOCALIZED_ATTR))){var c=Downsha.Utils.extractLocalizationField(a),d=Downsha.Utils.extractLocalizationPlaceholderField(a),e=Downsha.Utils.extractLocalizationTitleField(a),f=Downsha.Utils.extractLocalizationDataField(a),g=!1;"string"==typeof c&&""!=c&&(c=f?chrome.i18n.getMessage(c,f):chrome.i18n.getMessage(c),"INPUT"==a.prop("tagName")?a.val(c):a.html(c),g=!0);"string"==typeof d&&""!=
d&&(c=chrome.i18n.getMessage(d),a.attr(Downsha.Utils.PLACEHOLDER_ATTR,c),g=!0);"string"==typeof e&&""!=e&&(c=chrome.i18n.getMessage(e),a.attr(Downsha.Utils.TITLE_ATTR,c),g=!0);g&&a.attr(Downsha.Utils.LOCALIZED_ATTR,"true")}};Downsha.Utils.notifyExtension=function(a,b){chrome.windows.getCurrent(function(c){chrome.tabs.getSelected(c.id,function(c){var c={tab:c,id:chrome.i18n.getMessage("@@extension_id")},e=b||function(){};chrome.extension.onRequest.dispatch(a,c,e);chrome.extension.sendRequest(a,e)})})};
Downsha.Utils._setDesktopNotificationAttributes=function(a,b){if(a&&"object"==typeof b&&b)for(var c in b)a[c]=b[c]};Downsha.Utils.notifyDesktop=function(a,b,c,d){var e=webkitNotifications.createNotification("images/downsha48.png",a,b);this._setDesktopNotificationAttributes(e,d);e.show();"number"==typeof c&&setTimeout(function(){e.cancel()},c);return e};
Downsha.Utils.notifyDesktopWithHTML=function(a,b,c){var d=webkitNotifications.createHTMLNotification(a);this._setDesktopNotificationAttributes(d,c);d.show();"number"==typeof b&&setTimeout(function(){d.cancel()},b);return d};Downsha.Utils.openWindow=function(a){chrome.extension.getBackgroundPage().Downsha.chromeExtension.openWindow(a)};
Downsha.Utils.getPostData=function(a){"undefined"==typeof a&&(a=window.location.search.replace(/^\?/,""));var b={};if(a)for(var a=a.split("&"),c=0;c<a.length;c++){var d=a[c].split("="),e=unescape(d[0]);if(d=d[1]?unescape(d[1]):null)try{b[e]=JSON.parse(d)}catch(f){b[e]=d}else b[e]=d}return b};
Downsha.Utils.isForbiddenUrl=function(a){return"string"==typeof a&&(0<=a.toLowerCase().indexOf("chrome.google.com/extensions")||0<=a.toLowerCase().indexOf("chrome.google.com/webstore")||0<=a.toLowerCase().indexOf("ext.chrome.360.cn"))||"string"==typeof a&&!a.toLowerCase().match(/^https?:\/\//)?!0:!1};
Downsha.Utils.getTextSize=function(a){var b=$("<div></div>");b.text(a);b.css({position:"absolute",top:"0px",left:"0px",padding:"0px",margin:"0px",display:"block",zIndex:"0",color:"rgba(0, 0, 0, 0)",background:"rgba(0, 0, 0, 0)"});$("body").append(b);a={width:b.width(),height:b.height()};b.remove();return a};
Downsha.Utils.updateSelectElementWidth=function(a,b){var c=a instanceof jQuery?a:$(a),d=c.val();"function"==typeof b&&(d=b(d));var e=parseInt(c.css("paddingLeft")),f=parseInt(c.css("paddingRight")),e=(!isNaN(e)?e:0)+(!isNaN(f)?f:0),d=Downsha.Utils.getTextSize(d).width,d=(d?d:0)+e+10;c.css({minWidth:d+"px",width:d+"px"})};
Downsha.Utils.resizeElement=function(a,b,c){var a=a instanceof jQuery?a:$(a),d={},e={};if(b&&"number"==typeof b.width){var f=parseInt(a.css("paddingLeft")),g=parseInt(a.css("paddingRight")),f=(!isNaN(f)?f:0)+(!isNaN(g)?g:0);e.width=b.width+f;d.minWidth=e.width+"px";d.width=e.width+"px"}b&&"number"==typeof b.height&&(f=parseInt(a.css("paddingTop")),g=parseInt(a.css("paddingBottom")),f=(!isNaN(f)?f:0)+(!isNaN(g)?g:0),e.height=b.height+f,d.minHeight=e.height+"px",css.height=e.height+"px");a.css(d);"function"==
typeof c&&c(a,e)};Downsha.Utils.BAD_FAV_ICON_URLS=["http://localhost/favicon.ico"];
Downsha.Utils.createUrlClipContent=function(a,b,c){a=a?Downsha.Utils.escapeXML(a):"";b='<a title="'+a+'" style="font-size: 12pt; line-height: 18px; display: inline;" href="'+b+'">'+b+"</a>";return b="string"==typeof c&&0<c.length&&0>Downsha.Utils.BAD_FAV_ICON_URLS.indexOf(c.toLowerCase())?'<span><img title="'+a+'" style="display:inline;border: none; width: 16px; height: 16px; padding: 0px; margin: 0px 8px -2px 0px;" src="'+c+'"/>'+b+"</span>":"<span>"+b+"</span>"};
Downsha.Utils.getNodeString=function(a){var b=null;if("object"!=typeof a||null==a)b="[null]";else if(a&&a.nodeType==Node.TEXT_NODE)b="string"==typeof a.nodeValue&&0<a.nodeValue.length?a.nodeName+" "+a.nodeValue:a.nodeName+" [empty]";else if(a&&a.nodeType==Node.ELEMENT_NODE){for(var b="<"+a.nodeName,a=a.attributes,c=0;c<a.length;c++)a[c]&&a[c].name&&a[c].specified&&(b=a[c].value?b+(" "+a[c].name+'="'+a[c].value+'"'):b+(" "+a[c].name));b+=">"}else b="node","string"==typeof a.nodeName&&0<a.nodeName.length&&
(b+=" name: "+a.nodeName),"number"==typeof a.nodeType&&(b+=" type: "+a.nodeType),"string"==typeof a.nodeValue&&0<a.nodeValue.length&&(b+=" value: "+a.nodeValue);return b};Downsha.Semaphore=function(a){this.__defineGetter__("excessSignals",this.getExcessSignals);this.initialize(a)};Downsha.inherit(Downsha.Semaphore,Array);Downsha.Semaphore.mutex=function(){var a=new Downsha.Semaphore;a.signal();return a};Downsha.Semaphore.prototype._excessSignals=0;
Downsha.Semaphore.prototype.initialize=function(a){this._excessSignals=parseInt(a);isNaN(this._excessSignals)&&(this._excessSignals=0)};Downsha.Semaphore.prototype.getExcessSignals=function(){return this._excessSignals};Downsha.Semaphore.prototype.hasExcessSignals=function(){return 0<this._excessSignals?!0:!1};Downsha.Semaphore.prototype.signal=function(){0==this.length?this._excessSignals++:this._processNext()};
Downsha.Semaphore.prototype.wait=function(){0<this._excessSignals&&(this._excessSignals--,this._processNext())};Downsha.Semaphore.prototype.critical=function(a){var b=this,c=function(){try{a()}catch(c){throw b.signal(),c;}};c._semaOrigFn=a;this.push(c);this.wait()};Downsha.Semaphore.prototype.wave=function(){0<this.length&&this.shift()};Downsha.Semaphore.prototype.waveAll=function(){0<this.length&&this.splice(0,this.length)};
Downsha.Semaphore.prototype.waveEach=function(a){for(var b=0;b<this.length;)a(this[b]._semaOrigFn)?this.splice(b,1):b++};Downsha.Semaphore.prototype._processNext=function(){if(0<this.length){var a=this.shift();"function"==typeof a&&a()}};Downsha.Semaphore.prototype.toString=function(){return this._excessSignals+":["+this.join(",")+"]"};
Downsha.XORCrypt={DELIMIT:":",LENGTH:128,_padString:function(a){var b=0;if(128>a.length)for(var c=a.length;128>=c;c++)a=String.fromCharCode(this._randomForChar())+a,b++;return b+this.DELIMIT+a},_randomForChar:function(){for(var a=0,b=0;33>a||126<a;)a=parseInt(150*Math.random()),b++;return a},_randomNonZero:function(){for(var a=0;0==(a=parseInt(100*Math.random())););return a},_shiftString:function(a){for(var b=this._randomNonZero()+100,c=[],d=0;d<a.length;d++)c.push(String.fromCharCode(a.charCodeAt(d)+
b));return b+this.DELIMIT+c.join("")},_unshiftString:function(a){var b=parseInt(a.substring(0,a.indexOf(this.DELIMIT))),c=[];if(!isNaN(b))for(var d=(b+"").length+this.DELIMIT.length;d<a.length;d++)c.push(String.fromCharCode(a.charCodeAt(d)-b));return c.join("")},encrypt:function(a,b){for(var b=b+"",c=this._padString(this._shiftString(a+"")),d=[],e=0;e<c.length;e++){for(var f=c.charCodeAt(e),g=0;g<b.length;g++)f^=b.charCodeAt(g);d.push(String.fromCharCode(f+100))}return d.join("")},decrypt:function(a,
b){for(var a=a+"",b=b+"",c=[],d=0;d<a.length;d++){for(var e=a.charCodeAt(d)-100,f=b.length-1;0<=f;f--)e^=b.charCodeAt(f);c.push(String.fromCharCode(e))}c=c.join("");d=parseInt(c.substring(0,c.indexOf(this.DELIMIT)));return!isNaN(d)?this._unshiftString(c.substring((""+d).length+this.DELIMIT.length+d)):""}};
(function(){Downsha.getContext=function(){null==Downsha._context&&(Downsha._context=new Downsha.DownshaContext);return Downsha._context};Downsha.__defineGetter__("context",Downsha.getContext);Downsha.__defineGetter__("contextInitialized",function(){return Downsha._context?!0:!1});Downsha.DownshaContext=function(){Downsha.Logger.getInstance();this.__defineGetter__("userId",this.getUserId);this.__defineSetter__("userId",this.setUserId);this.__defineGetter__("userName",this.getUserName);this.__defineSetter__("userName",
this.setUserName);this.__defineGetter__("userPass",this.getUserPass);this.__defineSetter__("userPass",this.setUserPass);this.__defineGetter__("sessTime",this.getSessTime);this.__defineSetter__("sessTime",this.setSessTime);this.__defineGetter__("sessId",this.getSessId);this.__defineSetter__("sessId",this.setSessId);this.__defineGetter__("hardId",this.getHardId);this.__defineSetter__("hardId",this.setHardId);this.__defineGetter__("termId",this.getTermId);this.__defineSetter__("termId",this.setTermId);
this.__defineGetter__("termClass",this.getTermClass);this.__defineSetter__("termClass",this.setTermClass);this.__defineGetter__("termType",this.getTermType);this.__defineSetter__("termType",this.setTermType);this.__defineGetter__("version",this.getVersion);this.__defineSetter__("version",this.setVersion);this.__defineGetter__("remote",this.getRemote);this.__defineSetter__("remote",this.setRemote);this.__defineGetter__("store",this.getStore);this.__defineSetter__("store",this.setStore);this.__defineGetter__("serviceProto",
this.getServiceProto);this.__defineSetter__("serviceProto",this.setServiceProto);this.__defineGetter__("serviceDomain",this.getServiceDomain);this.__defineSetter__("serviceDomain",this.setServiceDomain);this.__defineGetter__("extensionId",this.getExtensionId);this.__defineGetter__("extensionPath",this.getExtensionPath);this.__defineGetter__("options",this.getOptions);this.__defineSetter__("options",this.setOptions);this.__defineGetter__("logLevel",this.getLogLevel);this.__defineGetter__("locale",
this.getLocale);this.__defineSetter__("locale",this.setLocale);this.__defineGetter__("userKnown",this.isUserKnown);this.__defineGetter__("rememberedSession",this.isRememberedSession);this.__defineSetter__("rememberedSession",this.setRememberedSession);this.initialize()};Downsha.DownshaContext.HOME_PATH="http://www.downsha.com/";Downsha.DownshaContext.DESKTOP_PATH="http://www.downsha.com/version/YunZhaiSetup.exe";Downsha.DownshaContext.MOBILE_PATH="http://www.downsha.com/version/yunzhai_android.apk";
Downsha.DownshaContext.WINDOWS8_PATH="http://apps.microsoft.com/webpdp/zh-CN/app/a6605203-4a28-46ec-8e79-abb872475d20";Downsha.DownshaContext.CHROME_PATH="https://chrome.google.com/webstore/detail/%E5%BD%93%E4%B8%8B%E4%BA%91%E6%91%98/fjfgeonblbdcofcokojamlcnomcdliap";Downsha.DownshaContext.FIREFOX_PATH="https://addons.mozilla.org/zh-CN/firefox/addon/yunzhai/";Downsha.DownshaContext.SERVICE_PROTO="http://";Downsha.DownshaContext.SERVICE_DOMAIN="ysync.downsha.com";Downsha.DownshaContext.YUNZHAI_PATH=
"/yunzhai.so";Downsha.DownshaContext.VIEW_PATH="/view";Downsha.DownshaContext.ARTICPAT_PATH="/articpat.so";Downsha.DownshaContext.SESS_ID="0";Downsha.DownshaContext.USER_ID=0;Downsha.DownshaContext.TERM_ID=0;Downsha.DownshaContext.DEFAULT_LOCALE="default";Downsha.DownshaContext.prototype._userId=null;Downsha.DownshaContext.prototype._userName=null;Downsha.DownshaContext.prototype._userPass=null;Downsha.DownshaContext.prototype._sessTime=null;Downsha.DownshaContext.prototype._sessId=null;Downsha.DownshaContext.prototype._hardId=
null;Downsha.DownshaContext.prototype._termId=null;Downsha.DownshaContext.prototype._termClass=null;Downsha.DownshaContext.prototype._termType=null;Downsha.DownshaContext.prototype._version=null;Downsha.DownshaContext.prototype._store=null;Downsha.DownshaContext.prototype._serviceProto=null;Downsha.DownshaContext.prototype._serviceDomain=null;Downsha.DownshaContext.prototype._options=null;Downsha.DownshaContext.prototype._locale=null;Downsha.DownshaContext.prototype._rememberedSession=!0;Downsha.DownshaContext.prototype._remote=
null;Downsha.DownshaContext.prototype.initialize=function(){this.initVersion()};Downsha.DownshaContext.prototype.destroy=function(){};Downsha.DownshaContext.prototype.initVersion=function(){var a=this,b=function(b){if("string"==typeof b&&""!=b&&(b=b.split(".")))a._version=281474976710656*parseInt(b[0])+4294967296*parseInt(b[1])+65536*parseInt(b[2])+parseInt(b[3])};try{var c=chrome.app.getDetails().version;if(c)return b(c)}catch(d){}try{var e=new XMLHttpRequest;e.open("GET","manifest.json");e.onload=
function(){if(e.responseText){var a=e.responseText.match(/['"]version['"]\s*:\s*['"](\d+\.\d+\.\d+\.\d+)['"]/);a&&a[1]&&b(a[1])}};e.send(null)}catch(f){}};Downsha.DownshaContext.prototype.setServiceProto=function(a){var b=!1;"string"==typeof a&&this._serviceProto!=a?(this._serviceProto=a,b=!0):null==a&&null!=this._serviceProto&&(this._serviceProto=null,b=!0);b&&this.store&&this.store.put("serviceProto",this._serviceProto)};Downsha.DownshaContext.prototype.getServiceProto=function(){null==this._serviceProto&&
this.store&&(this._serviceProto=this.store.get("serviceProto"));return null!=this._serviceProto?this._serviceProto:Downsha.DownshaContext.SERVICE_PROTO};Downsha.DownshaContext.prototype.setServiceDomain=function(a){var b=!1;"string"==typeof a&&this._serviceDomain!=a?(this._serviceDomain=a,b=!0):null==a&&null!=this._serviceDomain&&(this._serviceDomain=null,b=!0);b&&this.store&&this.store.put("serviceDomain",this._serviceDomain)};Downsha.DownshaContext.prototype.getServiceDomain=function(){null==this._serviceDomain&&
this.store&&(this._serviceDomain=this.store.get("serviceDomain"));return null!=this._serviceDomain?this._serviceDomain:Downsha.DownshaContext.SERVICE_DOMAIN};Downsha.DownshaContext.prototype.getServiceUrl=function(){return this.serviceProto+this.serviceDomain};Downsha.DownshaContext.prototype.getHomeUrl=function(){return Downsha.DownshaContext.HOME_PATH};Downsha.DownshaContext.prototype.getDesktopUrl=function(){return Downsha.DownshaContext.DESKTOP_PATH};Downsha.DownshaContext.prototype.getMobileUrl=
function(){return Downsha.DownshaContext.MOBILE_PATH};Downsha.DownshaContext.prototype.getWindows8Url=function(){return Downsha.DownshaContext.WINDOWS8_PATH};Downsha.DownshaContext.prototype.getChromeUrl=function(){return Downsha.DownshaContext.CHROME_PATH};Downsha.DownshaContext.prototype.getFirefoxUrl=function(){return Downsha.DownshaContext.FIREFOX_PATH};Downsha.DownshaContext.prototype.getNoteListUrl=function(){return this.getServiceUrl()+Downsha.DownshaContext.VIEW_PATH+"?uid="+this.userId+"&border=0&perpage=3&topbar=0&bottombar=1&bartype=1"};
Downsha.DownshaContext.prototype.getYunzhaiUrl=function(a){return"undefined"!=typeof a?this.getServiceUrl()+Downsha.DownshaContext.YUNZHAI_PATH+"?cmdid="+a:this.getServiceUrl()+Downsha.DownshaContext.YUNZHAI_PATH};Downsha.DownshaContext.prototype.getArticpatUrl=function(){return this.getServiceUrl()+Downsha.DownshaContext.ARTICPAT_PATH};Downsha.DownshaContext.prototype.getLocale=function(){this._locale||(this._locale=chrome.i18n.getMessage("@@ui_locale"));return!this._locale?this.constructor.DEFAULT_LOCALE:
this._locale};Downsha.DownshaContext.prototype.setLocale=function(a){this._locale="string"==typeof a&&0<a.length?a:null};Downsha.DownshaContext.prototype.isUserKnown=function(){return(this.userId||this.userName)&&this.userPass?!0:!1};Downsha.DownshaContext.prototype.getExtensionId=function(){return chrome.i18n.getMessage("@@extension_id")};Downsha.DownshaContext.prototype.getExtensionPath=function(a){return"chrome-extension://"+this.extensionId+"/"+("string"==typeof a?a:"")};Downsha.DownshaContext.prototype.setRemote=
function(a){a instanceof Downsha.ChromeExtensionRemote&&(this._remote=a)};Downsha.DownshaContext.prototype.getRemote=function(){this._remote||(this._remote=new Downsha.ChromeExtensionRemote);return this._remote};Downsha.DownshaContext.prototype.setStore=function(a){a instanceof Downsha.LocalStore?this._store=a:null==a&&(this._store=null)};Downsha.DownshaContext.prototype.getStore=function(){!this._store&&Downsha.chromeExtension.localStore&&(this._store=Downsha.chromeExtension.localStore);return this._store};
Downsha.DownshaContext.prototype.resetUser=function(){this.sessId=this.sessTime=this.userPass=this.userName=this.userId=null};Downsha.DownshaContext.prototype.getUserId=function(){if(null==this._userId&&null!=this.store){var a=parseInt(this.store.get("userId"));isNaN(a)||(this._userId=a)}return null!=this._userId?this._userId:Downsha.DownshaContext.USER_ID};Downsha.DownshaContext.prototype.setUserId=function(a){null!=a?(a=parseInt(a),isNaN(a)||(this._userId=a,null!=this.store&&this.store.put("userId",
this._userId))):(this._userId=null,null!=this.store&&this.store.remove("userId"))};Downsha.DownshaContext.prototype.getUserName=function(){null==this._userName&&null!=this.store&&(this._userName=this.store.get("userName"));return this._userName};Downsha.DownshaContext.prototype.setUserName=function(a){null!=a?(this._userName=a,null!=this.store&&this.store.put("userName",this._userName)):(this._userName=null,null!=this.store&&this.store.remove("userName"))};Downsha.DownshaContext.prototype.getUserPass=
function(){null==this._userPass&&null!=this.store&&(this._userPass=this.store.get("userPass"));return this._userPass};Downsha.DownshaContext.prototype.setUserPass=function(a){null!=a?(this._userPass=a,null!=this.store&&this.store.put("userPass",this._userPass)):(this._userPass=null,null!=this.store&&this.store.remove("userPass"))};Downsha.DownshaContext.prototype.getSessId=function(){null==this._sessId&&null!=this.store&&(this._sessId=this.store.get("sessId"));return null!=this._sessId?this._sessId:
Downsha.DownshaContext.SESS_ID};Downsha.DownshaContext.prototype.setSessId=function(a){null!=a?(this._sessId=a,null!=this.store&&this.store.put("sessId",this._sessId)):(this._sessId=null,null!=this.store&&this.store.remove("sessId"))};Downsha.DownshaContext.prototype.getSessTime=function(){if(null==this._sessTime&&null!=this.store){var a=parseInt(this.store.get("sessTime"));isNaN(a)||(this._sessTime=a)}return this._sessTime};Downsha.DownshaContext.prototype.setSessTime=function(a){null!=a?(a=parseInt(a),
isNaN(a)||(this._sessTime=a,null!=this.store&&this.store.put("sessTime",this._sessTime))):(this._sessTime=null,null!=this.store&&this.store.remove("sessTime"))};Downsha.DownshaContext.prototype.generateHardId=function(){for(var a="",b=0;32>b;b++)var c=Math.floor(16*Math.random()),c=10>c?c+48:c+55,a=a+String.fromCharCode(c);return a};Downsha.DownshaContext.prototype.getHardId=function(){null==this._hardId&&null!=this.store&&(this._hardId=this.store.get("hardId"));null==this._hardId&&(this.hardId=this.generateHardId());
return this._hardId};Downsha.DownshaContext.prototype.setHardId=function(a){null!=a?(this._hardId=a,null!=this.store&&this.store.put("hardId",this._hardId)):(this._hardId=null,null!=this.store&&this.store.remove("hardId"))};Downsha.DownshaContext.prototype.getTermId=function(){if(null==this._termId&&null!=this.store){var a=parseInt(this.store.get("termId"));isNaN(a)||(this._termId=a)}return null!=this._termId?this._termId:Downsha.DownshaContext.TERM_ID};Downsha.DownshaContext.prototype.setTermId=
function(a){null!=a?(a=parseInt(a),isNaN(a)||(this._termId=a,null!=this.store&&this.store.put("termId",this._termId))):(this._termId=null,null!=this.store&&this.store.remove("termId"))};Downsha.DownshaContext.prototype.getTermClass=function(){null==this._termClass&&(this._termClass=Downsha.DownshaTerm.TERM_CLASS.PLUGIN);return this._termClass};Downsha.DownshaContext.prototype.setTermClass=function(a){this._termClass=a};Downsha.DownshaContext.prototype.getTermType=function(){null==this._termType&&
(this._termType=0<=navigator.userAgent.indexOf("360EE")?Downsha.DownshaTerm.TERM_TYPE.EE360:0<=navigator.userAgent.indexOf("LBBROWSER")?Downsha.DownshaTerm.TERM_TYPE.LIEBAO:Downsha.DownshaTerm.TERM_TYPE.CHROME);return this._termType};Downsha.DownshaContext.prototype.setTermType=function(a){this._termType=a};Downsha.DownshaContext.prototype.getVersion=function(){return this._version};Downsha.DownshaContext.prototype.setVersion=function(a){this._version=a};Downsha.DownshaContext.prototype.isRememberedSession=
function(){null!=this.store&&(this._rememberedSession=this.store.get("rememberedSession")?!0:!1);return this._rememberedSession};Downsha.DownshaContext.prototype.setRememberedSession=function(a){this._rememberedSession=a?!0:!1;null!=this.store&&this.store.put("rememberedSession",this._rememberedSession)};Downsha.DownshaContext.prototype.setOptions=function(a){var b=!1;a instanceof Downsha.Options?(this._options=a,b=!0):null==a&&(this._options=null,b=!0);b&&this.store&&(this.options?this.store.put("options",
this._options):this.store.remove("options"))};Downsha.DownshaContext.prototype.getOptions=function(a){if(this.store&&(null==this._options||a))if(a=this.store.get("options"))this._options=new Downsha.Options(this,a);null==this._options&&(this._options=new Downsha.Options(this,{serviceProto:this.serviceProto,serviceDomain:this.serviceDomain}));return this._options};Downsha.DownshaContext.prototype.getLogLevel=function(){return this.options.debugLevel};Downsha.DownshaContext.prototype.getPreferredStylingStrategyName=
function(){var a=this.getOptions(!0),b=null;a&&a.clipStyle==Downsha.Options.CLIP_STYLE_OPTIONS.TEXT?b="ClipTextStylingStrategy":a&&a.clipStyle==Downsha.Options.CLIP_STYLE_OPTIONS.FULL&&(b="ClipFullStylingStrategy");return b};Downsha.DownshaContext.prototype.getPreferredStylingStrategyQualifier=function(){var a=this.getPreferredStylingStrategyName();return a?"Downsha."+a:"null"};Downsha.DownshaContext.prototype.getCookie=function(a,b,c,d,e){var f=this;if("object"==typeof chrome&&null!=chrome&&chrome.cookies){var g=
{url:this.getServiceUrl(),name:a};d?(g.storeId=d,chrome.cookies.get(g,function(d){"object"==typeof d&&null!=d&&d.value?b(d):e instanceof Array&&0<e.length?(d=e.pop(),f.getCookie(a,b,c,d.id,e)):c()})):chrome.cookies.getAllCookieStores(function(d){if(d instanceof Array&&0<d.length){var e=d.pop();f.getCookie(a,b,c,e.id,d)}else c()})}else"function"==typeof c&&setTimeout(c,0)};Downsha.DownshaContext.prototype.removeCookie=function(a,b){if("object"==typeof chrome&&null!=chrome&&chrome.cookies){var c=this,
d={url:this.getServiceUrl(),name:a};b?(d.storeId=b,chrome.cookies.remove(d)):chrome.cookies.getAllCookieStores(function(b){if(b instanceof Array)for(var d=0;d<b.length;d++)c.removeCookie(a,b[d].id)})}};Downsha.DownshaContext.prototype.setCookie=function(a,b,c,d,e){"object"==typeof chrome&&null!=chrome&&chrome.cookies&&(a={url:this.getServiceUrl(),name:a,value:b,path:"/"},a.secure=d?!0:!1,c=parseInt(c),isNaN(c)||(a.expirationDate=c),e&&(a.storeId=e),chrome.cookies.set(a))}})();
(function(){var a=null;Downsha.DownshaRemote=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.DownshaRemote.PROTO_VERSION=1;Downsha.DownshaRemote.Command={USER_REGISTER:1,USER_REGISTER_RES:2147483649,USER_LOGIN:2,USER_LOGIN_RES:2147483650,USER_KEEP_ALIVE:3,USER_KEEP_ALIVE_RES:2147483651,USER_LOGOUT:4,USER_LOGOUT_RES:2147483652,USER_PASS_MODIFY:5,USER_PASS_MODIFY_RES:2147483653,USER_PROFILE_MODIFY:6,USER_PROFILE_MODIFY_RES:2147483654,USER_ACCOUNT_CHECK:7,USER_ACCOUNT_CHECK_RES:2147483655,
TERM_INFO_NOTIFY:16,TERM_INFO_NOTIFY_RES:2147483664,TERM_APP_NOTIFY:17,TERM_APP_NOTIFY_RES:2147483665,GET_SYNC_NO:128,GET_SYNC_NO_RES:2147483776,PUSH_SYNC_NO:2147483777,PUT_SYNC_NO:130,PUT_SYNC_NO_RES:2147483778,GET_DIR_LIST:256,GET_DIR_LIST_RES:2147483904,GET_INFO_ITEM_LIST:272,GET_INFO_ITEM_LIST_RES:2147483920,GET_TAG_LIST:288,GET_TAG_LIST_RES:2147483936,PUT_INFO_ITEM:320,PUT_INFO_ITEM_RES:2147483968,PUT_FILE_DESC:321,PUT_FILE_DESC_RES:2147483969,PUT_FILE:322,PUT_FILE_RES:2147483970,GEN_THUMBNAIL:327,
GEN_THUMBNAIL_RES:2147483975,COPY_INFO_ITEM:328,COPY_INFO_ITEM_RES:2147483976,GET_CHANNEL_LIST:4097,GET_CHANNEL_LIST_RES:2147487745,GET_CHANNEL_ITEM_LIST:4098,GET_CHANNEL_ITEM_LIST_RES:2147487746};Downsha.DownshaRemote.Error={OK:0,INVALID_USER_ACCOUNT:-100,USER_ACCOUNT_EXIST:-101,USER_ACCOUNT_NOT_EXIST:-102,USER_ACCOUNT_OPEN_FAILED:-103,USER_PASSWORD_INCORRECT:-104,TERM_INFO_OPEN_FAILED:-105,TERM_INFO_CREATE_FAILED:-106,SESSION_NOT_EXIST:-110,SESSION_CREATE_FAILED:-111,PARA_INVALID:-200,DIR_NAME_EXIST:-210,
DIRID_NOT_EXIST:-211,PARENT_DIRID_NOT_EXIST:-212,INFO_ITEM_CID_NOT_EXIST:-220,INFO_FILE_NOT_EXIST:-221,TAG_NAME_EXIST:-240,TAGID_NOT_EXIST:-241,FILE_CONTENT_NOT_ENOUGH:-300,FILE_CONTENT_NOT_CONSISTENT:-301,RESOURCE_ALLOC_FAILED:-500,CDN_OPEN_FAILED:-501};Downsha.DownshaRemote.CONTENT_TYPE_JSON="application/json";Downsha.DownshaRemote.POST_TIMEOUT=18E4;Downsha.DownshaRemote.GET_TIMEOUT=3E4;Downsha.DownshaRemote.prototype._debugRequestData=!1;Downsha.DownshaRemote.prototype.initialize=function(){this.__defineGetter__("debugRequestData",
this.setDebugRequestData);this.__defineSetter__("debugRequestData",this.isDebugRequestData)};Downsha.DownshaRemote.prototype.isDebugRequestData=function(){return this._debugRequestData};Downsha.DownshaRemote.prototype.setDebugRequestData=function(a){this._debugRequestData=a?!0:!1};Downsha.DownshaRemote.prototype.register=function(b,c,d,e,f){a.debug("DownshaRemote.register");return this.postCommand(this.constructor.Command.USER_REGISTER,{UserName:b,UserPass:c},d,e,f)};Downsha.DownshaRemote.prototype.login=
function(b,c,d,e,f,g){a.debug("DownshaRemote.login");return this.postCommand(this.constructor.Command.USER_LOGIN,{LoginType:1,UserName:b,UserPass:c},e,f,g)};Downsha.DownshaRemote.prototype.logout=function(b,c,d){a.debug("DownshaRemote.logout");return this.postCommand(this.constructor.Command.USER_LOGOUT,{},b,c,d)};Downsha.DownshaRemote.prototype.notifyTermInfo=function(b,c,d,e){a.debug("DownshaRemote.notifyTermInfo");return this.postCommand(this.constructor.Command.TERM_INFO_NOTIFY,b,c,d,e)};Downsha.DownshaRemote.prototype.putInfoItem=
function(b,c,d,e){a.debug("DownshaRemote.putInfoItem");return this.postCommand(this.constructor.Command.PUT_INFO_ITEM,b,c,d,e)};Downsha.DownshaRemote.prototype.putFileDesc=function(b,c,d,e){a.debug("DownshaRemote.putFileDesc");return this.postCommand(this.constructor.Command.PUT_FILE_DESC,b,c,d,e)};Downsha.DownshaRemote.prototype.putFile=function(b,c,d,e){a.debug("DownshaRemote.putFile");return this.postCommand(this.constructor.Command.PUT_FILE,b,c,d,e,!0)};Downsha.DownshaRemote.prototype.genThumbnail=
function(b,c,d,e){a.debug("DownshaRemote.genThumbnail");return this.postCommand(this.constructor.Command.GEN_THUMBNAIL,b,c,d,e)};Downsha.DownshaRemote.prototype.copyInfoItem=function(b,c,d,e){a.debug("DownshaRemote.copyInfoItem");return this.postCommand(this.constructor.Command.COPY_INFO_ITEM,b,c,d,e)};Downsha.DownshaRemote.prototype.getChannelList=function(b,c,d,e){a.debug("DownshaRemote.getChannelList");return this.postCommand(this.constructor.Command.GET_CHANNEL_LIST,b,c,d,e)};Downsha.DownshaRemote.prototype.getChannelItemList=
function(b,c,d,e){a.debug("DownshaRemote.getChannelItemList");return this.postCommand(this.constructor.Command.GET_CHANNEL_ITEM_LIST,b,c,d,e)};Downsha.DownshaRemote.prototype.getInfoItemList=function(b,c,d,e){a.debug("DownshaRemote.getInfoItemList");return this.postCommand(this.constructor.Command.GET_INFO_ITEM_LIST,b,c,d,e)};Downsha.DownshaRemote.prototype.postCommand=function(a,c,d,e,f,g){var h=(new Downsha.DSTPRequest(a)).toJSON();Downsha.extendObject(h,c);return this.postJson(Downsha.getContext().getYunzhaiUrl(a),
h,d,e,f,g)};Downsha.DownshaRemote.prototype.postJson=function(a,c,d,e,f,g){return this.doRequest("POST","json",a,c,d,e,f,g)};Downsha.DownshaRemote.prototype.getJson=function(a,c,d,e,f){return this.doRequest("GET","json",a,c,d,e,f)};Downsha.DownshaRemote.prototype.doRequest=function(b,c,d,e,f,g,h,i){null==b&&(b="GET");var j=this,m={meth:b,dataType:c,url:d,data:e,success:f,failure:g,processResponse:h,multipart:i};m.__defineGetter__("arguments",function(){return[this.meth,this.dataType,this.url,this.data,
this.success,this.failure,this.processResponse,this.multipart]});if(a.isDebugEnabled()){var l=this.debugAjaxDataObject(e);a.debug("doRequest("+b+", "+c+", "+d+", "+l+")")}var n=function(b,c,d){a.debug("Downsha.DownshaRemote.doRequest failed response");if(h)try{j.handleHttpError(b,c,d,m)}catch(e){throw a.error(e&&e.message?e.message:e),e;}"function"==typeof g&&g(b,c,d)},c={url:d,async:!0,cache:!1,dataType:c,error:n,success:function(b,c,d){if(0==d.status)return n(d,c,b);a.debug("Downsha.DownshaRemote.doRequest successfull response");
a.debug("response data: "+JSON.stringify(b));var e=b;if(h)try{e=j.handleHttpSuccess(b,c,d,m)}catch(g){throw g;}"function"==typeof f&&f(e,c,d)},processData:!1,type:b};if(i&&"POST"==b){var i=new FormData,k;for(k in e)if("object"==typeof e[k]&&e[k]instanceof Array){d=new Uint8Array(e[k]);l=null;try{window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var o=new BlobBuilder;o.append(d.buffer);l=o.getBlob()}catch(p){l=new Blob([d.buffer])}l&&i.append(k,
l)}else i.append(k,e[k]);c.contentType=!1;c.data=i}else c.contentType=Downsha.DownshaRemote.CONTENT_TYPE_JSON,c.data=JSON.stringify(e);c.timeout="POST"==b?this.constructor.POST_TIMEOUT:this.constructor.GET_TIMEOUT;a.debug(">>> Making request for: "+c.url);return $.ajax(c)};Downsha.DownshaRemote.prototype.debugAjaxDataObject=function(a){var c="";if(this._debugRequestData)try{var d={},e;for(e in a)d[e]="object"==typeof a[e]&&a[e]instanceof Array?a[e].length:a[e];c=JSON.stringify(d)}catch(f){}else{c=
[];for(e in a)c.push(e);c="{"+c.toString()+"}"}return c};Downsha.DownshaRemote.prototype.handleHttpSuccess=function(b,c,d){a.debug("Downsha.DownshaRemote.handleHttpSuccess");try{var e=Downsha.DSTPResponse.createFrom(b)}catch(f){if(b="",f instanceof Downsha.DownshaError)b=f.errorCode,a.error("Exception creating Downsha.DSTPResponse: "+b);else throw f;}a.debug("HTTP ["+d.status+", "+c+"] Status: "+e.Status);return e};Downsha.DownshaRemote.prototype.handleHttpError=function(b,c,d){4!=b.readyState?a.error("HTTP [readyState: "+
b.readyState+"]"):a.error("HTTP [readyState: "+b.readyState+", status: "+b.status+", textStatus: "+c+"] error: "+d)}})();
(function(){Downsha.MutableXMLHttpRequest=function(){Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.MutableXMLHttpRequest,XMLHttpRequest,!0);Downsha.MutableXMLHttpRequest.prototype.initialize=function(){var a=this,b;for(b in this.__proto__)if(0==b.indexOf("on")){var c=function(b){a["_"+arguments.callee._fieldName]=b};c._fieldName=b;this.__defineSetter__(b,c);c=function(){var b=arguments.callee._fieldName;return function(){if("function"==typeof a["_"+b])a["_"+b]();if("function"==
typeof a["_proto_"+b])a["_proto_"+b]()}};c._fieldName=b;this.__defineGetter__(b,c);this["_proto_"+b]=this.__proto__[b]}};Downsha.MutableXMLHttpRequest.prototype.become=function(a){if(a instanceof XMLHttpRequest){var b=this.__proto__;this.__proto__=a;this.constructor=Downsha.MutableXMLHttpRequest;for(var c in this)0==c.indexOf("on")&&this.hasOwnProperty(c)&&(b[c]=this["_proto_"+c],this["_proto_"+c]=this.__proto__[c],this.__proto__[c]=this[c]);for(c in this.constructor.prototype)if(this.constructor.prototype.hasOwnProperty(c)&&
!this.__proto__.hasOwnProperty(c))try{this.__proto__[c]=this.constructor.prototype[c]}catch(d){}}}})();
(function(){Downsha.DSTPRequest=function(a){Downsha.Logger.getInstance();this.initialize(a)};Downsha.DSTPRequest.prototype.Cmdid=null;Downsha.DSTPRequest.prototype.Seqid=null;Downsha.DSTPRequest.prototype.Protover=null;Downsha.DSTPRequest.prototype.UID=null;Downsha.DSTPRequest.prototype.SessID=null;Downsha.DSTPRequest.prototype.HID=null;Downsha.DSTPRequest.prototype.TID=null;Downsha.DSTPRequest.prototype.TermClass=null;Downsha.DSTPRequest.prototype.TermType=null;Downsha.DSTPRequest.prototype.YzVer=
null;Downsha.DSTPRequest.prototype.initialize=function(a){this.Cmdid=a;this.Seqid=Math.floor(65536*Math.random());this.Protover=Downsha.DownshaRemote.PROTO_VERSION;this.UID=Downsha.context.userId;this.SessID=Downsha.context.sessId;this.HID=Downsha.context.hardId;this.TID=Downsha.context.termId;this.TermClass=Downsha.context.termClass;this.TermType=Downsha.context.termType;this.YzVer=Downsha.context.version};Downsha.DSTPRequest.prototype.toJSON=function(){return{Cmdid:this.Cmdid,Seqid:this.Seqid,Protover:this.Protover,
UID:this.UID,SessID:this.SessID,HID:this.HID,TID:this.TID,TermClass:this.TermClass,TermType:this.TermType,YzVer:this.YzVer}}})();
(function(){var a=null;Downsha.DSTPResponse=function(b){a=Downsha.Logger.getInstance();this.__defineGetter__("data",this.getData);this.__defineSetter__("data",this.setData);this.__defineGetter__("error",this.getError);this.__defineSetter__("error",this.setError);this.initialize(b)};Downsha.DSTPResponse.fromObject=function(a){return a instanceof Downsha.DSTPResponse?a:new Downsha.DSTPResponse(a)};Downsha.DSTPResponse.prototype.Cmdid=null;Downsha.DSTPResponse.prototype.Seqid=null;Downsha.DSTPResponse.prototype.Protover=
null;Downsha.DSTPResponse.prototype.SessID=null;Downsha.DSTPResponse.prototype.NatIP=null;Downsha.DSTPResponse.prototype.SyncNo=null;Downsha.DSTPResponse.prototype.Status=null;Downsha.DSTPResponse.prototype._data=null;Downsha.DSTPResponse.prototype._error=null;Downsha.DSTPResponse.prototype.initialize=function(a){if("object"==typeof a&&("undefined"!=typeof a.Cmdid&&(this.Cmdid=a.Cmdid),"undefined"!=typeof a.Seqid&&(this.Seqid=a.Seqid),"undefined"!=typeof a.Protover&&(this.Protover=a.Protover),"undefined"!=
typeof a.SessID&&(this.SessID=a.SessID),"undefined"!=typeof a.NatIP&&(this.NatIP=a.NatIP),"undefined"!=typeof a.SyncNo&&(this.SyncNo=a.SyncNo),"undefined"!=typeof a.Status&&(this.Status=a.Status),this.data=a,null!=this.Status&&0>this.Status))this.error=new Downsha.DownshaError(this.Status)};Downsha.DSTPResponse.prototype.isError=function(){return null==this.Status||0>this.Status};Downsha.DSTPResponse.prototype.isSuccess=function(){return null!=this.Status&&0<=this.Status};Downsha.DSTPResponse.prototype.isErrorCode=
function(a){return null!=this.Status&&this.Status==a};Downsha.DSTPResponse.prototype.isInvalidUserAccountError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.INVALID_USER_ACCOUNT)};Downsha.DSTPResponse.prototype.isUserAccountExistError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.USER_ACCOUNT_EXIST)};Downsha.DSTPResponse.prototype.isUserAccountNotExistError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.USER_ACCOUNT_NOT_EXIST)};Downsha.DSTPResponse.prototype.isUserAccountOpenFailedError=
function(){return this.isErrorCode(Downsha.DownshaRemote.Error.USER_ACCOUNT_OPEN_FAILED)};Downsha.DSTPResponse.prototype.isUserPasswordIncorrectError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.USER_PASSWORD_INCORRECT)};Downsha.DSTPResponse.prototype.isTermInfoOpenFailedError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.TERM_INFO_OPEN_FAILED)};Downsha.DSTPResponse.prototype.isTermInfoCreateFailedError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.TERM_INFO_CREATE_FAILED)};
Downsha.DSTPResponse.prototype.isSessionNotExistError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.SESSION_NOT_EXIST)};Downsha.DSTPResponse.prototype.isSessionCreateFailedError=function(){return this.isErrorCode(Downsha.DownshaRemote.Error.SESSION_CREATE_FAILED)};Downsha.DSTPResponse.prototype.hasAuthenticationError=function(){return this.isInvalidUserAccountError()||this.isUserAccountExistError()||this.isUserAccountNotExistError()||this.isUserAccountOpenFailedError()||this.isUserPasswordIncorrectError()||
this.isTermInfoOpenFailedError()||this.isTermInfoCreateFailedError()||this.isSessionNotExistError()||this.isSessionCreateFailedError()};Downsha.DSTPResponse.prototype.getData=function(){return this._data};Downsha.DSTPResponse.prototype.setData=function(a){this._data=a};Downsha.DSTPResponse.prototype.getError=function(){return this._error};Downsha.DSTPResponse.prototype.setError=function(a){this._error=a};Downsha.DSTPResponse.createFrom=function(b){a=a||Downsha.Logger.getInstance(Downsha.DSTPResponse);
a.debug("Downsha.DSTPResponse.createFrom");return new Downsha.DSTPResponse(b)}})();
(function(){var a=null;Downsha.ClipSender=function(){a=Downsha.Logger.getInstance();this.__defineGetter__("dsInfo",this.getDsInfo);this.__defineSetter__("dsInfo",this.setDsInfo);this.__definePositiveInteger__("state",0);this.initialize()};Downsha.mixin(Downsha.ClipSender,Downsha.DefiningMixin);Downsha.ClipSender.STATE={INIT:0,SENDING_INFO_ITEM:1,SENDING_FILE_DESC:2,SENDING_FILE:3,SUCCESS:4,ERROR:5};Downsha.ClipSender.prototype._dsInfo=null;Downsha.ClipSender.prototype.onSendSuccess=null;Downsha.ClipSender.prototype.onSendError=
null;Downsha.ClipSender.prototype.initialize=function(){this.state=Downsha.ClipSender.STATE.INIT};Downsha.ClipSender.prototype.startUp=function(b,c,d){this.dsInfo=b;this.dsInfo instanceof Downsha.DownshaInfo?(this.onSendSuccess=function(){a.debug("ClipSender successfully sent");"function"==typeof c&&c.apply(this,arguments)},this.onSendError=function(){a.error("ClipSender failed to send");"function"==typeof d&&d.apply(this,arguments)},this.putInfoItem()):a.error("Tried to send invalid object")};Downsha.ClipSender.prototype.getDsInfo=
function(){return this._dsInfo};Downsha.ClipSender.prototype.setDsInfo=function(a){this._dsInfo=null!=a?a instanceof Downsha.DownshaInfo?a:"object"==typeof a?new Downsha.DownshaInfo(a):new Downsha.DownshaInfo:new Downsha.DownshaInfo};Downsha.ClipSender.prototype.putInfoItem=function(){a.debug("ClipSender.putInfoItem");var b=this;Downsha.context.remote.putInfoItem(this.dsInfo.getInfoItem(),function(c,d,e){a.debug("ClipSender successfully putted info item");4==e.readyState&&0!=e.status&&"success"==
d&&c.isSuccess()?(a.debug("Executing success callback"),b.handlePutInfoItemSuccess(c,d,e)):(a.debug("Executing error callback"),b.handlePutInfoItemError(e,d,null))},function(c,d,e){4==c.readyState?a.error("ClipSender encountered an error while putting info item  [readyState: "+c.readyState+"; status: "+c.status+"]"):a.error("ClipSender encountered an error while putting info item  [readyState: "+c.readyState+"]");b.handlePutInfoItemError(c,d,e)},!0)};Downsha.ClipSender.prototype.handlePutInfoItemSuccess=
function(b){a.debug("ClipSender.handlePutInfoItemSuccess");this.dsInfo.cid=b.data.CID;a.debug("cid: "+this.dsInfo.cid);var c=this;setTimeout(function(){c.putFileDesc()},0)};Downsha.ClipSender.prototype.handlePutInfoItemError=function(){a.debug("ClipSender.handlePutInfoItemError");var b=this;setTimeout(function(){b.onSendError()},0)};Downsha.ClipSender.prototype.putFileDesc=function(){a.debug("ClipSender.putFileDesc");var b=this;Downsha.context.remote.putFileDesc(this.dsInfo.getFileDesc(),function(c,
d,e){a.debug("ClipSender successfully putted file desc");4==e.readyState&&0!=e.status&&"success"==d&&c.isSuccess()?(a.debug("Executing success callback"),b.handlePutFileDescSuccess(c,d,e)):(a.debug("Executing error callback"),b.handlePutFileDescError(e,d,null))},function(c,d,e){4==c.readyState?a.error("ClipSender encountered an error while putting file desc  [readyState: "+c.readyState+"; status: "+c.status+"]"):a.error("ClipSender encountered an error while putting file desc  [readyState: "+c.readyState+
"]");b.handlePutFileDescError(c,d,e)},!0)};Downsha.ClipSender.prototype.handlePutFileDescSuccess=function(b){a.debug("ClipSender.handlePutFileDescSuccess");var c=b.data.FileNum,b=b.data.FileList;a.debug("file num: "+c);if(1<c)for(var d=0;d<c;d++){var e=b[d].FID;"string"==typeof e&&""!=e&&(e=this.dsInfo.findFileByFID(e),null!=e&&(e.cid=b[d].CID,e.cindex=b[d].CIndex,e.putState=b[d].PutState,a.debug("file: "+e.fid+" cid: "+e.cid+" cindex: "+e.cindex+" put_state: "+e.putState)))}else 1==c&&(e=b.FID,"string"==
typeof e&&""!=e&&(e=this.dsInfo.findFileByFID(e),null!=e&&(e.cid=b.CID,e.cindex=b.CIndex,e.putState=b.PutState,a.debug("file: "+e.fid+" cid: "+e.cid+" cindex: "+e.cindex+" put_state: "+e.putState))));var f=this;setTimeout(function(){f.onSendSuccess();f.putFile()},0)};Downsha.ClipSender.prototype.handlePutFileDescError=function(){a.debug("ClipSender.handlePutFileDescError");var b=this;setTimeout(function(){b.onSendError()},0)};Downsha.ClipSender.prototype.putFile=function(){a.debug("ClipSender.putFile");
var b=this.dsInfo.getNextUnputFile();if(null==b)return this.genThumbnail();var c=this;Downsha.context.remote.putFile(b.getFileData(),function(b,e,f){a.debug("ClipSender successfully putted file");4==f.readyState&&0!=f.status&&"success"==e&&b.isSuccess()?(a.debug("Executing success callback"),c.handlePutFileSuccess(b,e,f)):(a.debug("Executing error callback"),c.handlePutFileError(f,e,null))},function(b,e,f){4==b.readyState?a.error("ClipSender encountered an error while putting file  [readyState: "+
b.readyState+"; status: "+b.status+"]"):a.error("ClipSender encountered an error while putting file  [readyState: "+b.readyState+"]");c.handlePutFileError(b,e,f)},!0)};Downsha.ClipSender.prototype.handlePutFileSuccess=function(b){a.debug("ClipSender.handlePutFileSuccess");b=b.data.FID;if("string"!=typeof b||""==b)return a.debug("put file error. response fid invalid"),this.onSendError();var c=this.dsInfo.findFileByFID(b);if(null==c)return a.debug("put file error. response fid invalid. fid: "+b),this.onSendError();
c.putState=Downsha.DownshaFile.PUT_STATE.EXIST;a.debug("put file ok. fid: "+c.fid);var d=this;setTimeout(function(){d.putFile()},0)};Downsha.ClipSender.prototype.handlePutFileError=function(){a.debug("ClipSender.handlePutFileError");var b=this;setTimeout(function(){b.onSendError()},0)};Downsha.ClipSender.prototype.genThumbnail=function(){a.debug("ClipSender.genThumbnail");var b=this.dsInfo.getThumbnailFile();if(null==b)a.debug("Stop generating thumbnail, no proper source image");else{var c=this;Downsha.context.remote.genThumbnail(b.getFileAbstract(),
function(b,e,f){a.debug("ClipSender successfully generated thumbnail");4==f.readyState&&0!=f.status&&"success"==e&&b.isSuccess()?(a.debug("Executing success callback"),c.handleGenThumbnailSuccess(b,e,f)):(a.debug("Executing error callback"),c.handleGenThumbnailError(f,e,null))},function(b,e,f){4==b.readyState?a.error("ClipSender encountered an error while generating thumbnail  [readyState: "+b.readyState+"; status: "+b.status+"]"):a.error("ClipSender encountered an error while generating thumbnail  [readyState: "+
b.readyState+"]");c.handleGenThumbnailError(b,e,f)},!0)}};Downsha.ClipSender.prototype.handleGenThumbnailSuccess=function(){a.debug("ClipSender.handleGenThumbnailSuccess")};Downsha.ClipSender.prototype.handleGenThumbnailError=function(){a.debug("ClipSender.handleGenThumbnailError");var b=this;setTimeout(function(){b.onSendError()},0)}})();
(function(){var a=null;Downsha.ClipConverter=function(){a=Downsha.Logger.getInstance();this.__defineGetter__("dsInfo",this.getDsInfo);this.__defineSetter__("dsInfo",this.setDsInfo);this.__defineGetter__("cacheManager",this.getCacheManager);this.__definePositiveInteger__("state",0);this.initialize()};Downsha.mixin(Downsha.ClipConverter,Downsha.DefiningMixin);Downsha.ClipConverter.CACHE_CHECK_INTERVAL=300;Downsha.ClipConverter.CACHE_CHECK_TIMEOUT=3E3;Downsha.ClipConverter.STATE={INIT:0,EXTRACTING_CACHE:1,
CONVERTING_HTML:2,SUCCESS:3,ERROR:4};Downsha.ClipConverter.prototype._dsInfo=null;Downsha.ClipConverter.prototype._cacheManager=null;Downsha.ClipConverter.prototype.onConvertSuccess=null;Downsha.ClipConverter.prototype.onConvertError=null;Downsha.ClipConverter.prototype.initialize=function(){this.state=Downsha.ClipConverter.STATE.INIT;this.urlPattern="(https?://[-a-z0-9]+(?:\\.[-a-z0-9]+)*\\.[-a-z0-9]+(?::[0-9]+)?(?:/[-a-z0-9_:\\@&?=+,.!/~*%\\$]*)?)";this.foreImagePattern="<\\s*img((?:\"[^\"]*\"|'[^']*'|[^'\">])*)\\s+src\\s*=\\s*['\"]?\\s*"+
this.urlPattern+"\\s*['\"]?";this.backImagePattern="background(?:-image)?\\s*:\\s*url\\s*\\(\\s*(?:\\\\)?['\"]?\\s*"+this.urlPattern+"\\s*(?:\\\\)?['\"]?\\s*\\)"};Downsha.ClipConverter.prototype.startUp=function(b,c,d){this.dsInfo=b;this.onConvertSuccess=function(){a.debug("ClipConverter successfully converted");"function"==typeof c&&c.apply(this,arguments)};this.onConvertError=function(){a.error("ClipConverter failed to convert");"function"==typeof d&&d.apply(this,arguments)};this.extractCache()};
Downsha.ClipConverter.prototype.getDsInfo=function(){return this._dsInfo};Downsha.ClipConverter.prototype.setDsInfo=function(a){this._dsInfo=null!=a?a instanceof Downsha.DownshaInfo?a:"object"==typeof a?new Downsha.DownshaInfo(a):new Downsha.DownshaInfo:new Downsha.DownshaInfo};Downsha.ClipConverter.prototype.getCacheManager=function(){this._cacheManager||(this._cacheManager=new Downsha.CacheManager);return this._cacheManager};Downsha.ClipConverter.prototype.getMimeFromData=function(a,c){var d=[];
d.length=24;if(!a||24>c)return null;if(255==a[0]&&216==a[1]){for(var e=0;24>e;e++)d[e]=a[e];if(255==d[2]&&224==d[3]&&74==d[6]&&70==d[7]&&73==d[8]&&70==d[9]||255==d[2]&&225==d[3]&&69==d[6]&&120==d[7]&&105==d[8]&&102==d[9])for(var f=2;255==d[2]&&!(192==d[3]||193==d[3]||194==d[3]||195==d[3]||201==d[3]||202==d[3]||203==d[3]);){f+=2+(d[4]<<8)+d[5];if(f+12>c)break;for(e=0;12>e;e++)d[2+e]=a[f+e]}return 255!=d[2]?null:"image/jpeg"}return 71==a[0]&&73==a[1]&&70==a[2]?"image/gif":137==a[0]&&80==a[1]&&78==a[2]&&
71==a[3]&&13==a[4]&&10==a[5]&&26==a[6]&&10==a[7]&&73==a[12]&&72==a[13]&&68==a[14]&&82==a[15]?"image/png":null};Downsha.ClipConverter.prototype.getDimensionFromData=function(a,c){var d=[];d.length=24;if(!a||24>c)return null;if(255==a[0]&&216==a[1]){for(var e=0;24>e;e++)d[e]=a[e];if(255==d[2]&&224==d[3]&&74==d[6]&&70==d[7]&&73==d[8]&&70==d[9]||255==d[2]&&225==d[3]&&69==d[6]&&120==d[7]&&105==d[8]&&102==d[9])for(var f=2;255==d[2]&&!(192==d[3]||193==d[3]||194==d[3]||195==d[3]||201==d[3]||202==d[3]||203==
d[3]);){f+=2+(d[4]<<8)+d[5];if(f+12>c)break;for(e=0;12>e;e++)d[2+e]=a[f+e]}return 255!=d[2]?null:{width:(d[9]<<8)+d[10],height:(d[7]<<8)+d[8]}}return 71==a[0]&&73==a[1]&&70==a[2]?{width:a[6]+(a[7]<<8),height:a[8]+(a[9]<<8)}:137==a[0]&&80==a[1]&&78==a[2]&&71==a[3]&&13==a[4]&&10==a[5]&&26==a[6]&&10==a[7]&&73==a[12]&&72==a[13]&&68==a[14]&&82==a[15]?{width:(a[16]<<24)+(a[17]<<16)+(a[18]<<8)+(a[19]<<0),height:(a[20]<<24)+(a[21]<<16)+(a[22]<<8)+(a[23]<<0)}:null};Downsha.ClipConverter.prototype.extractCache=
function(){for(var b=this,c=[],d=0,e=0,f=0,f=function(b,e){var f=!1,g;for(g in c)if(c[g].url==b){f=!0;break}f?d++:(a.debug("add cache url: "+b),c.push({url:b,background:e}))},e=(new Date).getTime(),g=null,h=RegExp(this.foreImagePattern,"ig");null!=(g=h.exec(this.dsInfo.content));)f(g[2],0);g=null;for(h=RegExp(this.backImagePattern,"ig");null!=(g=h.exec(this.dsInfo.content));)f(g[1],1);f=(new Date).getTime();a.debug("RegExp search in "+(f-e)+" milliseconds, unique url: "+c.length+", repeated count: "+
d);if(0<c.length){b.cacheManager.startCache();b.cacheManager.addCaches(c);var i=(new Date).getTime(),j=setInterval(function(){if(b.cacheManager.isComplete()||i+b.constructor.CACHE_CHECK_TIMEOUT<(new Date).getTime()){clearInterval(j);j=null;var c=b.cacheManager.getCaches(),d;for(d in c)if(null==c[d].data||0==c[d].data.length)a.debug("cache "+d+" data invalid");else{var e=0,f=c[d].type;f&&(e=Downsha.DownshaMime.getMimeId(f));if(0==e&&((f=b.getMimeFromData(c[d].data,c[d].data.length))&&(e=Downsha.DownshaMime.getMimeId(f)),
0==e)){a.debug("cache "+d+" mime invalid");continue}var g=c[d].data.length,h=faultylabs.MD5(c[d].data);c[d].data.length=g;"string"!=typeof h||""==h?a.debug("cache "+d+" md5 error"):b.dsInfo.findFileByFID(h)?a.debug("cache "+d+" file already exist"):(g=parseInt(Date.now()/1E3),e=new Downsha.DownshaFile({fid:h,data:c[d].data,dataSize:c[d].data.length,mime:f,mid:e,background:c[d].background,url:c[d].url,createDate:g,updateDate:g}),0<e.mid&&(f=b.getDimensionFromData(e.data,e.dataSize),null!=f&&(e.width=
f.width,e.height=f.height)),a.debug("add file md5: "+e.fid+", size: "+e.dataSize+", mime: "+e.mime+", width: "+e.width+", height: "+e.height+", url: "+e.url),b.dsInfo.addFile(e))}return b.convertHtmlToDsml()}},b.constructor.CACHE_CHECK_INTERVAL)}else return b.convertHtmlToDsml()};Downsha.ClipConverter.prototype.convertUnicodeStringToUtf8Bytes=function(a){for(var c=[],d=0,e=0;e<a.length;++e)d=a.charCodeAt(e),128>d?c.push(d):2048>d?(c.push(d>>>6|192),c.push(d&63|128)):65536>d?(c.push(d>>>12|224),c.push(d>>
6&63|128),c.push(d&63|128)):2097152>d&&(c.push(d>>>18|240),c.push(d>>12&63|128),c.push(d>>6&63|128),c.push(d&63|128));return c};Downsha.ClipConverter.prototype.convertHtmlToDsml=function(){var b=this;if(""==this.dsInfo.content||0==this.dsInfo.content.length)a.debug("content empty");else{var c=this.dsInfo.content.replace(RegExp("<(?:\"[^\"]*\"|'[^']*'|[^'\">])*>","ig")," "),c=c.replace(RegExp("&#(\\d{1,5});","ig"),function(a,b){return String.fromCharCode(parseInt(b))}),c=c.replace(RegExp("\\s+","ig"),
" ");this.dsInfo.wordCount=c.length;this.dsInfo.absText=c.substr(0,512);c=(new Date).getTime();this.dsInfo.content=this.dsInfo.content.replace(RegExp(this.foreImagePattern,"ig"),function(a,c,d){return"string"==typeof d&&""!=d&&(d=b.dsInfo.findFileByURL(d),null!=d)?"<ds-file"+c+' hash="'+d.fid+'" type="'+d.mime+'"':a});this.dsInfo.content=this.dsInfo.content.replace(RegExp(this.backImagePattern,"ig"),function(a,c){if("string"==typeof c&&""!=c){var d=b.dsInfo.findFileByURL(c);if(null!=d)return"background-image:url("+
d.fid+")"}return a});var d=(new Date).getTime();a.debug("RegExp replace in "+(d-c)+" milliseconds");this.dsInfo.content='<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE ds-info SYSTEM "http://xml.yunzhai.cn/dsml.dtd"><ds-info>'+this.dsInfo.content+"</ds-info>";var c=this.convertUnicodeStringToUtf8Bytes(this.dsInfo.content),d=c.length,e=faultylabs.MD5(c);c.length=d;if("string"!=typeof e||""==e)a.debug("content md5 error");else{var f=parseInt(Date.now()/1E3);this.dsInfo.mainFID=e;this.dsInfo.mainMID=
Downsha.DownshaMime.getMimeId("application/dsml");this.dsInfo.mainSize=d;this.dsInfo.srcType=Downsha.DownshaInfo.SRC_TYPE.WEB_CLIP;this.dsInfo.srcDesc=navigator.userAgent;this.dsInfo.shareType=1;this.dsInfo.shareDate=f;this.dsInfo.createDate=f;this.dsInfo.updateDate=f;c=new Downsha.DownshaFile({cindex:1,fid:e,data:c,dataSize:d,mid:this.dsInfo.mainMID,mime:"application/dsml",wordCount:this.dsInfo.wordCount,createDate:this.dsInfo.createDate,updateDate:this.dsInfo.updateDate});a.debug("main file md5: "+
c.fid+", size: "+c.dataSize+", word count: "+c.wordCount);this.dsInfo.addFile(c);if("function"==typeof this.onConvertSuccess)this.onConvertSuccess()}}}})();Downsha.DownshaModel=function(a){this.initialize(a)};Downsha.mixin(Downsha.DownshaModel,Downsha.DefiningMixin);
Downsha.DownshaModel.prototype.initialize=function(a){if(null!=a&&"object"==typeof a)for(var b in a){var c="set"+b.substring(0,1).toUpperCase()+b.substring(1);if("function"==typeof this[c])this[c].apply(this,[a[b]]);else if("undefined"!=typeof this[b])try{this[b]=a[b]}catch(d){}}};Downsha.DownshaModel.prototype.toStorable=function(a){for(var b={},c=this.getStorableProps(),a="string"==typeof a?a:"",d=0;d<c.length;d++)"undefined"!=typeof this[c[d]]&&null!=this[c[d]]&&(b[a+c[d]]=this[c[d]]);return b};
Downsha.DownshaModel.prototype.getStorableProps=function(){var a=[],b;for(b in this)null!=this[b]&&0!=b.indexOf("_")&&"modelName"!=b&&("string"==typeof this[b]||"number"==typeof this[b]||"boolean"==typeof this[b])&&a.push(b);return a};Downsha.DownshaModel.prototype.toJSON=function(){return this.toStorable()};Downsha.DownshaMime={getMimeId:function(a){return"string"==typeof a&&""!=a&&"undefined"!=typeof Downsha.DownshaMime.TABLE[a]?Downsha.DownshaMime.TABLE[a]:0}};
Downsha.DownshaMime.TABLE={"application/dsml":5002,"image/gif":2E3,"image/jpeg":2010,"image/pjpeg":2015,"image/jpg":2016,"image/png":2020,"image/x-png":2022,"image/bmp":2030,"image/x-bmp":2031,"image/icon":2070,"image/x-icon":2071,"image/tiff":2090,"application/x-shockwave-flash":4440};
Downsha.DownshaTerm=function(){this.__defineSetter__("osName",this.setOSName);this.__defineGetter__("osName",this.getOSName);this.__defineSetter__("osVersion",this.setOSVersion);this.__defineGetter__("osVersion",this.getOSVersion);this.__defineSetter__("browserName",this.setBrowserName);this.__defineGetter__("browserName",this.getBrowserName);this.__defineSetter__("browserVersion",this.setBrowserVersion);this.__defineGetter__("browserVersion",this.getBrowserVersion);this.__defineSetter__("browserUserAgent",
this.setBrowserUserAgent);this.__defineGetter__("browserUserAgent",this.getBrowserUserAgent)};Downsha.inherit(Downsha.DownshaTerm,Downsha.DownshaModel);Downsha.DownshaTerm.TERM_CLASS={UNKNOWN:0,PC:1,PLUGIN:2,WEB:3,MOBILE:4,PAD:5,TV:6};Downsha.DownshaTerm.TERM_TYPE={IE:2E4,FIREFOX:21E3,CHROME:22E3,SAFARI:23E3,OPERA:24E3,SE360:25E3,SOGOU:25100,EE360:25200,AOYOU:25300,QQ:25400,LIEBAO:25500};Downsha.DownshaTerm.prototype._osName=null;Downsha.DownshaTerm.prototype._osVersion=null;
Downsha.DownshaTerm.prototype._browserName=null;Downsha.DownshaTerm.prototype._browserVersion=null;Downsha.DownshaTerm.prototype._browserUserAgent=null;Downsha.DownshaTerm.prototype.getOSName=function(){return this._osName};Downsha.DownshaTerm.prototype.setOSName=function(a){this._osName=a};Downsha.DownshaTerm.prototype.getOSVersion=function(){return this._osVersion};Downsha.DownshaTerm.prototype.setOSVersion=function(a){this._osVersion=a};Downsha.DownshaTerm.prototype.getBrowserName=function(){return this._browserName};
Downsha.DownshaTerm.prototype.setBrowserName=function(a){this._browserName=a};Downsha.DownshaTerm.prototype.getBrowserVersion=function(){return this._browserVersion};Downsha.DownshaTerm.prototype.setBrowserVersion=function(a){this._browserVersion=a};Downsha.DownshaTerm.prototype.getBrowserUserAgent=function(){return this._browserUserAgent};Downsha.DownshaTerm.prototype.setBrowserUserAgent=function(a){this._browserUserAgent=a};
Downsha.DownshaFile=function(a){this.__defineSetter__("putState",this.setPutState);this.__defineGetter__("putState",this.getPutState);this.__defineSetter__("data",this.setData);this.__defineGetter__("data",this.getData);this.__defineSetter__("cid",this.setCID);this.__defineGetter__("cid",this.getCID);this.__defineSetter__("cindex",this.setCIndex);this.__defineGetter__("cindex",this.getCIndex);this.__defineSetter__("syncNo",this.setSyncNo);this.__defineGetter__("syncNo",this.getSyncNo);this.__defineSetter__("fid",
this.setFID);this.__defineGetter__("fid",this.getFID);this.__defineSetter__("mid",this.setMID);this.__defineGetter__("mid",this.getMID);this.__defineSetter__("mime",this.setMime);this.__defineGetter__("mime",this.getMime);this.__defineSetter__("dataSize",this.setDataSize);this.__defineGetter__("dataSize",this.getDataSize);this.__defineSetter__("wordCount",this.setWordCount);this.__defineGetter__("wordCount",this.getWordCount);this.__defineSetter__("fileTitle",this.setFileTitle);this.__defineGetter__("fileTitle",
this.getFileTitle);this.__defineSetter__("fileName",this.setFileName);this.__defineGetter__("fileName",this.getFileName);this.__defineSetter__("url",this.setUrl);this.__defineGetter__("url",this.getUrl);this.__defineSetter__("creator",this.setCreator);this.__defineGetter__("creator",this.getCreator);this.__defineSetter__("attachFlag",this.setAttachFlag);this.__defineGetter__("attachFlag",this.getAttachFlag);this.__defineSetter__("width",this.setWidth);this.__defineGetter__("width",this.getWidth);
this.__defineSetter__("height",this.setHeight);this.__defineGetter__("height",this.getHeight);this.__defineSetter__("background",this.setBackground);this.__defineGetter__("background",this.getBackground);this.__defineSetter__("createDate",this.setCreateDate);this.__defineGetter__("createDate",this.getCreateDate);this.__defineSetter__("updateDate",this.setUpdateDate);this.__defineGetter__("updateDate",this.getUpdateDate);this.initialize(a)};Downsha.inherit(Downsha.DownshaFile,Downsha.DownshaModel);
Downsha.DownshaFile.PUT_STATE={NOT_EXIST:0,EXIST:1,PARTIAL:2,FAILED:129};Downsha.DownshaFile.prototype._putState=Downsha.DownshaFile.PUT_STATE.NOT_EXIST;Downsha.DownshaFile.prototype._data=null;Downsha.DownshaFile.prototype._cid=0;Downsha.DownshaFile.prototype._cindex=0;Downsha.DownshaFile.prototype._syncNo=0;Downsha.DownshaFile.prototype._fid="";Downsha.DownshaFile.prototype._mid=0;Downsha.DownshaFile.prototype._mime="";Downsha.DownshaFile.prototype._dataSize=0;
Downsha.DownshaFile.prototype._fileTitle="";Downsha.DownshaFile.prototype._fileName="";Downsha.DownshaFile.prototype._url="";Downsha.DownshaFile.prototype._creator="";Downsha.DownshaFile.prototype._attachFlag=0;Downsha.DownshaFile.prototype._wordCount=0;Downsha.DownshaFile.prototype._width=0;Downsha.DownshaFile.prototype._height=0;Downsha.DownshaFile.prototype._background=0;Downsha.DownshaFile.prototype._createDate=0;Downsha.DownshaFile.prototype._updateDate=0;
Downsha.DownshaFile.prototype.getPutState=function(){return this._putState};Downsha.DownshaFile.prototype.setPutState=function(a){this._putState=a};Downsha.DownshaFile.prototype.getData=function(){return this._data};Downsha.DownshaFile.prototype.setData=function(a){this._data=a};Downsha.DownshaFile.prototype.getCID=function(){return this._cid};Downsha.DownshaFile.prototype.setCID=function(a){this._cid=a};Downsha.DownshaFile.prototype.getCIndex=function(){return this._cindex};
Downsha.DownshaFile.prototype.setCIndex=function(a){this._cindex=a};Downsha.DownshaFile.prototype.getSyncNo=function(){return this._syncNo};Downsha.DownshaFile.prototype.setSyncNo=function(a){this._syncNo=a};Downsha.DownshaFile.prototype.getFID=function(){return this._fid};Downsha.DownshaFile.prototype.setFID=function(a){this._fid=a};Downsha.DownshaFile.prototype.getMID=function(){return this._mid};Downsha.DownshaFile.prototype.setMID=function(a){this._mid=a};
Downsha.DownshaFile.prototype.getMime=function(){return this._mime};Downsha.DownshaFile.prototype.setMime=function(a){this._mime=a};Downsha.DownshaFile.prototype.getDataSize=function(){return this._dataSize};Downsha.DownshaFile.prototype.setDataSize=function(a){this._dataSize=a};Downsha.DownshaFile.prototype.getFileTitle=function(){return this._fileTitle};Downsha.DownshaFile.prototype.setFileTitle=function(a){this._fileTitle=a};Downsha.DownshaFile.prototype.getFileName=function(){return this._fileName};
Downsha.DownshaFile.prototype.setFileName=function(a){this._fileName=a};Downsha.DownshaFile.prototype.getUrl=function(){return this._url};Downsha.DownshaFile.prototype.setUrl=function(a){this._url=a};Downsha.DownshaFile.prototype.getCreator=function(){return this._creator};Downsha.DownshaFile.prototype.setCreator=function(a){this._creator=a};Downsha.DownshaFile.prototype.getAttachFlag=function(){return this._attachFlag};Downsha.DownshaFile.prototype.setAttachFlag=function(a){this._attachFlag=a};
Downsha.DownshaFile.prototype.getWordCount=function(){return this._wordCount};Downsha.DownshaFile.prototype.setWordCount=function(a){a=parseInt(a);isNaN(a)||(this._wordCount=a)};Downsha.DownshaFile.prototype.getWidth=function(){return this._width};Downsha.DownshaFile.prototype.setWidth=function(a){a=parseInt(a);isNaN(a)||(this._width=a)};Downsha.DownshaFile.prototype.getHeight=function(){return this._height};
Downsha.DownshaFile.prototype.setHeight=function(a){a=parseInt(a);isNaN(a)||(this._height=a)};Downsha.DownshaFile.prototype.getBackground=function(){return this._background};Downsha.DownshaFile.prototype.setBackground=function(a){a=parseInt(a);isNaN(a)||(this._background=a)};Downsha.DownshaFile.prototype.getCreateDate=function(){return this._createDate};Downsha.DownshaFile.prototype.setCreateDate=function(a){this._createDate=a};Downsha.DownshaFile.prototype.getUpdateDate=function(){return this._updateDate};
Downsha.DownshaFile.prototype.setUpdateDate=function(a){this._updateDate=a};Downsha.DownshaFile.prototype.getFileAbstract=function(){return{CID:this.cid,CIndex:this.cindex,FID:this.fid,MimeID:this.mid,Mime:this.mime}};
Downsha.DownshaFile.prototype.getFileDesc=function(){return{CID:this.cid,CIndex:this.cindex,FileSyncNo:this.syncNo,FID:this.fid,MimeID:this.mid,Mime:this.mime,FileSize:this.dataSize,WordCount:this.wordCount,FileTitle:this.fileTitle,FileName:this.fileName,SrcURL:this.url,Creator:this.creator,AttachFlag:this.attachFlag,CTime:this.createDate,MTime:this.updateDate,MediaAttr:1,Width:this.width,Height:this.height}};
Downsha.DownshaFile.prototype.getFileData=function(){return{CID:this.cid,CIndex:this.cindex,FID:this.fid,FileData:this.data}};
Downsha.DownshaInfo=function(a){this.__defineGetter__("cid",this.getCID);this.__defineSetter__("cid",this.setCID);this.__defineGetter__("dirId",this.getDirId);this.__defineSetter__("dirId",this.setDirId);this.__defineGetter__("title",this.getTitle);this.__defineSetter__("title",this.setTitle);this.__defineGetter__("content",this.getContent);this.__defineSetter__("content",this.setContent);this.__defineGetter__("author",this.getAuthor);this.__defineSetter__("author",this.setAuthor);this.__defineGetter__("absText",
this.getAbsText);this.__defineSetter__("absText",this.setAbsText);this.__defineGetter__("thumbnail",this.getThumbnail);this.__defineSetter__("thumbnail",this.setThumbnail);this.__defineGetter__("url",this.getUrl);this.__defineSetter__("url",this.setUrl);this.__defineGetter__("srcType",this.getSrcType);this.__defineSetter__("srcType",this.setSrcType);this.__defineGetter__("srcDesc",this.getSrcDesc);this.__defineSetter__("srcDesc",this.setSrcDesc);this.__defineGetter__("shareType",this.getShareType);
this.__defineSetter__("shareType",this.setShareType);this.__defineGetter__("shareDate",this.getShareDate);this.__defineSetter__("shareDate",this.setShareDate);this.__defineGetter__("fileCount",this.getFileCount);this.__defineGetter__("totalSize",this.getTotalSize);this.__defineGetter__("mainFID",this.getMainFID);this.__defineSetter__("mainFID",this.setMainFID);this.__defineGetter__("mainMID",this.getMainMID);this.__defineSetter__("mainMID",this.setMainMID);this.__defineGetter__("mainSize",this.getMainSize);
this.__defineSetter__("mainSize",this.setMainSize);this.__defineGetter__("wordCount",this.getWordCount);this.__defineSetter__("wordCount",this.setWordCount);this.__defineGetter__("createDate",this.getCreateDate);this.__defineSetter__("createDate",this.setCreateDate);this.__defineGetter__("updateDate",this.getUpdateDate);this.__defineSetter__("updateDate",this.setUpdateDate);this.__defineType__("files","Array");this.__defineGetter__("length",this.getLength);this.files=[];this.initialize(a)};
Downsha.inherit(Downsha.DownshaInfo,Downsha.DownshaModel);Downsha.DownshaInfo.SRC_TYPE={ORIGINAL:1E4,WEB_CLIP:10100,LOCAL_FILE:10200};Downsha.DownshaInfo.prototype._cid=0;Downsha.DownshaInfo.prototype._dirId=0;Downsha.DownshaInfo.prototype._title="";Downsha.DownshaInfo.prototype._content="";Downsha.DownshaInfo.prototype._author="";Downsha.DownshaInfo.prototype._absText="";Downsha.DownshaInfo.prototype._thumbnail="";Downsha.DownshaInfo.prototype._url="";Downsha.DownshaInfo.prototype._srcType=0;
Downsha.DownshaInfo.prototype._srcDesc="";Downsha.DownshaInfo.prototype._shareType=0;Downsha.DownshaInfo.prototype._shareDate=0;Downsha.DownshaInfo.prototype._fileCount=0;Downsha.DownshaInfo.prototype._totalSize=0;Downsha.DownshaInfo.prototype._mainFID="";Downsha.DownshaInfo.prototype._mainMID=0;Downsha.DownshaInfo.prototype._mainSize=0;Downsha.DownshaInfo.prototype._wordCount=0;Downsha.DownshaInfo.prototype._createDate=0;Downsha.DownshaInfo.prototype._updateDate=0;
Downsha.DownshaInfo.createUrlNote=function(a,b,c){c=Downsha.Utils.createUrlClipContent(a,b,c);return new Downsha.DownshaInfo({title:a,content:c,url:b})};Downsha.DownshaInfo.prototype.getCID=function(){return null!=this._cid?this._cid:0};Downsha.DownshaInfo.prototype.setCID=function(a){a=parseInt(a);if(!isNaN(a)){this._cid=a;for(var b in this.files)this.files[b].cid=a}};Downsha.DownshaInfo.prototype.getDirId=function(){return null!=this._dirId?this._dirId:0};
Downsha.DownshaInfo.prototype.setDirId=function(a){a=parseInt(a);isNaN(a)||(this._dirId=a)};Downsha.DownshaInfo.prototype.cleanTitle=function(a){return"string"==typeof a?a.replace(/[\n\r\t]+/,"").replace(/^\s+/,"").replace(/\s+$/,""):a};Downsha.DownshaInfo.prototype.getTitle=function(){return this._title};Downsha.DownshaInfo.prototype.setTitle=function(a,b){var c=this.cleanTitle(""+a);if((null==c||0==c.length)&&b)c=this.cleanTitle(""+b);this._title=c};Downsha.DownshaInfo.prototype.getContent=function(){return this._content};
Downsha.DownshaInfo.prototype.setContent=function(a){this._content=a};Downsha.DownshaInfo.prototype.getAuthor=function(){return this._author};Downsha.DownshaInfo.prototype.setAuthor=function(a){this._author=a};Downsha.DownshaInfo.prototype.getAbsText=function(){return this._absText};Downsha.DownshaInfo.prototype.setAbsText=function(a){this._absText=a};Downsha.DownshaInfo.prototype.getThumbnail=function(){return this._thumbnail};
Downsha.DownshaInfo.prototype.setThumbnail=function(a){this._thumbnail=a};Downsha.DownshaInfo.prototype.getUrl=function(){return this._url};Downsha.DownshaInfo.prototype.setUrl=function(a){this._url=a};Downsha.DownshaInfo.prototype.getSrcType=function(){return this._srcType};Downsha.DownshaInfo.prototype.setSrcType=function(a){a=parseInt(a);isNaN(a)||(this._srcType=a)};Downsha.DownshaInfo.prototype.getSrcDesc=function(){return this._srcDesc};
Downsha.DownshaInfo.prototype.setSrcDesc=function(a){this._srcDesc=a};Downsha.DownshaInfo.prototype.getShareType=function(){return this._shareType};Downsha.DownshaInfo.prototype.setShareType=function(a){a=parseInt(a);isNaN(a)||(this._shareType=a)};Downsha.DownshaInfo.prototype.getShareDate=function(){return this._shareDate};Downsha.DownshaInfo.prototype.setShareDate=function(a){a=parseInt(a);isNaN(a)||(this._shareDate=a)};Downsha.DownshaInfo.prototype.getFileCount=function(){return this.files.length};
Downsha.DownshaInfo.prototype.getTotalSize=function(){var a=0,b;for(b in this.files)a+=this.files[b].dataSize;return a};Downsha.DownshaInfo.prototype.getMainFID=function(){return this._mainFID};Downsha.DownshaInfo.prototype.setMainFID=function(a){this._mainFID=a};Downsha.DownshaInfo.prototype.getMainMID=function(){return null!=this._mainMID?this._mainMID:0};Downsha.DownshaInfo.prototype.setMainMID=function(a){a=parseInt(a);isNaN(a)||(this._mainMID=a)};
Downsha.DownshaInfo.prototype.getMainSize=function(){return null!=this._mainSize?this._mainSize:0};Downsha.DownshaInfo.prototype.setMainSize=function(a){a=parseInt(a);isNaN(a)||(this._mainSize=a)};Downsha.DownshaInfo.prototype.getWordCount=function(){return null!=this._wordCount?this._wordCount:0};Downsha.DownshaInfo.prototype.setWordCount=function(a){a=parseInt(a);isNaN(a)||(this._wordCount=a)};Downsha.DownshaInfo.prototype.getCreateDate=function(){return this._createDate};
Downsha.DownshaInfo.prototype.setCreateDate=function(a){a=parseInt(a);isNaN(a)||(this._createDate=a)};Downsha.DownshaInfo.prototype.getUpdateDate=function(){return this._updateDate};Downsha.DownshaInfo.prototype.setUpdateDate=function(a){a=parseInt(a);isNaN(a)||(this._updateDate=a)};Downsha.DownshaInfo.prototype.findFileByFID=function(a){return"string"==typeof a&&""!=a&&"undefined"!=typeof this.files[a]?this.files[a]:null};
Downsha.DownshaInfo.prototype.findFileByURL=function(a){for(var b in this.files)if(this.files[b]&&this.files[b].url==a)return this.files[b];return null};Downsha.DownshaInfo.prototype.addFile=function(a){null!=a&&(a instanceof Downsha.DownshaFile?(this.files[a.fid]=a,this.files.length++):"object"==typeof a&&"undefined"!=typeof a.fid&&(this.files[a.fid]=new Downsha.DownshaFile(a),this.files.length++))};
Downsha.DownshaInfo.prototype.getNextUnputFile=function(){var a=null,b=0,c;for(c in this.files)if(this.files[c]&&this.files[c].putState!=Downsha.DownshaFile.PUT_STATE.EXIST&&(0==b||this.files[c].cindex<b))a=this.files[c],b=this.files[c].cindex;return a};
Downsha.DownshaInfo.prototype.getThumbnailFile=function(){var a=null,b=null,c=0,d=c=c=0,e=c=0,f;for(f in this.files)if(b=this.files[f],c=parseInt(b.cindex),!(isNaN(c)||100>c))if(c=parseInt(b.background),isNaN(c)||0==c)currentMID=parseInt(b.mid),isNaN(currentMID)||2E3>currentMID||(c=parseInt(b.width),isNaN(c)||80>c||(d=parseInt(b.height),isNaN(d)||80>d||300<100*c/d||300<100*d/c||(c*=d,c>e&&(a=b,e=c))));return a};
Downsha.DownshaInfo.prototype.getLength=function(){for(var a=0,b=this.getStorableProps(),c=0;c<b.length;c++)this[b[c]]&&(a+=(""+this[b[c]]).length+b[c].length+1);return a+=b.length-1};Downsha.DownshaInfo.prototype.getStorableProps=function(){return"dirId,title,content,author,absText,thumbnail,url,srcType,srcDesc,shareType,shareDate,fileCount,totalSize,mainFID,mainMID,mainSize,wordCount,createDate,updateDate".split(",")};
Downsha.DownshaInfo.prototype.getInfoItem=function(){return{DirID:this.dirId,Title:this.title,Author:this.author,Abstract:this.absText,InfoIconFID:this.thumbnail,SrcURL:this.url,SrcType:this.srcType,SrcDesc:this.srcDesc,ShareType:this.shareType,ShareTime:this.shareDate,CTime:this.createDate,MTime:this.updateDate,FileListNum:this.fileCount,TotalSize:this.totalSize,MainFID:this.mainFID,MainMimeID:this.mainMID,MainFileSize:this.mainSize,WordCount:this.wordCount}};
Downsha.DownshaInfo.prototype.getFileDesc=function(){var a={FileNum:this.fileCount},b=0;a.FileList=[];for(var c in this.files)a.FileList[b++]=this.files[c].getFileDesc();return a};Downsha.DownshaInfo.prototype.toLOG=function(){return{title:this.title,url:this.url,length:this.length,createDate:this.createDate,updateDate:this.updateDate}};
Downsha.DownshaInfo.prototype.toString=function(){return"Downsha.DownshaInfo ["+this.url+"] "+this.title+"; content length: "+("string"==typeof this.content?this.content.length:0)+")"};
(function(){var a=null;Downsha.Options=function(b,c){a=Downsha.Logger.getInstance();this.__defineGetter__("context",this.getContext);this.__defineSetter__("context",this.setContext);this.__defineGetter__("developerMode",this.isDeveloperMode);this.__defineSetter__("developerMode",this.setDeveloperMode);this.__defineGetter__("debugLevel",this.getDebugLevel);this.__defineSetter__("debugLevel",this.setDebugLevel);this.__defineGetter__("clipStyle",this.getClipStyle);this.__defineSetter__("clipStyle",this.setClipStyle);
this.__defineGetter__("useContextMenu",this.isUseContextMenu);this.__defineSetter__("useContextMenu",this.setUseContextMenu);this.__defineGetter__("debugEnabled",this.isDebugEnabled);this.__defineSetter__("debugEnabled",this.setDebugEnabled);this.__defineGetter__("clipNotificationEnabled",this.isClipNotificationEnabled);this.__defineSetter__("clipNotificationEnabled",this.setClipNotificationEnabled);this.__defineGetter__("clipAction",this.getClipAction);this.__defineSetter__("clipAction",this.setClipAction);
this.initialize(b,c)};Downsha.Options.FULL_PAGE_OPTIONS={NEVER:0,ALWAYS:1,REMEMBER:2};Downsha.Options.CLIP_STYLE_OPTIONS={NONE:0,TEXT:1,FULL:2};Downsha.Options.CLIP_ACTION_OPTIONS={ARTICLE:0,FULL_PAGE:1,URL:2};Downsha.Options.__defineGetter__("DEFAULTS",function(){return{developerMode:!1,debugLevel:Downsha.Logger.LOG_LEVEL_ERROR,clipStyle:Downsha.Options.CLIP_STYLE_OPTIONS.FULL,useContextMenu:!0,debugEnabled:!0,clipNotificationEnabled:!0,clipAction:Downsha.Options.CLIP_ACTION_OPTIONS.ARTICLE}});Downsha.Options.isValidClipStyleOptionValue=
function(a){return Downsha.Options.isValidOptionValue(a,Downsha.Options.CLIP_STYLE_OPTIONS)};Downsha.Options.isValidClipActionOptionValue=function(a){return Downsha.Options.isValidOptionValue(a,Downsha.Options.CLIP_ACTION_OPTIONS)};Downsha.Options.isValidOptionValue=function(a,c){if("object"==typeof c&&null!=c)for(var d in c)if(a==c[d])return!0;return!1};Downsha.Options.prototype._context=null;Downsha.Options.prototype._developerMode=Downsha.Options.DEFAULTS.developerMode;Downsha.Options.prototype._debugLevel=
Downsha.Options.DEFAULTS.debugLevel;Downsha.Options.prototype._clipStyle=Downsha.Options.DEFAULTS.clipStyle;Downsha.Options.prototype._useContextMenu=Downsha.Options.DEFAULTS.useContextMenu;Downsha.Options.prototype._debugEnabled=Downsha.Options.DEFAULTS.debugEnabled;Downsha.Options.prototype._clipNotificationEnabled=Downsha.Options.DEFAULTS.clipNotificationEnabled;Downsha.Options.prototype._clipAction=Downsha.Options.DEFAULTS.clipAction;Downsha.Options.prototype.initialize=function(a,c){a instanceof
Downsha.DownshaContext&&(this.context=a);var d="object"==typeof c&&null!=c?c:Downsha.Options.DEFAULTS,e;for(e in d)"undefined"!=typeof this[e]&&(this[e]=d[e])};Downsha.Options.prototype.setContext=function(a){a instanceof Downsha.DownshaContext?this._context=a:null==a&&(this._context=null)};Downsha.Options.prototype.getContext=function(){return this._context};Downsha.Options.prototype.setDeveloperMode=function(a){this._developerMode=a?!0:!1};Downsha.Options.prototype.isDeveloperMode=function(){return this._developerMode};
Downsha.Options.prototype.setDebugLevel=function(a){"number"==typeof a?this._debugLevel=a:"string"==typeof a?this._debugLevel=parseInt(a):null==a&&(this._debugLevel=0)};Downsha.Options.prototype.getDebugLevel=function(){return this._debugLevel};Downsha.Options.prototype.setClipStyle=function(a){Downsha.Options.isValidClipStyleOptionValue(a)?this._clipStyle=a:null==a&&(this._clipStyle=Downsha.Options.DEFAULTS.clipStyle)};Downsha.Options.prototype.getClipStyle=function(){return this._clipStyle};Downsha.Options.prototype.isUseContextMenu=
function(){return this._useContextMenu};Downsha.Options.prototype.setUseContextMenu=function(a){this._useContextMenu=a?!0:!1};Downsha.Options.prototype.isDebugEnabled=function(){return this._debugEnabled};Downsha.Options.prototype.setDebugEnabled=function(a){this._debugEnabled=a?!0:!1};Downsha.Options.prototype.isClipNotificationEnabled=function(){return this._clipNotificationEnabled};Downsha.Options.prototype.setClipNotificationEnabled=function(a){this._clipNotificationEnabled=a?!0:!1};Downsha.Options.prototype.getClipAction=
function(){return this._clipAction};Downsha.Options.prototype.setClipAction=function(a){Downsha.Options.isValidClipActionOptionValue(a)?this._clipAction=a:null==a&&(this._clipAction=Downsha.Options.DEFAULTS.clipAction)};Downsha.Options.prototype.apply=function(){a.level=this.debugLevel;Downsha.Logger.setLevel(this.debugLevel);this.context&&this.context.setOptions(this)};Downsha.Options.prototype.reset=function(){this.initialize(this.context,null)};Downsha.Options.prototype.toJSON=function(){return{debugLevel:this.debugLevel,
developerMode:this.developerMode,clipStyle:this.clipStyle,useContextMenu:this.useContextMenu,debugEnabled:this.debugEnabled,clipNotificationEnabled:this.clipNotificationEnabled,clipAction:this.clipAction}}})();Downsha.Constants=Downsha.Constants||{};
Downsha.Constants.RequestType={UNKNOWN:0,LOGOUT:1001,LOGIN:1002,LOGIN_ERROR:1003,LOGIN_SUCCESS:1004,POPUP_STARTED:2001,POPUP_ENDED:2002,PAGE_CLIP_SUCCESS:3001,PAGE_CLIP_FAILURE:3002,PAGE_CLIP_CONTENT_SUCCESS:3003,PAGE_CLIP_CONTENT_FAILURE:3004,PAGE_CLIP_CONTENT_TOO_BIG:3005,CONTEXT_PAGE_CLIP_SUCCESS:3101,CONTEXT_PAGE_CLIP_FAILURE:3102,CONTEXT_PAGE_CLIP_CONTENT_SUCCESS:3103,CONTEXT_PAGE_CLIP_CONTENT_FAILURE:3104,CONTEXT_PAGE_CLIP_CONTENT_TOO_BIG:3105,CONTENT_SCRIPT_LOAD_TIMEOUT:4001,FETCH_STYLE_SHEET_RULES:4002,
CLIP_ACTION_FULL_PAGE:5001,CLIP_ACTION_ARTICLE:5002,CLIP_ACTION_SELECTION:5003,CLIP_ACTION_URL:5004,PREVIEW_CLIP_ACTION_CLEAR:6001,PREVIEW_CLIP_ACTION_FULL_PAGE:6002,PREVIEW_CLIP_ACTION_ARTICLE:6003,PREVIEW_CLIP_ACTION_SELECTION:6004,PREVIEW_CLIP_ACTION_URL:6005,PREVIEW_NUDGE:6101,PREVIEW_NUDGE_PREVIOUS_SIBLING:6102,PREVIEW_NUDGE_NEXT_SIBLING:6103,PREVIEW_NUDGE_PARENT:6104,PREVIEW_NUDGE_CHILD:6105,PAGE_INFO:7001,FETCH_ARTICLE_RULES:8001};
Downsha.Constants.Limits={DSTP_USER_NAME_LEN_MIN:6,DSTP_USER_NAME_LEN_MAX:16,DSTP_USER_NAME_REGEX:"^[A-Za-z0-9._\\-\\u4e00-\\u9fa5]{6,16}$",DSTP_USER_EMAIL_LEN_MIN:6,DSTP_USER_EMAIL_LEN_MAX:255,DSTP_USER_EMAIL_REGEX:"^\\w+((-\\w+)|(\\.\\w+))*\\@[A-Za-z0-9]+((\\.|-)[A-Za-z0-9]+)*\\.[A-Za-z0-9]+$",DSTP_USER_PWD_LEN_MIN:6,DSTP_USER_PWD_LEN_MAX:16,DSTP_USER_PWD_REGEX:"^[A-Za-z0-9.~!@#$%^&*()+=_-]{6,16}$",DSTP_NOTE_TITLE_LEN_MIN:0,DSTP_NOTE_TITLE_LEN_MAX:127,DSTP_NOTE_TITLE_REGEX:"^$|^[^\\s\\r\\n\\t]([^\\n\\r\\t]{0,253}[^\\s\\r\\n\\t])?$",
DSTP_TAG_NAME_LEN_MIN:1,DSTP_TAG_NAME_LEN_MAX:100,DSTP_TAG_NAME_REGEX:"^[^,\\s\\r\\n\\t]([^,\\n\\r\\t]{0,98}[^,\\s\\r\\n\\t])?$",DSTP_NOTE_TAGS_MIN:0,DSTP_NOTE_TAGS_MAX:100,SERVICE_DOMAIN_LEN_MIN:1,SERVICE_DOMAIN_LEN_MAX:256,CLIP_NOTE_CONTENT_LEN_MAX:5242880};Downsha.EventHandler=function(a){this.initialize(a)};Downsha.EventHandler.prototype._scope=null;Downsha.EventHandler.prototype._map=null;
Downsha.EventHandler.prototype.initialize=function(a){this.__defineGetter__("scope",this.getScope);this.__defineSetter__("scope",this.setScope);this.__defineGetter__("defaultHandler",this.getDefaultHandler);this.__defineSetter__("defaultHandler",this.setDefaultHandler);this._map={};this.scope=a};Downsha.EventHandler.prototype._defaultHandler=null;Downsha.EventHandler.prototype.getDefaultHandler=function(){return this._defaultHandler};
Downsha.EventHandler.prototype.setDefaultHandler=function(a){"function"==typeof a&&(this._defaultHandler=a)};Downsha.EventHandler.prototype.getScope=function(){return this._scope};Downsha.EventHandler.prototype.setScope=function(a){"object"==typeof a&&(this._scope=a)};Downsha.EventHandler.prototype.add=function(a,b,c){this._map[a]||(this._map[a]=[]);this._map[a].push({fn:b,scope:c})};Downsha.EventHandler.prototype.addAll=function(a,b){for(var c in a)this.add(c,a[c],b)};
Downsha.EventHandler.prototype.remove=function(a,b){if(this._map[a])if(b)for(var c=0;c<this._map[a].length;c++){if(this._map[a][c].fn==b){delete this._map[a][c];break}}else delete this._map[a]};Downsha.EventHandler.prototype.removeAll=function(){this._map={}};Downsha.EventHandler.prototype.handleEvent=function(a,b){if(this._map[a])for(var c=0;c<this._map[a].length;c++)this._map[a][c].fn.apply(this._map[a][c].scope||this.scope,b);else this.handleDefaultEvent(b)};
Downsha.EventHandler.prototype.handleDefaultEvent=function(a){"function"==typeof this._defaultHandler&&this._defaultHandler.apply(this.scope,a)};Downsha.RequestMessage=function(a,b){this.initialize(a,b)};Downsha.RequestMessage.fromObject=function(a){var b=new Downsha.RequestMessage;if("object"==typeof a&&null!=a&&("undefined"!=typeof a.code&&(b.code=a.code),"undefined"!=typeof a.message))b.message=a.message;return b};Downsha.RequestMessage.prototype._code=0;
Downsha.RequestMessage.prototype._message=null;Downsha.RequestMessage.prototype._callback=null;Downsha.RequestMessage.prototype.initialize=function(a,b){this.__defineGetter__("code",this.getCode);this.__defineSetter__("code",this.setCode);this.__defineGetter__("message",this.getMessage);this.__defineSetter__("message",this.setMessage);this.__defineGetter__("callback",this.getCallback);this.__defineSetter__("callback",this.setCallback);this.code=a;this.message=b};
Downsha.RequestMessage.prototype.getCode=function(){return this._code};Downsha.RequestMessage.prototype.setCode=function(a){this._code=parseInt(a);isNaN(this._code)&&(this._code=0)};Downsha.RequestMessage.prototype.getMessage=function(){return this._message};Downsha.RequestMessage.prototype.setMessage=function(a){this._message=a};Downsha.RequestMessage.prototype.getCallback=function(){return this._callback};
Downsha.RequestMessage.prototype.setCallback=function(a){if("function"==typeof a||null==a)this._callback=a};Downsha.RequestMessage.prototype.send=function(){chrome.extension.sendRequest({code:this.code,message:this.message})};Downsha.RequestMessage.prototype.isEmpty=function(){return this.code?!1:!0};
(function(){var a=null;Downsha.getChromeExtension=function(){if(!Downsha._chromeExtInstance){var a=chrome.extension.getBackgroundPage();Downsha._chromeExtInstance=window==a?new Downsha.ChromeExtension:a.Downsha.chromeExtension}return Downsha._chromeExtInstance};Downsha.__defineGetter__("chromeExtension",Downsha.getChromeExtension);Downsha.ChromeExtension=function(){this.initialize()};Downsha.ChromeExtension.INTRODUCTION_PAGE_DELAY=2E3;Downsha.ChromeExtension.DESKTOP_NOTIFICATION_TIMEOUT=6E3;Downsha.ChromeExtension.POPUP_MONITOR_INTERVAL=
600;Downsha.ChromeExtension.POPUP_LOCATION="/popup.html";Downsha.ChromeExtension.ARTICLE_XHR_TIMEOUT=3E3;Downsha.ChromeExtension.prototype._offline=!1;Downsha.ChromeExtension.prototype._localStore=null;Downsha.ChromeExtension.prototype._logger=null;Downsha.ChromeExtension.prototype._eventHandler=null;Downsha.ChromeExtension.prototype._clipperContentScripting=null;Downsha.ChromeExtension.prototype._contentPreview=null;Downsha.ChromeExtension.prototype._tabSemas=null;Downsha.ChromeExtension.prototype._popupMonitor=
null;Downsha.ChromeExtension.prototype._articleRulesMap={};Downsha.ChromeExtension.prototype.initialize=function(){this.__defineGetter__("offline",this.isOffline);this.__defineSetter__("offline",this.setOffline);this.__defineGetter__("clipperContentScripting",this.getClipperContentScripting);this.__defineGetter__("contentPreview",this.getContentPreview);this.__defineGetter__("localStore",this.getLocalStore);this.__defineGetter__("logger",this.getLogger);this.initTabSemas();this.initEventHandler();
this.initBindings();this.showIntro();a=this.logger};Downsha.ChromeExtension.prototype.destroy=function(){};Downsha.ChromeExtension.prototype.isOffline=function(){return this._offline};Downsha.ChromeExtension.prototype.setOffline=function(a){this._offline=a?!0:!1;this.handleOffline()};Downsha.ChromeExtension.prototype.showIntro=function(){this.localStore&&!this.localStore.get("introShown")&&(setTimeout(function(){chrome.tabs.create({url:chrome.i18n.getMessage("introPageUrl"),selected:!0})},this.constructor.INTRODUCTION_PAGE_DELAY),
this.localStore.put("introShown","true"))};Downsha.ChromeExtension.prototype.getLogger=function(a){var c=Downsha.Logger.LOG_LEVEL_ERROR;if(this.localStore){var d=this.localStore.get("options");d&&"undefiend"!=typeof d.debugLevel&&(c=d.debugLevel)}d=Downsha.Logger.getInstance(a||arguments.callee.caller);d.level=c;return d};Downsha.ChromeExtension.prototype.getLocalStore=function(){this._localStore||(this._localStore=new Downsha.LocalStore(null,new Downsha.LocalStore.HTML5_LOCALSTORAGE_IMPL(localStorage)));
return this._localStore};Downsha.ChromeExtension.prototype.getClipperContentScripting=function(){this._clipperContentScripting||(this._clipperContentScripting=new Downsha.ClipperContentScripting,this._clipperContentScripting.ontimeout=function(){a.warn("ClipperContentScripting timed out...");alert(chrome.i18n.getMessage("contentScriptTimedOut"))},this._clipperContentScripting.createInstance=function(){return"Downsha.ContentClipper.destroyInstance();(function(){var inst = Downsha.ContentClipper.getInstance();inst.PAGE_CLIP_SUCCESS = Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_SUCCESS;inst.PAGE_CLIP_CONTENT_TOO_BIG = Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_TOO_BIG;inst.PAGE_CLIP_CONTENT_SUCCESS = Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_SUCCESS;inst.PAGE_CLIP_CONTENT_FAILURE = Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_FAILURE;inst.PAGE_CLIP_FAILURE = Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_FAILURE;})();"});
return this._clipperContentScripting};Downsha.ChromeExtension.prototype.getContentPreview=function(){if(!this._contentPreview){var b=this;this._contentPreview=new Downsha.ContentPreview;this._contentPreview.ontimeout=function(c){a.warn("ContentPreview timed out...");var d=b.getTabSemaphore(c);d&&d.signal();this.__proto__.ontimeout(c)}}return this._contentPreview};Downsha.ChromeExtension.prototype.initTabSemas=function(){this._tabSemas={}};Downsha.ChromeExtension.prototype.initEventHandler=function(){this._eventHandler||
(this._eventHandler=new Downsha.EventHandler(this),this._eventHandler.add(Downsha.Constants.RequestType.LOGIN_SUCCESS,this.handleLoginSuccess),this._eventHandler.add(Downsha.Constants.RequestType.LOGIN_ERROR,this.handleLoginError),this._eventHandler.add(Downsha.Constants.RequestType.LOGOUT,this.handleLogout),this._eventHandler.add(Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_SUCCESS,this.handlePageClipSuccess),this._eventHandler.add(Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_TOO_BIG,
this.handlePageClipTooBig),this._eventHandler.add(Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_CONTENT_FAILURE,this.handlePageClipFailure),this._eventHandler.add(Downsha.Constants.RequestType.CONTEXT_PAGE_CLIP_FAILURE,this.handlePageClipFailure),this._eventHandler.add(Downsha.Constants.RequestType.FETCH_STYLE_SHEET_RULES,this.handleFetchStyleSheetRules),this._eventHandler.add(Downsha.Constants.RequestType.PREVIEW_CLIP_ACTION_SELECTION,this.handlePreviewClipActionSelection),this._eventHandler.add(Downsha.Constants.RequestType.PREVIEW_CLIP_ACTION_FULL_PAGE,
this.handlePreviewClipActionFullPage),this._eventHandler.add(Downsha.Constants.RequestType.PREVIEW_CLIP_ACTION_ARTICLE,this.handlePreviewClipActionArticle),this._eventHandler.add(Downsha.Constants.RequestType.PREVIEW_CLIP_ACTION_URL,this.handlePreviewClipActionUrl),this._eventHandler.add(Downsha.Constants.RequestType.PREVIEW_NUDGE,this.handlePreviewNudge),this._eventHandler.add(Downsha.Constants.RequestType.POPUP_STARTED,this.handlePopupStarted),this._eventHandler.add(Downsha.Constants.RequestType.POPUP_ENDED,
this.handlePopupEnded),this._eventHandler.add(Downsha.Constants.RequestType.FETCH_ARTICLE_RULES,this.handleFetchArticleRules))};Downsha.ChromeExtension.prototype.initBindings=function(){var a=this;chrome.tabs.onUpdated.addListener(function(c,d,e){a.handleTabUpdate(c,d,e)});chrome.tabs.onSelectionChanged.addListener(function(c,d){a.handleTabSelectionChange(c,d)});chrome.tabs.onRemoved.addListener(function(c,d){a.handleTabRemoval(c,d)});chrome.extension.onRequest.addListener(function(c,d,e){a.handleRequest(c,
d,e)})};Downsha.ChromeExtension.prototype.initContextMenu=function(){Downsha.context.getOptions(!0).useContextMenu?this._setupContextMenus():this._removeContextMenus()};Downsha.ChromeExtension.prototype._removeContextMenus=function(){chrome.contextMenus.removeAll()};Downsha.ChromeExtension.prototype._setupContextMenus=function(){var b=this;chrome.contextMenus.create({title:chrome.i18n.getMessage("contextMenuClipAll"),contexts:["page","image","selection"],documentUrlPatterns:["http://*/*","https://*/*"],
onclick:function(c,d){b.doAsUser(function(){a.debug("Initiating page clip from menu item contextMenuClipPage");b.clipPageFromTab(d,!1)},function(){a.info("Cannot clip from menu item contextMenuClipPage because no user is known");alert(chrome.i18n.getMessage("contextMenuPleaseLogin"))})}},function(){chrome.extension.lastError?a.error("Error creating menu item contextMenuClipAll: "+chrome.extension.lastError):a.debug("Successfully created menu item contextMenuClipAll")})};Downsha.ChromeExtension.prototype.doAsUser=
function(b,c){a.debug("ChromeExtension.doAsUser");!Downsha.context.userKnown&&"function"==typeof c?c():Downsha.context.remote.assureLogin(function(a){a.isSuccess()&&"function"==typeof b?b():"function"==typeof c&&c()},function(){"function"==typeof c&&c()})};Downsha.ChromeExtension.prototype.openWindow=function(a){chrome.tabs.getSelected(null,function(){chrome.windows.create({url:a})})};Downsha.ChromeExtension.prototype.handleOffline=function(){a.debug("ChromeExtension.handleOffline status: "+(this.offline?
"offline":"online"))};Downsha.ChromeExtension.prototype.handleTabUpdate=function(a,c){c&&"loading"==c.status?this._tabSemas[a]=new Downsha.Semaphore:c&&"complete"==c.status&&(this._tabSemas[a]?this._tabSemas[a].signal():this._tabSemas[a]=Downsha.Semaphore.mutex());Downsha.Utils.updateBadge(Downsha.context,a)};Downsha.ChromeExtension.prototype.handleTabSelectionChange=function(a){Downsha.Utils.updateBadge(Downsha.context,a)};Downsha.ChromeExtension.prototype.handleTabRemoval=function(a){this.removeTabSemaphore(a)};
Downsha.ChromeExtension.prototype.handleRequest=function(b,c,d){a.debug("ChromeExtension.handleRequest");if("object"==typeof b&&null!=b){var e=Downsha.RequestMessage.fromObject(b);e.isEmpty()||this._eventHandler.handleEvent(e.code,[b,c,d])}};Downsha.ChromeExtension.prototype.handleLogout=function(b,c,d){a.debug("ChromeExtension.handleLogout");Downsha.Utils.clearAllBadges();Downsha.context.resetUser();Downsha.context.destroy();d({})};Downsha.ChromeExtension.prototype.handleLoginSuccess=function(){a.debug("ChromeExtension.handleLoginSuccess")};
Downsha.ChromeExtension.prototype.handleLoginError=function(){a.debug("ChromeExtension.handleLoginError")};Downsha.ChromeExtension.prototype.handlePageClipSuccess=function(b,c,d){a.debug("ChromeExtension.handlePageClipSuccess");b=Downsha.RequestMessage.fromObject(b);b=new Downsha.DownshaInfo(b.message);a.debug("Clipped note's content length: "+(b&&b.content?b.content.length:0));Downsha.chromeExtension.processClip(b);d({})};Downsha.ChromeExtension.prototype.handlePageClipTooBig=function(b,c,d){a.debug("ChromeExtension.handlePageClipTooBig");
b=chrome.i18n.getMessage("fullPageClipTooBig");b=$("<div>"+b+"</div>").text();a.error(b);alert(b);d({})};Downsha.ChromeExtension.prototype.handlePageClipFailure=function(b,c,d){a.debug("ChromeExtension.handlePageClipFailure");b=Downsha.RequestMessage.fromObject(b);b=b.message?b.message:chrome.i18n.getMessage("fullPageClipFailure");b=$("<div>"+b+"</div>").text();a.error(b);alert(b);d({})};Downsha.ChromeExtension.prototype.handleFetchStyleSheetRules=function(b,c,d){a.debug("ChromeExtension.handleFetchStyleSheetRules");
var e=Downsha.RequestMessage.fromObject(b).message;e&&(b={url:e,type:"get",async:!1,success:function(b,c,h){4==h.readyState&&200==h.status?(a.debug("Fetched css text of length: "+b.length+"."),d({url:e,cssText:b})):(a.error("Could not fetch style sheet from: "+e),d({url:e}))},error:function(){a.error("Could not fetch style sheet from: "+e);d({url:e})}},a.debug("Fetching external style sheet from "+e),$.ajax(b))};Downsha.ChromeExtension.prototype.handlePreviewClipActionSelection=function(b,c,d){a.debug("ChromeExtension.handlePreviewClipActionSelection");
var e=this,b=Downsha.RequestMessage.fromObject(b);if(b.message&&"number"==typeof b.message.tabId){var f=b.message.tabId,g=this.getTabSemaphore(f);g.critical(function(){e.contentPreview.previewSelection(f,function(){a.debug("Previewing selection of a page in tab: "+f);g.signal()})})}d({})};Downsha.ChromeExtension.prototype.handlePreviewClipActionFullPage=function(b,c,d){a.debug("ChromeExtension.handlePreviewClipActionFullPage");var e=this,b=Downsha.RequestMessage.fromObject(b);if(b.message&&"number"==
typeof b.message.tabId){var f=b.message.tabId,g=this.getTabSemaphore(f);g.critical(function(){e.contentPreview.previewFullPage(f,function(){a.debug("Previewing full page of a page in tab: "+f);g.signal()})})}d({})};Downsha.ChromeExtension.prototype.handlePreviewClipActionArticle=function(b,c,d){a.debug("ChromeExtension.handlePreviewClipActionArticle");var e=this,b=Downsha.RequestMessage.fromObject(b);if(b.message&&"number"==typeof b.message.tabId){var f=b.message.tabId,g=this.getTabSemaphore(f);Downsha.getContext(!0).getOptions(!0);
g.critical(function(){e.contentPreview.previewArticle(f,function(){a.debug("Previewing article of a page in tab: "+f);g.signal()})})}d({})};Downsha.ChromeExtension.prototype.handlePreviewClipActionUrl=function(b,c,d){a.debug("ChromeExtension.handlePreviewClipActionUrl");var e=this,b=Downsha.RequestMessage.fromObject(b);if(b.message&&"number"==typeof b.message.tabId){var f=b.message.tabId,g=this.getTabSemaphore(f);g.critical(function(){e.contentPreview.previewURL(f,function(){a.debug("Previewing article of a page in tab: "+
f);g.signal()})})}d({})};Downsha.ChromeExtension.prototype.handlePreviewNudge=function(b,c,d){a.debug("ChromeExtension.handlePreviewNudge");var b=Downsha.RequestMessage.fromObject(b),e=this;if(b&&"number"==typeof b.message.tabId&&"number"==typeof b.message.direction){var f=b.message.tabId,g=b.message.direction,h=this.getTabSemaphore(f);h.critical(function(){e.contentPreview.nudgePreview(f,g,function(){a.debug("Nudging preview: "+g);h.signal()})})}d({})};Downsha.ChromeExtension.prototype.handlePopupStarted=
function(b,c,d){a.debug("ChromeExtension.handlePopupStarted");Downsha.RequestMessage.fromObject(b);this.startPopupMonitor();d({})};Downsha.ChromeExtension.prototype.handlePopupEnded=function(b,c,d){a.debug("ChromeExtension.handlePopupEnded");this.stopPopupMonitor();this.contentPreview.clearAll();d({})};Downsha.ChromeExtension.prototype.startPopupMonitor=function(){a.debug("ChromeExtension.startPopupMonitor");var b=this;this.stopPopupMonitor();this._popupMonitor=setInterval(function(){for(var a=chrome.extension.getViews(),
d=0;d<a.length;d++){var e=a[d];if(e.window.location.href&&0<e.window.location.href.indexOf(b.constructor.POPUP_LOCATION))return}a=new Downsha.RequestMessage(Downsha.Constants.RequestType.POPUP_ENDED);b.handlePopupEnded(a,b,function(){});chrome.extension.sendRequest(a)},this.constructor.POPUP_MONITOR_INTERVAL)};Downsha.ChromeExtension.prototype.stopPopupMonitor=function(){a.debug("ChromeExtension.stopPopupMonitor");this._popupMonitor&&(clearInterval(this._popupMonitor),this._popupMonitor=null)};Downsha.ChromeExtension.prototype.handleFetchArticleRules=
function(b,c,d){a.debug("ChromeExtension.handleFetchArticleRules");var e=this,f=Downsha.RequestMessage.fromObject(b).message;f?"undefined"!=typeof this._articleRulesMap[f]?(a.debug("Cached article rules for: "+f),d({rules:this._articleRulesMap[f]})):(b={url:Downsha.getContext().getArticpatUrl(),type:"POST",dataType:"json",async:!0,cache:!0,timeout:this.constructor.ARTICLE_XHR_TIMEOUT,data:{url:f},success:function(b,c,i){4==i.readyState&&200==i.status?(a.debug("Fetched article rules for: "+f),e._articleRulesMap[f]=
b,d({rules:b})):(a.error("Could not fetch article rules for: "+f),d({}))},error:function(){a.error("Could not fetch article rules for: "+f);d({})}},a.debug("Fetching article rules for: "+f),$.ajax(b)):d({})};Downsha.ChromeExtension.prototype.clipPageFromTab=function(b,c){a.debug("ChromeExtension.clipPageFromTab");if(Downsha.Utils.isForbiddenUrl(b.url))alert(chrome.i18n.getMessage("illegalUrlClipFailure"));else{var d=this;this._tabSemas[b.id]||(a.warn("Looks like we don't have a semaphore for this tab... it is likely it was already open, so let's creat a mutex"),
this._tabSemas[b.id]=Downsha.Semaphore.mutex());this._tabSemas[b.id].critical(function(){a.debug("Clipping content of a page in tab: "+b.id);d.clipperContentScripting.perform(b.id,c,Downsha.context.getPreferredStylingStrategyQualifier(),{},true);d._tabSemas[b.id]&&d._tabSemas[b.id].signal()})}};Downsha.ChromeExtension.prototype.clipFullPageFromTab=function(b,c){a.debug("ChromeExtension.clipFullPageFromTab");if(Downsha.Utils.isForbiddenUrl(b.url))alert(chrome.i18n.getMessage("illegalUrlClipFailure"));
else{var d=this;this._tabSemas[b.id]||(a.warn("Looks like we don't have a semaphore for this tab... it is likely it was already open, so let's creat a mutex"),this._tabSemas[b.id]=Downsha.Semaphore.mutex());this._tabSemas[b.id].critical(function(){a.debug("Clipping body of a page in tab: "+b.id);d.clipperContentScripting.clipFullPage(b.id,Downsha.context.getPreferredStylingStrategyQualifier(),c,true);d._tabSemas[b.id]&&d._tabSemas[b.id].signal()})}};Downsha.ChromeExtension.prototype.clipSelectionFromTab=
function(b,c){a.debug("ChromeExtension.clipSelectionFromTab");if(Downsha.Utils.isForbiddenUrl(b.url))alert(chrome.i18n.getMessage("illegalUrlClipFailure"));else{var d=this;this._tabSemas[b.id]||(a.warn("Looks like we don't have a semaphore for this tab... it is likely it was already open, so let's creat a mutex"),this._tabSemas[b.id]=Downsha.Semaphore.mutex());this._tabSemas[b.id].critical(function(){a.debug("Clipping selection of a page in tab: "+b.id);d.clipperContentScripting.clipSelection(b.id,
Downsha.context.getPreferredStylingStrategyQualifier(),c,true);d._tabSemas[b.id]&&d._tabSemas[b.id].signal()})}};Downsha.ChromeExtension.prototype.clipArticleFromTab=function(b,c){a.debug("ChromeExtension.clipArticleFromTab");if(Downsha.Utils.isForbiddenUrl(b.url))alert(chrome.i18n.getMessage("illegalUrlClipFailure"));else{var d=this;this._tabSemas[b.id]||(a.warn("Looks like we don't have a semaphore for this tab... it is likely it was already open, so let's creat a mutex"),this._tabSemas[b.id]=Downsha.Semaphore.mutex());
this._tabSemas[b.id].critical(function(){a.debug("Clipping article of a page in tab: "+b.id);d.clipperContentScripting.clipArticle(b.id,Downsha.context.getPreferredStylingStrategyQualifier(),c,true);d._tabSemas[b.id]&&d._tabSemas[b.id].signal()})}};Downsha.ChromeExtension.prototype.clipUrlFromTab=function(b,c){a.debug("ChromeExtension.clipUrlFromTab");var d=Downsha.DownshaInfo.createUrlNote(b.title,b.url,b.favIconUrl?b.favIconUrl:null);this._overloadClipNote(d,c);d.title||(d.title=chrome.i18n.getMessage("quickNote_untitledNote"));
a.isDebugEnabled()&&(a.debug("Clipping URL: "),a.dir(d.content));this.processClip(d)};Downsha.ChromeExtension.prototype._overloadClipNote=function(a,c){if(a&&c)for(var d in c)if(Downsha.hasOwnProperty(a,d))try{c[d]&&(a[d]=c[d])}catch(e){}};Downsha.ChromeExtension.prototype.processClip=function(b){a.debug("ChromeExtension.processClip");var c=this,d=new Downsha.ClipConverter,e=new Downsha.ClipSender;d.startUp(b,function(){e.startUp(b,function(){c.notifyProcessSuccess(b)},function(){c.notifyProcessError(b)})},
function(){c.notifyProcessError(b)})};Downsha.ChromeExtension.prototype.notifyProcessSuccess=function(b){a.debug("ChromeExtension.notifyProcessSuccess");var c=Downsha.context.getOptions(!0);if(c&&c.clipNotificationEnabled)try{var d=b&&b.title?b.title:"",d=chrome.i18n.getMessage("desktopNotification_clipUploaded",[d]),e=chrome.i18n.getMessage("desktopNotification_clipUploadedMessage");Downsha.Utils.notifyDesktop(d,e,this.constructor.DESKTOP_NOTIFICATION_TIMEOUT)}catch(f){a.error(f)}};Downsha.ChromeExtension.prototype.notifyProcessError=
function(b){a.debug("ChromeExtension.notifyProcessError");var b=b&&b.title?b.title:"",b=chrome.i18n.getMessage("desktopNotification_unableToSaveClip",[b]),c=chrome.i18n.getMessage("desktopNotification_unableToSaveClipUnknownMessage");Downsha.Utils.notifyDesktop(b,c)};Downsha.ChromeExtension.prototype.getCurrentTab=function(a){chrome.windows.getCurrent(function(c){chrome.tabs.getSelected(c.id,a)})};Downsha.ChromeExtension.prototype.executeContentScript=function(a,c){this.getCurrentTab(function(d){chrome.tabs.executeScript(d.id,
a,c)})};Downsha.ChromeExtension.prototype.getTabSemaphore=function(a){"number"==typeof a&&!this._tabSemas[a]&&(this._tabSemas[a]=Downsha.Semaphore.mutex());return this._tabSemas[a]};Downsha.ChromeExtension.prototype.removeTabSemaphore=function(a){"number"==typeof a&&this._tabSemas[a]&&(this._tabSemas[a]=null,delete this._tabSemas[a])}})();
(function(){var a=null;Downsha.ChromeExtensionRemote=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.ChromeExtensionRemote,Downsha.DownshaRemote,!0);Downsha.ChromeExtensionRemote.SESS_EXPIRATION=6E5;Downsha.ChromeExtensionRemote.prototype.initialize=function(){Downsha.ChromeExtensionRemote.parent.initialize.apply(this,[])};Downsha.ChromeExtensionRemote.prototype._reloginAttempted=!1;Downsha.ChromeExtensionRemote.prototype.register=function(b,c,d,e,f){a.debug("ChromeExtensionRemote.register");
return Downsha.ChromeExtensionRemote.parent.register.apply(this,arguments)};Downsha.ChromeExtensionRemote.prototype.login=function(b,c,d,e,f,g){a.debug("ChromeExtensionRemote.login");return Downsha.ChromeExtensionRemote.parent.login.apply(this,[b,c,d,function(a,b,c){"function"==typeof e&&e(a,b,c);a.hasAuthenticationError()?Downsha.Utils.notifyExtension(new Downsha.RequestMessage(Downsha.Constants.RequestType.AUTH_ERROR,a)):Downsha.Utils.notifyExtension(new Downsha.RequestMessage(Downsha.Constants.RequestType.AUTH_SUCCESS,
a))},f,g])};Downsha.ChromeExtensionRemote.prototype.logout=function(b,c,d){a.debug("ChromeExtensionRemote.logout");return Downsha.ChromeExtensionRemote.parent.logout.apply(this,arguments)};Downsha.ChromeExtensionRemote.prototype.notifyTermInfo=function(b,c,d,e){a.debug("ChromeExtensionRemote.notifyTermInfo");return Downsha.ChromeExtensionRemote.parent.notifyTermInfo.apply(this,arguments)};Downsha.ChromeExtensionRemote.prototype.putInfoItem=function(b,c,d,e){a.debug("ChromeExtensionRemote.putInfoItem");
var f=arguments,g=new Downsha.MutableXMLHttpRequest;g.become(Downsha.ChromeExtensionRemote.parent.putInfoItem.apply(this,f));return g};Downsha.ChromeExtensionRemote.prototype.putFileDesc=function(b,c,d,e){a.debug("ChromeExtensionRemote.putFileDesc");var f=arguments,g=new Downsha.MutableXMLHttpRequest;g.become(Downsha.ChromeExtensionRemote.parent.putFileDesc.apply(this,f));return g};Downsha.ChromeExtensionRemote.prototype.putFile=function(b,c,d,e){a.debug("ChromeExtensionRemote.putFile");var f=arguments,
g=new Downsha.MutableXMLHttpRequest;g.become(Downsha.ChromeExtensionRemote.parent.putFile.apply(this,f));return g};Downsha.ChromeExtensionRemote.prototype.genThumbnail=function(b,c,d,e){a.debug("ChromeExtensionRemote.genThumbnail");var f=arguments,g=new Downsha.MutableXMLHttpRequest;g.become(Downsha.ChromeExtensionRemote.parent.genThumbnail.apply(this,f));return g};Downsha.ChromeExtensionRemote.prototype.assureLogin=function(b,c){a.debug("ChromeExtensionRemote.assureLogin");if(Downsha.context.userKnown)if(Downsha.context.sessTime+
this.constructor.SESS_EXPIRATION>Date.now()){var d=new Downsha.DSTPResponse({Status:0});"function"==typeof b&&(a.debug("re-using existing login session"),setTimeout(function(){b(d,null,null)},1))}else return a.debug("Attempting to login using stored credentials for: "+Downsha.context.userName),this.login(Downsha.context.userName,Downsha.XORCrypt.decrypt(Downsha.context.userPass,Downsha.context.userName),!0,b,c,!0);else"function"==typeof c&&c({readyState:0,status:0},null,null)};Downsha.ChromeExtensionRemote.prototype._relogin=
function(b){a.debug("ChromeExtensionRemote._relogin");var c=this;Downsha.context.userKnown&&(a.debug("Attempting to relogin using stored credentials for: "+Downsha.context.userName),this.login(Downsha.context.userName,Downsha.XORCrypt.decrypt(Downsha.context.userPass,Downsha.context.userName),!0,function(d,e,f){var g=b.success,h=b.failure;b.success=function(a,b,d){c._reloginAttempted=false;typeof g=="function"&&g(a,b,d)};b.failure=function(a,b,d){c._reloginAttempted=false;typeof h=="function"&&h(a,
b,d)};if(d instanceof Downsha.DSTPResponse&&d.hasAuthenticationError()){a.debug("Handling original success callback due to soft-failed authentication");b.success(d,e,f)}else if(typeof g=="function"){a.debug("Retrying original request after successful relogin");c.doRequest.apply(c,b.arguments)}},function(d,e,f){a.debug("Failed to relogin, handling original request's failure callback");c._reloginAttempted=false;typeof b.failure=="function"&&b.failure(d,e,f)},!0),a.debug("Making reloginAttempted"),this._reloginAttempted=
!0)};Downsha.ChromeExtensionRemote.prototype.handleHttpSuccess=function(b,c,d,e){a.debug("ChromeExtensionRemote.handleHttpSuccess");Downsha.chromeExtension.offline=!1;c=Downsha.ChromeExtensionRemote.parent.handleHttpSuccess.apply(this,[b,c,d,e]);if((c.isSessionNotExistError()||c.isSessionCreateFailedError())&&!this._reloginAttempted&&e.data.Cmdid!=Downsha.DownshaRemote.Command.USER_LOGIN&&e.data.Cmdid!=Downsha.DownshaRemote.Command.USER_REGISTER&&e.data.Cmdid!=Downsha.DownshaRemote.Command.USER_LOGOUT)this._relogin(e);
else if(c.isSuccess()&&(e.data.Cmdid==Downsha.DownshaRemote.Command.USER_LOGIN||e.data.Cmdid==Downsha.DownshaRemote.Command.USER_REGISTER))Downsha.context.sessId=b.SessID,Downsha.context.sessTime=Date.now();return c};Downsha.ChromeExtensionRemote.prototype.handleHttpError=function(b,c,d,e){a.debug("ChromeExtensionRemote.handleHttpError");var f=Array.prototype.slice.call(arguments);Downsha.chromeExtension.offline=0==b.readyState||4==b.readyState&&0==b.status?!0:!1;Downsha.ChromeExtensionRemote.parent.handleHttpError.apply(this,
f)}})();
(function(){var a=null;Downsha.ContentScriptingMixin=function(){};Downsha.ContentScriptingMixin.prototype.startScriptTimer=function(b,c,d){a=a||Downsha.Logger.getInstance(Downsha.ContentScriptingMixin);a.debug("ContentScriptingMixin.startScriptTimer");return setTimeout(function(){a.debug("Content script load/execution timed out");"function"==typeof c&&c(b)},d)};Downsha.ContentScriptingMixin.prototype.stopScriptTimer=function(b){a=a||Downsha.Logger.getInstance(Downsha.ContentScriptingMixin);a.debug("ContentScriptingMixin.stopScriptTimer");
"number"==typeof b&&clearTimeout(b)};Downsha.ContentScriptingMixin.prototype.executeScript=function(b,c,d){a=a||Downsha.Logger.getInstance(Downsha.ContentScriptingMixin);a.debug("ContentScriptingMixin.executeScript");"number"!=typeof b&&(b=null);this.doExecuteScript(b,c,null,d)};Downsha.ContentScriptingMixin.prototype.executeTimedScript=function(b,c,d,e,f){a=a||Downsha.Logger.getInstance(Downsha.ContentScriptingMixin);a.debug("ContentScriptingMixin.executeTimedScript");"number"!=typeof b&&(b=null);
"number"!=typeof d&&(d=0);var g=0,h=this;this.doExecuteScript(b,c,function(){g=h.startScriptTimer(b,f,d)},function(){h.stopScriptTimer(g);"function"==typeof e&&e()})};Downsha.ContentScriptingMixin.prototype.doExecuteScript=function(b,c,d,e){a=a||Downsha.Logger.getInstance(Downsha.ContentScriptingMixin);a.debug("ContentScriptingMixin.doExecuteScript");"number"!=typeof b&&(b=null);"function"==typeof d&&(a.debug("Executing onstart"),d());chrome.tabs.executeScript(b,c,function(){if(typeof e=="function"){a.debug("Executing oncomplete");
e()}})}})();
(function(){var a=null;Downsha.AbstractContentScripting=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.mixin(Downsha.AbstractContentScripting,Downsha.ContentScriptingMixin,{executeScript:"mixinExecuteScript",executeTimedScript:"mixinExecuteTimedScript",doExecuteScript:"mixinDoExecuteScript"});Downsha.AbstractContentScripting.prototype._status=null;Downsha.AbstractContentScripting.prototype._sema=null;Downsha.AbstractContentScripting.TIMEOUT=1E4;Downsha.AbstractContentScripting.prototype.initialize=function(){this._status=
{};this._sema=Downsha.Semaphore.mutex();this.initializeTabListeners()};Downsha.AbstractContentScripting.prototype.initializeTabListeners=function(){this.initializeTabUpdateListener();this.initializeTabRemoveListener()};Downsha.AbstractContentScripting.prototype.initializeTabUpdateListener=function(){var a=this;chrome.tabs.onUpdated.addListener(function(c,d,e){a.handleTabUpdate(c,d,e)})};Downsha.AbstractContentScripting.prototype.initializeTabRemoveListener=function(){var a=this;chrome.tabs.onRemoved.addListener(function(c,
d){a.handleTabRemove(c,d)})};Downsha.AbstractContentScripting.prototype.handleTabUpdate=function(a,c){c&&"loading"==c.status&&this.forgetTab(a)};Downsha.AbstractContentScripting.prototype.handleTabRemove=function(a){this.forgetTab(a)};Downsha.AbstractContentScripting.prototype.forgetTab=function(b){"number"==typeof b&&this._status[b]&&(a.debug("Deleting remembered tabId: "+b),delete this._status[b])};Downsha.AbstractContentScripting.prototype.setStatus=function(b,c){"number"==typeof b&&(a.debug("Setting status of tabId: "+
b+" to status: "+c),this._status[b]=c)};Downsha.AbstractContentScripting.prototype.getStatus=function(a){return"number"==typeof this._status[a]?this._status[a]:0};Downsha.AbstractContentScripting.prototype.getRequiredScriptNames=function(){return[]};Downsha.AbstractContentScripting.prototype.isRequiredScriptsLoaded=function(a){return 0==this.getRequiredScriptNames().length||2<=this.getStatus(a)};Downsha.AbstractContentScripting.prototype.isRequiredScriptsLoading=function(a){return 1==this.getStatus(a)?
!0:!1};Downsha.AbstractContentScripting.prototype._logTabInfo=function(b){chrome.tabs.get(b,function(c){a.debug("tabId: "+b+" url: "+c.url)})};Downsha.AbstractContentScripting.prototype.loadRequiredScripts=function(b,c){a.debug("AbstractContentScripting.loadRequiredScripts");a.isDebugEnabled()&&this._logTabInfo(b);var d=this;this.setStatus(b,1);d._loadRequiredScripts(b,function(){a.debug("Finished loading required scripts");d.setStatus(b,2);"function"==typeof c&&(a.debug("Executing callback after loading required scripts"),
c())},d.ontimeout,d.getRequiredScriptNames())};Downsha.AbstractContentScripting.prototype._loadRequiredScripts=function(b,c,d,e){var f=this;if(e&&0<e.length){var g=e.shift();a.debug("Loading script: "+g+" with timeout of: "+this.constructor.TIMEOUT);this.mixinExecuteTimedScript(b,{file:g},this.constructor.TIMEOUT,function(){a.debug("Loaded script: "+g);f._loadRequiredScripts(b,c,d,e)},function(){a.debug("Timed out after waiting for "+f.constructor.TIMEOUT+" ms for script to load: "+g);"function"==
typeof d&&d(b)})}else a.debug("Finished loading scripts into tabId: "+b),this.onload(b,c)};Downsha.AbstractContentScripting.prototype.getOnloadCode=function(){return"Downsha.Logger.setGlobalLevel("+a.level+");"};Downsha.AbstractContentScripting.prototype.onload=function(b,c){a.debug("AbstractContentScripting.onload");a.debug("Setting up Logger inside the content page");this.mixinDoExecuteScript(b,{code:this.getOnloadCode()},null,function(){"function"==typeof c&&(a.debug("Executing callback after loading all required scripts"),
c())})};Downsha.AbstractContentScripting.prototype.ontimeout=function(b){a.debug("AbstractContentScripting.ontimeout");Downsha.Utils.notifyExtension(new Downsha.RequestMessage(Downsha.Constants.RequestType.CONTENT_SCRIPT_LOAD_TIMEOUT,{tabId:b}))};Downsha.AbstractContentScripting.prototype.ensureRequiredScripts=function(b,c){a.debug("AbstractContentScripting.ensureRequiredScripts");if(this.isRequiredScriptsLoaded(b))"function"==typeof c&&c();else if(!this.isRequiredScriptsLoading(b)){a.debug("ContentScript wasn't injected yet, injecting it. (tabId: "+
b+";status: "+this.getStatus(b)+")");try{this.loadRequiredScripts(b,c)}catch(d){a.error(d)}}};Downsha.AbstractContentScripting.prototype.executeScript=function(b,c,d){a.debug("AbstractContentScripting.executeScript");var e=this;this.ensureRequiredScripts(b,function(){e.doExecuteScript(b,c,function(){e.setStatus(b,3)},function(){e.setStatus(b,4);"function"==typeof d&&d()})})};Downsha.AbstractContentScripting.prototype.executeTimedScript=function(b,c,d,e,f){a.debug("AbstractContentScripting.executeTimedScript");
var g=this;this.ensureRequiredScripts(b,function(){g.mixinExecuteTimedScript(b,c,d,function(){g.setStatus(b,4);"function"==typeof e&&e()},function(){g.setStatus(b,5);"function"==typeof f&&f(b)})})};Downsha.AbstractContentScripting.prototype.doExecuteScript=function(b,c,d,e){var f=this;this._sema.critical(function(){try{c.file?a.debug("Executing content script from file: "+c.file):c.code&&a.debug("Executing content script: "+c.code),f.mixinDoExecuteScript(b,c,d,function(){f._sema.signal();"function"==
typeof e&&e()})}catch(g){f.setStatus(b,6),a.error(g),f._sema.signal()}})}})();
(function(){var a=null;Downsha.ClipperContentScripting=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.ClipperContentScripting,Downsha.AbstractContentScripting,!0);Downsha.ClipperContentScripting.CONTENT_SCRIPTS=["/libs/DownshaClip.js"];Downsha.ClipperContentScripting.prototype.getRequiredScriptNames=function(){return[].concat(this.constructor.CONTENT_SCRIPTS)};Downsha.ClipperContentScripting.prototype.createInstance=function(){};Downsha.ClipperContentScripting.prototype.clipFullPage=
function(b,c,d,e,f){a.debug("ClipperContentScripting.clipFullPage");c||(c="Downsha.ClipFullStylingStrategy");var c=c?c:"null",e=e?"true":"false",d=d?JSON.stringify(d):null,g=this.createInstance(),g=g+("Downsha.ContentClipper.getInstance().clipFullPage("+c+", "+d+","+e+");");a.debug("Executing: "+g);this.executeScript(b,{code:g},f)};Downsha.ClipperContentScripting.prototype.clipSelection=function(b,c,d,e,f){a.debug("ClipperContentScripting.clipSelection");c||(c="Downsha.ClipFullStylingStrategy");var c=
c?c:"null",e=e?"true":"false",d=d?JSON.stringify(d):null,g=this.createInstance(),g=g+("Downsha.ContentClipper.getInstance().clipSelection("+c+", "+d+", "+e+");");a.debug("Executing: "+g);this.executeScript(b,{code:g},f)};Downsha.ClipperContentScripting.prototype.clipArticle=function(b,c,d,e,f){a.debug("ClipperContentScripting.clipArticle");c||(c="Downsha.ClipFullStylingStrategy");var c=c?c:"null",e=e?"true":"false",d=d?JSON.stringify(d):"null",g=this.createInstance(),g=g+("Downsha.ContentClipper.getInstance().clipArticle("+
c+", "+d+", "+e+");");a.debug("Executing: "+g);this.executeScript(b,{code:g},f)};Downsha.ClipperContentScripting.prototype.perform=function(b,c,d,e,f,g){a.debug("ClipperContentScripting.perform("+b+", "+c+", "+d+", "+f+")");d||(d="Downsha.ClipFullStylingStrategy");var c=c?"true":"false",d=d?d:"null",f=f?"true":"false",e=e?JSON.stringify(e):null,h=this.createInstance(),h=h+("Downsha.ContentClipper.getInstance().perform("+c+", "+d+", "+e+", "+f+");");a.debug("Executing: "+h);this.executeScript(b,{code:h},
g)};Downsha.ClipperContentScripting.prototype._wait=function(a){this.executeScript(a,{code:"Downsha.ContentClipper.getInstance().wait();"})};Downsha.ClipperContentScripting.prototype._clearWait=function(){this.executeScript(tabId,{code:"Downsha.ContentClipper.getInstance().clearWait();"})}})();
(function(){var a=null;Downsha.ContentPreview=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.ContentPreview,Downsha.AbstractContentScripting,!0);Downsha.ContentPreview.CONTENT_SCRIPTS=["/libs/DownshaPreview.js"];Downsha.ContentPreview.prototype.getRequiredScriptNames=function(){return[].concat(this.constructor.CONTENT_SCRIPTS)};Downsha.ContentPreview.prototype.previewFullPage=function(b,c){a.debug("ContentPreview.previewFullPage");this.executeScript(b,{code:"Downsha.ContentPreviewScript.getInstance().previewFullPage()"},
function(){a.debug("Finished ContentPreviewScript.previewFullPage()");"function"==typeof c&&c()})};Downsha.ContentPreview.prototype.previewSelection=function(b,c){a.debug("ContentPreview.previewSelection");this.executeScript(b,{code:"Downsha.ContentPreviewScript.getInstance().previewSelection()"},function(){a.debug("Finished ContentPreviewScript.previewSelection()");"function"==typeof c&&c()})};Downsha.ContentPreview.prototype.previewArticle=function(b,c){a.debug("ContentPreview.previewArticle");
this.executeScript(b,{code:"Downsha.ContentPreviewScript.getInstance().previewArticle()"},function(){a.debug("Finished ContentPreviewScript.previewArticle()");"function"==typeof c&&c()})};Downsha.ContentPreview.prototype.previewURL=function(b,c){a.debug("ContentPreview.previewURL");var d=this;chrome.tabs.get(b,function(b){var f=JSON.stringify(b.title),g=JSON.stringify(b.url),h=JSON.stringify(b.favIconUrl);d.executeScript(b.id,{code:"Downsha.ContentPreviewScript.getInstance().previewURL("+f+","+g+
","+h+")"},function(){a.debug("Finished ContentPreviewScript.previewURL()");"function"==typeof c&&c()})})};Downsha.ContentPreview.prototype.nudgePreview=function(b,c,d){a.debug("ContentPreview.nudgePreview");this.executeScript(b,{code:"Downsha.ContentPreviewScript.getInstance().nudgePreview("+c+")"},function(){a.debug("Finished ContentPreview.nudgePreview()");"function"==typeof d&&d()})};Downsha.ContentPreview.prototype.clear=function(b,c){a.debug("ContentPreview.clear");this.executeScript(b,{code:"Downsha.ContentPreviewScript.getInstance().clear()"},
function(){a.debug("Finished ContentPreviewScript.clear()");"function"==typeof c&&c()})};Downsha.ContentPreview.prototype.clearAll=function(){a.debug("ContentPreview.clearAll");for(var b in this._status)a.debug("Clearing tabId: "+b),b=parseInt(b),isNaN(b)||this.clear(b)}})();
(function(){var a=null;Downsha.PageInfo=function(){a=Downsha.Logger.getInstance();this.initialize()};Downsha.inherit(Downsha.PageInfo,Downsha.AbstractContentScripting,!0);Downsha.PageInfo.CONTENT_SCRIPTS=["/libs/DownshaPage.js"];Downsha.PageInfo.prototype.getRequiredScriptNames=function(){return[].concat(this.constructor.CONTENT_SCRIPTS)};Downsha.PageInfo.prototype.profile=function(b,c){a.debug("PageInfo.profile");this.executeScript(b,{code:"Downsha.PageInfoScript.getInstance().profile()"},function(){a.debug("Finished PageInfoScript.profile()");
"function"==typeof c&&c()})}})();
